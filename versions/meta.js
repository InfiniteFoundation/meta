"use strict";var meta={version:"0.8.0",importUrl:"http://meta.infinite-games.com/store/",device:null,renderer:null,camera:null,channels:[],modules:{},time:{delta:0,deltaF:0,maxDelta:250,scale:1,update:0,render:0,fps:0,elapsed:0,frameIndex:0,updateFreq:1e3/60},cache:{width:0,height:0,metaTagsAdded:!1,timerIndex:0,initFuncs:[],loadFuncs:[],readyFuncs:[],updateFuncs:[],renderFuncs:[],view:null,views:{},scripts:null,pendingScripts:null,numScriptsToLoad:0,resolutions:null,currResolution:null,imageSmoothing:!0,debug:!1},set init(t){this.cache.initFuncs.push(t),this.engine&&this.engine.inited&&t()},set load(t){this.cache.loadFuncs.push(t),this.engine&&this.engine.loaded&&t()},set ready(t){this.cache.readyFuncs.push(t),this.engine&&this.engine.ready&&t()},set update(t){this.cache.updateFuncs.push(t)},set render(t){this.cache.renderFuncs.push(t)},set debug(t){this.cache.debug!==t&&(this.cache.debug=t,t?meta.emit(meta.Event.DEBUG,t,meta.Event.DEBUG):meta.emit(meta.Event.DEBUG,t,meta.Event.DEBUG))},get debug(){return this.cache.debug}};"use strict",meta.engine={create:function(){this._container=document.body,this._container.style.cssText=this.elementStyle,this._createRenderer(),this._printInfo(),this.autoMetaTags&&this._addMetaTags(),this.chn={resize:meta.createChannel(meta.Event.RESIZE),adapt:meta.createChannel(meta.Event.FULLSCREEN),focus:meta.createChannel(meta.Event.FOCUS),fullScreen:meta.createChannel(meta.Event.FULLSCREEN),debug:meta.createChannel(meta.Event.DEBUG)};var t=this;this.cb={resize:function(e){t.onResize()},focus:function(e){t.onFocusChange(!0)},blur:function(e){t.onFocusChange(!1)}},window.addEventListener("resize",this.cb.resize,!1),window.addEventListener("orientationchange",this.cb.resize,!1),meta.device.hidden?(this.cb.visibilityChange=function(){t.onVisibilityChange()},document.addEventListener(meta.device.visibilityChange,this.cb.visibilityChange)):(window.addEventListener("focus",this.cb.focus),window.addEventListener("blur",this.cb.blur)),meta.device.support.fullScreen&&(this.cb.fullscreen=function(){t.cb.fullscreen()},document.addEventListener(meta.device.fullScreenOnChange,this.cb.fullscreen)),meta.subscribe(this,Input.Event.KEY_DOWN,this.onKeyDown),meta.world=new meta.World(0,0),meta.camera=new meta.Camera,this.sortAdaptions(),this.onResize(),this._initAll()},_initAll:function(){var t=meta.cache,e=new meta.View("master");t.views.master=e,t.view=e;for(var i=t.initFuncs.length,n=0;i>n;n++)t.initFuncs[n]();this._addCorePlugins(),this.inited=!0,console.log(" "),this._loadAll()},_loadAll:function(){meta.device.support.consoleCSS?console.log("%c(Loading started)","background: #eee; font-weight: bold;"):console.log("(Loading started)"),this.loading=!0,meta._loadAllScripts()||this._continueLoad()},_continueLoad:function(){meta.renderer.load();for(var t=meta.cache,e=t.loadFuncs.length,i=0;e>i;i++)t.loadFuncs[i]();var n,s=this.ctrls.length;for(i=0;s>i;i++)n=this.ctrls[i],n.load&&n.load(),n.loaded=!0;this.loadedCtrls=!0,this.loading=!1,0===Resource.ctrl.numToLoad&&this.onReady()},onReady:function(){this.loaded=!0,meta.device.support.consoleCSS?console.log("%c(Loading ended)","background: #eee; font-weight: bold;"):console.log("(Loading ended)");for(var t,e=this.ctrls.length,i=0;e>i;i++)t=this.ctrls[i],t.ready&&t.ready();this.ready=!0;for(var n=meta.cache.readyFuncs.length,i=0;n>i;i++)meta.cache.readyFuncs[i]();meta.cache.view.active=!0,this._startMainLoop()},_startMainLoop:function(){this.time.update=Date.now(),this.time.render=this.time.update;var t=this;this._renderLoop=function(){t.render()},this._updateLoop=function(){t.update()},this.update(),this.render()},update:function(){this.time.frameIndex++;var t=Date.now();this.time.pause?(this.time.delta=0,this.time.deltaF=0):(this.time.delta=t-this.time.update,this.time.delta>this.time.maxDelta&&(this.time.delta=this.time.maxDelta),this.time.delta*=this.time.scale,this.time.deltaF=this.time.delta/1e3);var e=this.time.deltaF,i=this.ctrlsRemove.length;if(i){for(var n=0;i>n;n++)this._removeCtrl(this.ctrlsRemove[n]);this.ctrlsRemove.length=0}var s=this.meta.cache.updateFuncs,o=s.length;for(n=0;o>n;n++)s[n](e);for(i=this.ctrlsUpdateFuncs.length,n=0;i>n;n++)this.ctrlsUpdateFuncs[n].update(e);this.meta.renderer.update(e),this._updateTimers(this.time.delta),this.time.update=t;var r=Date.now(),h=Math.max(0,this.time.updateFreq-(r-t));window.setTimeout(this._updateLoop,h)},_updateTimers:function(t){for(var e,i=!1,n=this.timers.length,s=n-1;s>-1;s--)if(e=this.timers[s],!e.paused)for(e.tAccumulator+=t;e.tAccumulator>=e.tDelta;)if(e.tAccumulator-=e.tDelta,0!==e.numTimes&&e.func.call(e.owner,e),e.tStart+=e.tDelta,-1!==e.numTimes&&(e.numTimes--,e.numTimes<=0)){i=!0,n--,n>0&&(this.timers[e.__index]=this.timers[n],this.timers[e.__index].__index=e.__index,s--);break}i&&(this.timers.length=n)},render:function(){var t=Date.now(),e=t-this.time.render,i=e/1e3;t-this.time.fps>=1e3&&(this.time.fps=t,this.fps=this._fpsCounter,this._fpsCounter=0),meta.renderer.render(i);for(var n=this.meta.cache.renderFuncs,s=n.length,o=0;s>o;o++)n[o](i);this._fpsCounter++,this.time.render=t,requestAnimationFrame(this._renderLoop)},sortAdaptions:function(){var t=meta,e=t.cache.resolutions;if(e){var i=e.length;if(!(1>=i)){e.sort(function(e,i){var n=t.math.length2(e.width,e.height),s=t.math.length2(i.width,i.height);return n-s});for(var n=e[0],s,o,r=1;i>r;r++)o=e[r-1],s=e[r],s.unitSize=s.height/n.height,s.zoomThreshold=o.unitSize+(s.unitSize-o.unitSize)/100*33;meta.maxUnitSize=e[i-1].unitSize,meta.maxUnitRatio=1/meta.maxUnitSize,t.camera.bounds(n.width,n.height)}}},adapt:function(){var t=meta,e=t.cache.resolutions;if(!e)return!1;var i=e.length;if(1>i)return!1;for(var n,s=e[0],o=t.camera.zoom,r=i-1;r>=0;r--)if(n=e[r],o>=n.zoomThreshold){s=n;break}return s===t.cache.currResolution?!0:(t.cache.currResolution=s,t.unitSize=s.unitSize,t.unitRatio=1/t.unitSize,this.chn.adapt.emit(s,meta.Event.ADAPT),!0)},onKeyDown:function(t,e){t.keyCode===Input.Key.TILDE&&(meta.debug=!meta.cache.debug,meta.renderer.needRender=!0)},onResize:function(){this._resize(this.meta.cache.width,this.meta.cache.height)},resize:function(t,e){var i=this.meta.cache;i.width=t||0,i.height=e||0,this._resize(i.width,i.height)},_resize:function(t,e){var i=this._container;i===document.body?((0===t||t>window.innerWidth)&&(t=window.innerWidth),(0===e||e>window.innerHeight)&&(e=window.innerHeight)):((0===t||t>i.clientWidth)&&(t=i.clientWidth),(0===e||e>i.clientHeight)&&(e=i.clientHeight)),t<this.meta.cache.width&&(t=this.meta.cache.width),e<this.meta.cache.height&&(e=this.meta.cache.height),t=0|t,e=0|e,(this.width!==t||this.height!==e)&&(this.width=t,this.height=0|e,this.canvas.width=t,this.canvas.height=e,this.canvas.style.width=t*this.scaleX+"px",this.canvas.style.height=e*this.scaleY+"px",this.ctx.imageSmoothingEnabled?this.ctx.imageSmoothingEnabled=meta.cache.imageSmoothing:this.ctx[meta.device.vendor+"ImageSmoothingEnabled"]=meta.cache.imageSmoothing,this._updateOffset(),this.chn.resize.emit(this,meta.Event.RESIZE),meta.renderer.needRender=!0)},scale:function(t,e){this.scaleX=t||1,this.scaleY=e||this.scaleX,this._resize(this.meta.cache.width,this.meta.cache.height)},onFocusChange:function(t){this.focus=t,this.enablePauseOnBlur&&(this.pause=!t),this.chn.focus.emit(t,meta.Event.FOCUS)},onVisibilityChange:function(){this.onFocusChange(document[meta.device.hidden]?!1:!0)},onFullScreenChangeCB:function(){var t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;meta.device.fullscreen=!!t},onCtxLost:function(){console.log("(Context lost)")},onCtxRestored:function(){console.log("(Context restored)")},_addMetaTags:function(){if(!this.metaTagsAdded){var t=document.createElement("meta");t.setAttribute("http-equiv","Content-Type"),t.setAttribute("content","text/html; charset=utf-8"),document.head.appendChild(t);var e=document.createElement("meta");e.setAttribute("http-equiv","encoding"),e.setAttribute("content","utf-8"),document.head.appendChild(e);var i="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height",n=document.createElement("meta");n.setAttribute("name","viewport"),n.setAttribute("content",i),document.head.appendChild(n);var s=document.createElement("meta");s.setAttribute("name","apple-mobile-web-app-capable"),s.setAttribute("content","yes"),document.head.appendChild(s);var o=document.createElement("meta");o.setAttribute("name","apple-mobile-web-app-status-bar-style"),o.setAttribute("content","black-translucent"),document.head.appendChild(o),this.metaTagsAdded=!0}},_createRenderer:function(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","meta-canvas"),this.canvas.style.cssText=this.canvasStyle;var t=this.meta.cache.container;t?t.appendChild(this.canvas):document.body.appendChild(this.canvas),meta.renderer=new meta.CanvasRenderer},_updateOffset:function(){this.offsetLeft=0,this.offsetTop=0;var t=this._container;if(t.offsetParent)do this.offsetLeft+=t.offsetLeft,this.offsetTop+=t.offsetTop;while(t=t.offsetParent);var e=this._container.getBoundingClientRect();this.offsetLeft+=e.left,this.offsetTop+=e.top},_addCorePlugins:function(){meta.register("Resource"),meta.register("Input"),meta.register("Physics")},_removeCtrl:function(t){var e=t.ctrl;if(e){var i,n;if(e.release&&e.release(),e.update)for(i=this.ctrlsUpdateFuncs.length,n=0;i>n;n++)if(this.ctrlsUpdateFuncs[n]===e){this.ctrlsUpdateFuncs[n]=this.ctrlsUpdateFuncs[i-1],this.ctrlsUpdateFuncs.pop();break}for(i=this.ctrls.length,n=0;i>n;n++)if(this.ctrls[n]===e){this.ctrls[n]=this.ctrls[i-1],this.ctrls.pop();break}t.ctrl=null}},_printInfo:function(){meta.device.support.consoleCSS?(console.log("%c META v"+meta.version+" ","background: #000; color: white; font-size: 12px; padding: 2px 0 1px 0;","http://meta2d.com"),console.log("%cBrowser: %c"+meta.device.name+" "+meta.device.version+"	","font-weight: bold; padding: 2px 0 1px 0;","padding: 2px 0 1px 0;"),console.log("%cRenderer: %cCanvas ","font-weight: bold; padding: 2px 0 2px 0;","padding: 2px 0 2px 0;")):(console.log("META v"+meta.version+" http://meta2d.com "),console.log("Browser: "+meta.device.name+" "+meta.device.version+"	"),console.log("Renderer: Canvas "))},fullscreen:function(t){var e=meta.device;if(e.fullscreen!==t)if(t){if(!e.support.fullScreen)return console.warn("(meta.engine.enterFullScreen): Device does not support fullscreen mode"),void 0;document.documentElement[e.fullScreenRequest](Element.ALLOW_KEYBOARD_INPUT)}else document[meta.device.fullScreenExit]()},toggleFullscreen:function(){this.fullscreen(!meta.device.fullscreen)},set container(t){this._container!==t&&(this._container&&this._container.removeChild(this.canvas),this._container=t?t:document.body,this._container.appendChild(this.canvas),this.onResize())},get container(){return this._container},set imageSmoothing(t){meta.cache.imageSmoothing=t,this.inited&&this.onResize()},get imageSmoothing(){return meta.cache.imageSmoothing},set cursor(t){meta.element.style.cursor=t},get cursor(){return meta.element.style.cursor},elementStyle:"padding:0; margin:0;",canvasStyle:"position:absolute; overflow:hidden; translateZ(0); -webkit-backface-visibility:hidden; -webkit-perspective: 1000; -webkit-touch-callout: none; -webkit-user-select: none; zoom: 1;",meta:meta,time:meta.time,_container:null,width:0,height:0,offsetLeft:0,offsetTop:0,scaleX:1,scaleY:1,canvas:null,ctx:null,chn:null,cb:null,autoInit:!0,autoMetaTags:!0,inited:!1,loading:!1,loaded:!1,loadedCtrls:!1,ready:!1,focus:!1,pause:!1,webgl:!1,_updateLoop:null,_renderLoop:null,ctrls:[],ctrlsUpdateFuncs:[],ctrlsRemove:[],timers:[],fps:0,_fpsCounter:0,enablePauseOnBlur:!0,enableAdaptive:!0,unitSize:1,unitRatio:1,maxUnitSize:1,maxUnitRatio:1},"use strict",meta.Device=function(){this.name="unknown",this.version="0",this.versionBuffer=null,this.vendors=["","webkit","moz","ms","o"],this.vendor="",this.support={},this.audioFormats=[],this.mobile=!1,this.isPortrait=!1,this.isAudioAPI=!1,this.hidden=null,this.visibilityChange=null,this.fullScreenRequest=null,this.fullScreenExit=null,this.fullScreenOnChange=null,this.fullscreen=!1,this.load()},meta.Device.prototype={load:function(){this.checkBrowser(),this.mobile=this.isMobileAgent(),this.checkConsoleCSS(),this.support.onloadedmetadata="object"==typeof window.onloadedmetadata,this.support.onkeyup="object"==typeof window.onkeyup,this.support.onkeydown="object"==typeof window.onkeydown,this.support.canvas=this.isCanvasSupport(),this.support.webgl=this.isWebGLSupport(),this.modernize()},checkBrowser:function(){var t={Chrome:[/Chrome\/(\S+)/],Firefox:[/Firefox\/(\S+)/],MSIE:[/MSIE (\S+);/],Opera:[/OPR\/(\S+)/,/Opera\/.*?Version\/(\S+)/,/Opera\/(\S+)/],Safari:[/Version\/(\S+).*?Safari\//]},e=navigator.userAgent,i,n,s,o=2;for(i in t)for(;n=t[i].shift();)if(s=e.match(n)){this.version=s[1].match(new RegExp("[^.]+(?:.[^.]+){0,"+--o+"}"))[0],this.name=i,this.versionBuffer=this.version.split(".");for(var r=this.versionBuffer.length,h=0;r>h;h++)this.versionBuffer[h]=parseInt(this.versionBuffer[h]);break}null===this.versionBuffer||"unknown"===this.name?console.warn("(meta.Device.checkBrowser) Could not detect browser."):"Chrome"===this.name||"Safari"===this.name||"Opera"===this.name?this.vendor="webkit":"Firefox"===this.name?this.vendor="moz":"MSIE"===this.name&&(this.vendor="ms")},checkConsoleCSS:function(){this.support.consoleCSS=this.mobile||"Chrome"!==this.name&&"Opera"!==this.name?!1:!0},modernize:function(){this.supportConsole(),this.supportPageVisibility(),this.supportFullScreen(),this.supportRequestAnimFrame(),this.supportPerformanceNow(),this.supportAudioFormats(),this.supportAudioAPI()},isMobileAgent:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isCanvasSupport:function(){return!!window.CanvasRenderingContext2D},isWebGLSupport:function(){var t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");return!!e},supportConsole:function(){window.console||(window.console={},window.console.log=meta.emptyFuncParam,window.console.warn=meta.emptyFuncParam,window.console.error=meta.emptyFuncParam)},supportPageVisibility:function(){void 0!==document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):void 0!==document.hidden?(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"):void 0!==document.hidden?(this.hidden="mozhidden",this.visibilityChange="mozvisibilitychange"):void 0!==document.hidden&&(this.hidden="mshidden",this.visibilityChange="msvisibilitychange")},supportFullScreen:function(){this._fullScreenRequest(),this._fullScreenExit(),this._fullScreenOnChange(),this.support.fullScreen=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled},_fullScreenRequest:function(){var t=document.documentElement;void 0!==t.requestFullscreen?this.fullScreenRequest="requestFullscreen":void 0!==t.webkitRequestFullscreen?this.fullScreenRequest="webkitRequestFullscreen":void 0!==t.mozRequestFullScreen?this.fullScreenRequest="mozRequestFullScreen":void 0!==t.msRequestFullscreen&&(this.fullScreenRequest="msRequestFullscreen")},_fullScreenExit:function(){void 0!==document.exitFullscreen?this.fullScreenExit="exitFullscreen":void 0!==document.webkitExitFullscreen?this.fullScreenExit="webkitExitFullscreen":void 0!==document.mozCancelFullScreen?this.fullScreenExit="mozCancelFullScreen":void 0!==document.msExitFullscreen&&(this.fullScreenExit="msExitFullscreen")},_fullScreenOnChange:function(){void 0!==document.onfullscreenchange?this.fullScreenOnChange="fullscreenchange":void 0!==document.onwebkitfullscreenchange?this.fullScreenOnChange="webkitfullscreenchange":void 0!==document.onmozfullscreenchange?this.fullScreenOnChange="mozfullscreenchange":void 0!==document.onmsfullscreenchange&&(this.fullScreenOnChange="msfullscreenchange")},supportRequestAnimFrame:function(){window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}())},supportPerformanceNow:function(){void 0===window.performance&&(window.performance={}),void 0===window.performance.now&&(window.performance.now=Date.now)},supportAudioFormats:function(){var t=document.createElement("audio");""!=t.canPlayType('audio/mp4; codecs="mp4a.40.2"').replace(/no/i,"")&&this.audioFormats.push("m4a"),t.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")&&this.audioFormats.push("ogg"),t.canPlayType("audio/mpeg;").replace(/no/,"")&&this.audioFormats.push("mp3"),t.canPlayType('audio/wav; codecs="1"').replace(/no/,"")&&this.audioFormats.push("wav")},supportAudioAPI:function(){window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext)}},meta.device=new meta.Device,"use strict",meta.device.mobile&&(window.onerror=function(t,e,i){alert(e+": "+i+" "+t)}),"use strict",meta.emptyFunc=function(){},meta.emptyFuncParam=function(t){},meta.loadTexture=function(t,e,i){meta._loadResource("Texture",t,e,i)||console.warn("[meta.loadTexture]:","Unsupported parameter was passed.")},meta.preloadTexture=function(t,e,i){meta._preloadResource("Texture",t,e,i)||console.warn("[meta.preloadTexture]:","Unsupported parameter was passed.")},meta.loadSound=function(t,e){meta._loadResource("Sound",t,e)||console.warn("[meta.loadSound]:","Unsupported parameter was passed.")},meta.preloadSound=function(t,e){meta._preloadResource("Sound",t,e)||console.warn("[meta.preloadSound]:","Unsupported parameter was passed.")},meta.loadSpriteSheet=function(t,e){meta._preloadResource("SpriteSheet",t,e)||console.warn("[meta.loadSpriteSheet]:","Unsupported parameter was passed.")},meta.loadFont=function(t,e){meta._preloadResource("Font",t,e)||console.warn("[meta.loadFont]:","Unsupported parameter was passed.")},meta._loadResource=function(t,e,i){if(i){var n=i.lastIndexOf("/");0>=n&&(i+="/")}else i="";if(e instanceof Array)for(var s=e.length,o=0;s>o;o++)meta._addResource(t,e[o],i);else{if("object"!=typeof e&&"string"!=typeof e)return!1;meta._addResource(t,e,i)}return!0},meta._preloadResource=function(t,e,i){if(i){var n=i.lastIndexOf("/");n!==i.length-1&&(i+="/")}else i="";if(e instanceof Array)for(var s=e.length,o=0;s>o;o++)meta._addResource(t,e[o],i);else{if("object"!=typeof e&&"string"!=typeof e)return!1;meta._addResource(t,e,i)}return!0},meta._addResource=function(t,e,i){var n;return"object"==typeof e?(e.path&&(e.path=i+e.path),n=new Resource[t](e)):n=new Resource[t](i+e),Resource.ctrl.add(n),n},meta.getTexture=function(t){return Resource.ctrl.getTexture(t)},meta.getSound=function(t){return Resource.ctrl.getSound(t)},meta.onDomLoad=function(t){if("interactive"===document.readyState||"complete"===document.readyState)return t(),void 0;var e=function(i){t(),window.removeEventListener("DOMContentLoaded",e)};window.addEventListener("DOMContentLoaded",e)},meta.enumToString=function(t,e){if(void 0===t)return"unknown";for(var i in t)if(t[i]===e)return i;return"unknown"},meta.hexToRgb=function(t){t.length<6&&(t+=t.substr(1,4));var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}},meta.isUrl=function(t){return-1!==t.indexOf("http://")||-1!==t.indexOf("https://")?!0:!1},meta.toUpperFirstChar=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},meta.serialize=function(t){var e=[];for(var i in t)e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")},meta.addDescription=function(t){var e=new Entity.Text(t);e.color="#ffffff",e.anchor(.5);var i=new Resource.Texture;i.fillRect({width:e.width+10,height:e.height+10,color:"#000000"});var n=new Entity.Geometry(i);n.z=9999,n.anchor(.5,0),n.positionTop(0,10),n.isPickable=!1,n.ignoreZoom=!0,n.disableDebug=!0,meta.view.attach(n),n.attach(e)},meta.adaptTo=function(t,e,i){if(meta.engine&&meta.engine.isInited)return console.warn("[meta.adaptTo]:","Only usable before engine is initialized."),void 0;var n=meta.cache.resolutions;n||(n=[],meta.cache.resolutions=n);var s=i.charAt(i.length-1);"/"!==s&&(i+="/");var o={width:t,height:e,path:i,unitSize:1,zoomThreshold:1};n.push(o)},meta.removeFromArray=function(t,e){for(var i=e.length,n=0;i>n;n++)if(t===e[n]){e[n]=e[i-1],e.pop();break}},meta.shuffleArray=function(t){for(var e=t.length,i,n;e;)n=Math.floor(Math.random()*e--),i=t[e],t[e]=t[n],t[n]=i;return t},meta.rotateArray=function(t){for(var e=t[0],i=t.length-1,n=0;i>n;n++)t[n]=t[n+1];t[i]=e},meta.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},"use strict",meta.Channel=function(t){this.name=t,this.subs=[],this.numSubs=0,this._isEmiting=!1,this._subsToRemove=null},meta.Channel.prototype={remove:function(){meta.channels[this.name]=null},emit:function(t,e){this._isEmiting=!0;for(var i,n=0;n<this.numSubs;n++)i=this.subs[n],i.func.call(i.owner,t,e);if(this._isEmiting=!1,this._subsToRemove){for(var s=this._subsToRemove.length,o=0;s>o;o++)this.unsubscribe(this._subsToRemove[o]);this._subsToRemove=null}},subscribe:function(t,e,i){if(i=i||0,!e)return console.warn("(meta.Channel.subscribe) No callback function passed."),void 0;for(var n=0;n<this.numSubs;n++)if(this.subs[n].owner===t)return console.warn("(meta.Channel.subscribe) Already subscribed to channel: "+this.name),void 0;var s=new meta.Subscriber(t,e,i);this.subs.push(s),this.numSubs++,i?(this._havePriority=!0,this.subs.sort(this._sortFunc)):this._havePriority&&this.subs.sort(this._sortFunc)},unsubscribe:function(t){if(this._isEmiting)return this._subsToRemove||(this._subsToRemove=[]),this._subsToRemove.push(t),void 0;for(var e,i=0;i<this.numSubs;i++)if(e=this.subs[i],e.owner===t){this.subs[i]=this.subs[this.numSubs-1],this.subs.pop(),this.numSubs--;break}this._havePriority&&this.subs.sort(this._sortFunc)},_sortFunc:function(t,e){return t.priority>e.priority?-1:1},_havePriority:!1},meta.Subscriber=function(t,e,i){this.owner=t,this.func=e,this.priority=i},meta.createChannel=function(t){if(!t)return console.warn("(meta.createChannel) No name was specified!"),null;var e=meta.channels[t];return e||(e=new meta.Channel(t),meta.channels[t]=e),e},meta.releaseChannel=function(t){return t?(meta.channels[t]&&(meta.channels[t]=null),void 0):(console.warn("(meta.releaseChannel) No name was specified!"),void 0)},meta.subscribe=function(t,e,i,n){if("object"!=typeof t)return console.warn("(meta.subscribe) No owner passed."),void 0;if(!i)return console.warn("(meta.subscribe) No callback function passed."),void 0;if("string"!=typeof e){if("[object Array]"===Object.prototype.toString.call(e)){for(var s=e.length,o=0;s>o;o++)meta.subscribe(t,e[o],i,n);return}return console.warn("(meta.subscribe) Wrong type for channel object: "+typeof e),void 0}var r=meta.channels[e];if(r)e=r;else if(e=meta.createChannel(e),!e)return;e.subscribe(t,i,n)},meta.unsubscribe=function(t,e){if("string"!=typeof e){if("[object Array]"===Object.prototype.toString.call(e)){for(var i=e.length,n=0;i>n;n++)meta.unsubscribe(t,e[n]);return}return console.warn("(meta.unsubscribe) Wrong type for channel object."),void 0}return e=meta.channels[e],e?(e.unsubscribe(t),void 0):(console.warn("(meta.unsubscribe) No name was specified!"),void 0)},meta.emit=function(t,e,i){return"string"!=typeof t||(t=meta.channels[t],t)?(t.emit(e,i),void 0):(console.warn("(meta.emit) No name was specified!"),void 0)},"use strict",meta.View=function(t){this.name=t,this.entities=[],this.views=null,this.parentView=null,this._x=0,this._y=0,this._z=0,this._tween=null,this._active=!1,this._static=!1},meta.View.prototype={remove:function(){if("master"===this.name)return console.warn("(meta.View.remove) Master view can't be removed"),void 0;if(this.parentView&&this.parentView.detachView(this),this.views)for(var t=this.views.length,e=0;t>e;e++)this.views[e].remove();this.active=!1,this._unregisterFromEngine();for(var i,n=this.entities.length,s=0;n>s;s++)i=this.entities[s],i._view=null,i.remove();this.entities.length=0},attach:function(t){return t.removed?(console.warn("(meta.View.add) Removed entity can not be added to the view."),void 0):t._view?(console.warn(t._view===this?"(meta.View.attach) Entity is already added to this view.":"(meta.View.attach) Entity is already added to some other view."),void 0):((0!==this._x||0!==this._y)&&t.updatePos(),t._view=this,t._viewNodeID=this.entities.length,this._z&&(t.z=t._z),this._static&&(t.static=!0),this._attachChildren(t.children),this.entities.push(t),this._active&&meta.engine.ready&&meta.renderer.addEntity(t),void 0)},_attachChildren:function(t){if(t)for(var e,i=t.length,n=0;i>n;n++)e=t[n],e.removed||(e._view=this,this._attachChildren(e.children))},detach:function(t){if(!t.isRemoved){if(!t._view)return console.warn("(meta.View.detach) Entity does not have view."),void 0;if(t._view!==this)return console.warn("(meta.View.detach) Entity is part of other view: "+t.view.name),void 0;if(t._parent!==t._entityCtrl)return console.warn("(meta.View.detach) Entity children are not part of view."),void 0;t.isRemoved=!0,t.removeCore(),this.numEntities--;var e=this.entities[this.numEntities];e.core.viewIndex=this.numEntities,this.entities[this.numEntities]=e,this.entities.pop(),this._active&&Renderer.ctrl.removeEntities(t)}},attachView:function(t){if(!t)return this.parentView?(console.warn("(meta.View.attach) No view was passed."),void 0):(meta.cache.view.attachView(this),void 0);if("string"==typeof t){var e=meta.cache.views[t];if(!e)return console.warn("(meta.View.attach) No such view found: "+t),void 0;t=e}else if(!(t instanceof meta.View))return console.warn("(meta.View.attach) Trying to attach invalid view object."),void 0;return t._active?(console.warn("(meta.View.attach) Can't attach an active view."),void 0):t.parentView?(console.warn("(meta.View.attach) View is already part of other view."),void 0):(this.views||(this.views=[]),this.views.push(t),t.parentView=this,this._active&&(t.active=!0),void 0)},detachView:function(t){if(!t)return this.parentView?(this.parentView.detachView(this),void 0):(console.warn("(meta.View.detachView) No view was passed."),void 0);if("string"==typeof t){var e=meta.cache.views[t];if(!e)return console.warn('(meta.View.detachView) No such view found: "'+t+'"'),void 0;t=e}if(!t.parentView)return console.warn("(meta.View.detachView) View has not parents to detach from"),void 0;if(t.parentView!==this)return console.warn("(meta.View.detachView) Detaching from wrong parent"),void 0;for(var i=this.views.length,n=0;i>n;n++)if(this.views[n]===t){this.views[n]=this.views[i-1],this.views.pop();break}t.active=!1,t.parentView=null},detachViews:function(){if(this.views){for(var t,e=this.views.length,i=this.views.length,n=0;i>n;n++)t=this.views[n],t.active=!1,t.parentView=null;this.views.length=0}},_makeActive:function(){var t;if(this.controllers){var e=this.controllers.length;for(t=0;e>t;t++)meta.addCtrl(this.controllers[t])}if(meta.renderer.addEntities(this.entities),this.views){var i=this.views.length;for(t=0;i>t;t++)this.views[t].active=!0}},_makeInactive:function(){var t;if(this.controllers){var e=this.controllers.length;for(t=0;e>t;t++)meta.removeCtrl(this.controllers[t])}if(meta.renderer.removeEntities(this.entities),this.views){var i=this.views.length;for(t=0;i>t;t++)this.views[t].active=!1}},set active(t){this._active!==t&&(t?this._makeActive():this._makeInactive(),this._active=t)},get active(){return this._active},set x(t){if(this._x!==t){this._x=t;for(var e,i=this.entities.length,n=0;i>n;n++)e=this.entities[n],e.forcePosition(e._x,e._y)}},set y(t){if(this._y!==t){this._y=t;for(var e,i=this.entities.length,n=0;i>n;n++)e=this.entities[n],e.forcePosition(e._x,e._y)}},set z(t){this._z=t;for(var e=this.entities.length,i=0;e>i;i++)this.entities[i].z=this.entities[i]._z},get x(){return this._x},get y(){return this._y},get z(){return this._z},get tween(){return this._tween||(this._tween=new meta.Tween(this)),this._tween},set static(t){if(this._static!==t){this._static=t;for(var e=this.entities.length,i=0;e>i;i++)this.entities[i].static=!0}},get static(){return this._static},entitiesUI:null},meta.createView=function(t){if(!t||"string"!=typeof t)return console.error("(meta.createView) Invalid name of the view"),void 0;var e=meta.cache.views[t];return e?(console.error("(meta.createView) View with a name - "+t+", already exist"),void 0):(e=new meta.View(t),meta.cache.views[t]=e,e)},meta.setView=function(t){if(!t)return console.error("(meta.setView) No view passed"),void 0;var e=meta.cache;if("string"==typeof t){var i=t;t=e.views[i],t||(console.warn("(meta.setView) Creating empty view, could be unintended - "+i),t=new meta.View(i),e.views[i]=t)}t.active||(e.view.detachViews(),e.view.attachView(t))},meta.getView=function(t){if(!t)return console.error("(meta.getView) No name specified"),null;var e=meta.cache.views[t];return e||(e=new meta.View(t),meta.cache.views[t]=e),e},meta.attachView=function(t){if(!meta.cache.view)return console.warn("(meta.attachView) No current active view"),void 0;if("string"==typeof t){var e=meta.cache.views[t];if(!e)return console.warn("(meta.attachView) No such view found: "+t),void 0;t=e}meta.cache.view.attachView(t)},meta.detachView=function(t){if(!meta.cache.view)return console.warn("(meta.detachView) No current active view."),void 0;if("string"==typeof t){var e=meta.cache.views[t];if(!t)return console.warn("(meta.detachView) No such view found: "+t),void 0;t=e}meta.cache.view.detachView(t)},Object.defineProperty(meta,"view",{set:function(t){meta.setView(t)},get:function(){return meta.cache.view}}),"use strict",meta.Camera=function(){this.volume=new meta.math.AABBext(0,0,0,0),this.zoomBounds=null,this._autoZoom=!1,this._zoom=1,this.prevZoom=1,this.zoomRatio=1,this._draggable=!1,this._dragging=!1,this._center=!1,this._centerX=!0,this._centerY=!0,this._useWorldBounds=!1,this._chnMove=null,this._chnResize=null,this._wasMoved=!1,this.init()},meta.Camera.prototype={init:function(){this._chnMove=meta.createChannel(meta.Event.CAMERA_MOVE),this._chnResize=meta.createChannel(meta.Event.CAMERA_RESIZE),meta.subscribe(this,meta.Event.RESIZE,this._onResize),meta.subscribe(this,meta.Event.WORLD_RESIZE,this._onWorldResize),this.zoomBounds={width:-1,height:-1,minWidth:-1,minHeight:-1,maxWidth:-1,maxHeight:-1}},release:function(){this._chnMove.release(),meta.unsubscribe(this,meta.Event.RESIZE),meta.unsubscribe(this,meta.Event.WORLD_RESIZE)},updateView:function(){this._autoZoom?this.updateAutoZoom():this.updateZoom();var t=meta.world;if(!this._wasMoved){var e=0,i=0;this._center?(e=this._centerX?Math.floor((this.volume.width-t.width)/2):0,i=this._centerY?Math.floor((this.volume.height-t.height)/2):0):(e=0,i=0),this.volume.move(e,i)}this._chnMove.emit(this,meta.Event.CAMERA_MOVE)},updateZoom:function(){this.prevZoom!==this._zoom&&(this.zoomRatio=1/this._zoom,this.volume.scale(this.zoomRatio,this.zoomRatio),this._chnResize.emit(this,meta.Event.CAMERA_RESIZE))},updateAutoZoom:function(){var t=meta,e=this.zoomBounds.width,i=this.zoomBounds.height,n=t.width/e,s=t.height/i;this.prevZoom=this._zoom,this._zoom=n,n>s&&(this._zoom=s),t.engine.adapt()&&(e=this.zoomBounds.width,i=this.zoomBounds.height,n=t.width/e,s=t.height/i,this._zoom=n,n>s&&(this._zoom=s),this.volume.resize(t.width,t.height)),this.updateZoom()},bounds:function(t,e){this._autoZoom=!0,this.zoomBounds.width=t,this.zoomBounds.height=e,(0!==this.width||0!==this.height)&&this.updateView()},minBounds:function(t,e){this._autoZoom=!0,this.zoomBounds.minWidth=t,this.zoomBounds.minHeight=e,this.updateView()},maxBounds:function(t,e){this._autoZoom=!0,this.zoomBounds.maxWidth=t,this.zoomBounds.maxHeight=e,this.updateView()},_onInput:function(t,e){var i=Input.Event;if(e===i.MOVE)this._drag(t);else if(e===i.DOWN){if(0!==t.keyCode)return;this._startDrag(t)}else if(e===i.UP){if(0!==t.keyCode)return;
this._endDrag(t)}},_onResize:function(t,e){this.volume.resize(t.width,t.height),this.updateView(),this._chnResize.emit(this,meta.Event.CAMERA_RESIZE)},_onWorldResize:function(t,e){this.updateView()},_startDrag:function(t){this._draggable&&(this._dragging=!0)},_endDrag:function(t){this._dragging=!1},_drag:function(t){if(this._dragging){var e=meta,i=(t.screenX-t.prevScreenX)*this.zoomRatio,n=(t.screenY-t.prevScreenY)*this.zoomRatio;if(this._wasMoved=!0,this._useWorldBounds){var s=meta.world,o=s.volume,r=this.volume.minX-i,h=this.volume.minY-n;r<o.minX?i-=o.minX-r:r+this.volume.width>o.maxX&&(i=this.volume.maxX-o.maxX),h<o.minY?n-=o.minY-h:h+this.volume.height>o.maxY&&(n=this.volume.maxY-o.maxY)}this.volume.move(-i,-n),this._x=this.volume.minX,this._y=this.volume.minY,this._chnMove.emit(this,e.Event.CAMERA_MOVE),meta.renderer.needRender=!0}},set x(t){this._x!==t&&(this._x=t,this._wasMoved=!0,this.updateView())},set y(t){this._y!==t&&(this._y=t,this._wasMoved=!0,this.updateView())},get x(){return this.volume.x},get y(){return this.volume.y},get width(){return this.volume.width},get height(){return this.volume.height},set zoom(t){this._zoom!==t&&(this.prevZoom=this._zoom,this._zoom=t,this.updateView())},get zoom(){return this._zoom},set enableBorderIgnore(t){this._enableBorderIgnore=t,this.updateView()},get enableBorderIgnore(){return this._enableBorderIgnore},set draggable(t){if(this._draggable!==t){this._draggable=t;var e=[Input.Event.DOWN,Input.Event.UP,Input.Event.MOVE];t?meta.subscribe(this,e,this._onInput):(meta.unsubscribe(this,e),this._dragging=!1)}},get draggable(){return this._draggable},set autoZoom(t){this._autoZoom!==t&&(this._autoZoom=t,this.updateView())},get autoZoom(){return this._autoZoom},set useWorldBounds(t){this._useWorldBounds!==t&&(this._useWorldBounds=t,this.updateView())},get useWorldBounds(){return this._useWorldBounds},set center(t){this._center=t,this.updateView()},set centerX(t){this._centerX=t,this.updateView()},set centerY(t){this._centerY=t,this.updateView()},get center(){return this._center},get centerX(){return this._centerX},get centerY(){return this._centerY}},"use strict",meta.World=meta.class.extend({init:function(t,e){this.volume=new meta.math.AABB(0,0,0,0),this._chn=meta.createChannel(meta.Event.WORLD_RESIZE)},bounds:function(t,e,i,n){this.volume.set(t,e,i-t,n-e),this.centerX=t+(i-t)/2,this.centerY=e+(n-e)/2,this._adapt=!1,this._chn.emit(this,meta.Event.WORLD_RESIZE)},updateAdapt:function(){if(this._adapt){var t=meta.camera.volume;this.volume.set(0,0,t.width,t.height),this.centerX=t.width/2,this.centerY=t.height/2,this._chn.emit(this,meta.Event.WORLD_RESIZE)}},onResize:function(t,e){this.updateAdapt()},get randX(){return meta.random.number(this.volume.minX,this.volume.maxX)},get randY(){return meta.random.number(this.volume.minY,this.volume.maxY)},set adapt(t){this._adapt=t,t&&this.updateAdapt()},get adapt(){return this._adapt},get width(){return this.volume.width},get height(){return this.volume.height},volume:null,centerX:0,centerY:0,_chn:null,_adapt:!0}),"use strict",function(t){var e=!1,i=/\b_super\b/;t.meta.class=function(){},t.meta.class.extend=function(t){function n(t,i,n,s,o,r){e||(this._init&&this._init(t,i,n,s,o,r),this.init&&this.init(t,i,n,s,o,r))}var s=this.prototype;e=!0;var o=new this;e=!1;for(var r in t){var h=Object.getOwnPropertyDescriptor(t,r);h.get||h.set?Object.defineProperty(o,r,h):o[r]="function"==typeof t[r]&&"function"==typeof s[r]&&i.test(t[r])?function(t,e){return function(i,n,o,r,h,a){var c=this._super;this._super=s[t],this._fn=e;var u=this._fn(i,n,o,r,h,a);return this._super=c,u}}(r,t[r]):t[r]}return n.prototype=o,n.prototype.constructor=o.init,n.extend=this.extend,n},t.meta.class=t.meta.class}(void 0!==typeof window?window:global),"use strict",meta.Controller=meta.class.extend({_init:function(t){this.view=t},release:null,load:null,ready:null,update:null,render:null,view:null,name:"unknown",loaded:!1}),meta.register=function(t){var e=window[t];if(!e||!e.Controller)return console.error("(meta.register) No such controllers found - "+t),null;if(e.ctrl)return console.error("(meta.register) Controller ("+t+") is already added in scope."),null;var i=new e.Controller(meta.view);return i.name=t,e.ctrl=i,meta.engine.ctrls.push(i),i.load&&meta.engine.loadedCtrls&&i.load(),i.ready&&meta.engine.ready&&i.ready(),i.update&&meta.engine.ctrlsUpdateFuncs.push(i),i},meta.unregister=function(t){var e=window[t];return e&&e.Controller?e.ctrl?(meta.engine.ctrlsRemove.push(e),void 0):(console.error("(meta.unregister) No such controllers initialized - "+t),null):(console.error("(meta.unregister) No such controllers found - "+t),null)},"use strict",meta.Timer=function(t,e,i,n){this.owner=t,this.id=meta.cache.timerIndex++,this.func=e,this.onRemove=null,this.tDelta=i,this.numTimes=n,void 0===this.numTimes&&(this.numTimes=-1),this.tAccumulator=0,this.tStart=Date.now()},meta.Timer.prototype={stop:function(){this.owner=null,this.func=null,this.numTimes=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.tStart=Date.now()},reset:function(){this.tAccumulator=0,this.paused=!1},onRemove:null,paused:!1},meta.addTimer=function(t,e,i,n){if("function"==typeof t&&(n=i,i=e,e=t,t=window),!e)return console.warn("(meta.addTimer) Invalid function passed"),void 0;var s=new meta.Timer(t,e,i,n);return s.__index=meta.engine.timers.length,meta.engine.timers.push(s),s},"use strict",meta.Style=function(t){this.states={},this.setStates(t),this.defaultState||this.setState("*",null)},meta.Style.prototype={setState:function(t,e){if(-1!==t.indexOf(","))for(var i=t.split(/[ ,]+/),n=i.length,s=0;n>s;s++)this.defineState(i[s],e);else this.defineState(t,e)},defineState:function(t,e){var i,n,s,o,r;if("string"==typeof e&&(e={texture:e}),"["===t.charAt(0))return t=t.substr(1,t.length-2),this.childStyle||(this.childStyle=new meta.Style),this.childStyle.setState(t,e),void 0;var h=t.indexOf(":");if(-1!==h){var a=t.substr(h+1,t.length-h-1);t=t.substr(0,h),t||(t="*"),i=this.states[t],i?i.actions||(i.actions={}):(i=new meta.StyleState(t),i.actions={},this.states[t]=i);var c;if("*"===t){this.defaultState=i;for(s in this.states)if(r=this.states[s],r.actions&&(c=r.actions[a],c)){n=c.params;for(o in e)n[o]||(n[o]=e[o])}}else if(this.defaultState&&this.defaultState.actions&&(c=this.defaultState.actions[a],c)){n=c.params;for(o in n)e[o]||(e[o]=n[o])}i.actions[a]=new meta.StyleState(a,e),this.haveActions=!0}else if(t||(t="*"),i=this.states[t],i){n=i.params;for(o in n)n[o]||(n[o]=e[o]);i._updateTexture()}else{if(this.defaultState){n=this.defaultState.params;for(o in n)e[o]||(e[o]=n[o])}if(i=new meta.StyleState(t,e),"*"===t){this.defaultState=i;for(s in this.states){n=this.states[s].params;for(o in e)n[o]||(n[o]=e[o])}}this.states[t]=i}return this},setStates:function(t){for(var e in t)this.setState(e,t[e])},removeState:function(t){return this.states[t]?(delete this.states[t],void 0):(console.warn("(meta.Brush.removeState) No such state: "+t),void 0)},update:function(t){if(this.states){var e=this.states[t._state];if(!e){if(!this.defaultState)return console.warn("(meta.Style.update) Could not get state from the style: "+t._state),void 0;e=this.defaultState}if(e!==t._styleState){var i,n,s,o=e.params,r=t._styleParams;if(o){for(i in r)if(!o[i])if(n=r[i],n instanceof meta.StylePaste){var h=t[i];for(s in n)t[s]=n[s]}else t[i]=r[i];r={},t._styleParams=r;for(i in o)if(n=o[i],n instanceof meta.StyleCopy){n=n.param;var h=t[i],a=new meta.StylePaste;r[i]=a;for(s in n)a[s]=t[i],h[s]=n[i]}else r[i]=t[i],t[i]=o[i]}else for(i in r)t[i].constructor===Object?this._applyParam(i,t,r[i]):t[i]=r[i];t._styleState=e}}},_applyParam:function(t,e,i){if(i.constructor===Object){var n=e[t];for(var s in n)this._applyParam(s,n,i[s])}else e[t]=i},updateAction:function(t){var e=t._styleActionParams;for(var i in e)t[i]=e[i];e={},t._styleActionParams=e;var n,s=this.states[t._state];if(!s){if(!this.defaultState)return;s=this.defaultState}if(s.actions)n=s.actions[t._action];else{if(!this.defaultState.actions)return;n=this.defaultState.actions[t._action]}if(n){var o=n.params;for(var i in o)e[i]=t[i],t[i]=o[i]}},getRandomState:function(){if(!this.states)return null;var t=null,e=0;for(var i in this.states)Math.random()<1/++e&&(t=i);return t},states:null,defaultState:null,haveActions:!1,childStyle:null},meta.StyleState=function(t,e){this.name=t,this.params=e,this._update()},meta.StyleState.prototype={_update:function(){if(this.params&&void 0!==this.params.texture){var t=this.params.texture;if("string"!=typeof t)return;var e=meta.getTexture(t);if(!e)return console.warn("(meta.StyleState) Could not get texture from texture name: "+t),void 0;this.params.texture=e}for(var i in this.params)"@"===i.charAt(0)&&(this.params[i.substr(1)]=new meta.StyleCopy(this.params[i]),delete this.params[i])}},meta.StyleCopy=function(t){this.param=t},meta.StylePaste=function(){},meta.createStyle=function(t,e){if(!t)return e?e:null;e=e||null;var i=Object.create(e);if("string"==typeof t||t instanceof Resource.Texture)i["*"]?i["*"].texture=t:i["*"]={texture:t};else if("object"==typeof t){var n,s,o,s,r,h,a,c,u,l,d;for(s in t)if(n=t[s],"string"==typeof n&&(n={texture:n}),-1!==s.indexOf(","))for(l=s.split(/[ ,]+/),d=l.length,r=0;d>r;r++){if(u=l[r],a=i[u],a){c={};for(h in a)c[h]=a[h];a=c}else a={};for(h in n)a[h]=n[h];i[u]=a}else{if(a=i[s],a){c={};for(h in a)c[h]=a[h];a=c}else a={};for(h in n)a[h]=n[h];i[s]=a}}return i},"use strict",meta.Event={RESIZE:"resize",WORLD_RESIZE:"world-resize",CAMERA_MOVE:"camera-move",CAMERA_RESIZE:"camera-resize",FOCUS:"focus",FULLSCREEN:"fullscreen",ADAPT:"adapt",DEBUG:"debug"},meta.Priority={LOW:0,MEDIUM:5e3,HIGH:1e4},meta.Cursor={ALIAS:"alias",ALL_SCROLL:"all-scroll",CELL:"cell",CONTEXT_MENU:"context-menu",COL_RESIZE:"col-resize",COPY:"copy",CROSSHAIR:"crosshair",DEFAULT:"default",E_RESIZE:"e-resize",EW_RESIZE:"ew-resize",GRAB:"grab",GRABBING:"grabbing",HELP:"help",MOVE:"move",N_RESIZE:"n-resize",NE_RESIZE:"ne-resize",NESW_RESIZE:"nesw-resize",NS_RESIZE:"ns-reisize",NW_RESIZE:"nw-resize",NWSE_RESIZE:"nwse-resize",NO_DROP:"no-drop",NONE:"none",NOT_ALLOWED:"not-allowed",POINTER:"pointer",PROGRESS:"progress",ROW_RESIZE:"row-resize",S_RESIZE:"s-resize",SE_RESIZE:"se-resize",SW_RESIZE:"sw-resize",TEXT:"text",VERTICAL_TEXT:"vertical-text",W_RESIZE:"w-resize",WAIT:"wait",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",INITIAL:"initial"},"use strict",meta.getTexture=function(t){return Resource.ctrl.getTexture(t)},"use strict",meta.ajax=function(params){params.responseType="html"===params.dataType?"document":"script"===params.dataType||"json"===params.dataType?"text":void 0===params.dataType?"GET":params.dataType,void 0===params.type&&(params.type="GET");var data=meta.serialize(params.data),xhr=new XMLHttpRequest;return xhr.open(params.type,params.url,!0),xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhr.onload=function(){4===xhr.readyState&&200===xhr.status?void 0!==params.success&&params.success("document"===params.responseType?xhr.responseXML:"script"===params.dataType?eval(xhr.responseText):"json"===params.dataType?JSON.parse(xhr.responseText):xhr.responseText):void 0!==params.error&&params.error()},xhr.send(data),xhr},"use strict",meta.math={},meta.math={degToRad:function(t){return t*Math.PI/180},radToDeg:function(t){return 180*t/Math.PI},radiansToPoint:function(t,e,i,n){var s=i-t,o=n-e;return Math.atan(s/o)},clamp:function(t,e,i){return e>t?e:t>i?i:t},map:function(t,e,i,n,s){return t==e?n:(t-e)*(s-n)/(i-e)+n},length:function(t,e,i,n){var s=i-t,o=n-e;return Math.sqrt(s*s+o*o)},length2:function(t,e){return Math.sqrt(t*t+e*e)},limit:function(t,e){return t>e?e:-e>t?-e:t},lerp:function(t,e,i){return t+(e-t)*i},lookAt:function(t,e,i,n){return Math.atan2(i-t,e-n)},lookAtEntity:function(t,e){return meta.math.lookAt(t.x,t.y,e.x,e.y)}},"use strict",meta.math.Vector2=function(t,e){this.x=t,this.y=e},meta.math.Vector2.prototype={reset:function(){this.x=0,this.y=0},set:function(t,e){this.x=t,this.y=e},add:function(t){this.x+=t,this.y+=t},sub:function(t){this.x-=t,this.y-=t},mul:function(t){this.x*=t,this.y*=t},div:function(t){this.x/=t,this.y/=t},addVec2:function(t){this.x+=t.x,this.y+=t.y},subVec2:function(t){this.x-=t.x,this.y-=t.y},mulVec2:function(t){this.x*=t.x,this.y*=t.y},divVec2:function(t){this.x/=t.x,this.y/=t.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);t>0?(this.x/=t,this.y/=t):(this.x=0,this.y=0)},dot:function(t){return this.x*t.x+this.y*t.y},truncate:function(t){var e=Math.sqrt(this.x*this.x+this.y*this.y);e>t&&(this.x*=t/e,this.y*=t/e)},limit:function(t){this.x>t?this.x=t:this.x<-t&&(this.x=-t),this.y>t?this.y=t:this.y<-t&&(this.y=-t)},lengthSq:function(){return this.x*this.x+this.y*this.y},heading:function(){var t=Math.atan2(-this.y,this.x);return-t+.5*Math.PI},perp:function(){var t=this.x;this.x=-this.y,this.y=t},print:function(t){console.log(t?'[vec "'+t+'"] x: '+this.x+" y: "+this.y:"[vec] x: "+this.x+" y: "+this.y)}},"use strict",meta.math.AABB=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.pivotPosX=this.width*this.pivotX,this.pivotPosY=this.height*this.pivotY,this.minX=this.x,this.minY=this.y,this.maxX=this.x+this.width,this.maxY=this.y+this.height},meta.math.AABB.prototype={set:function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.pivotPosX=this.width*this.pivotX,this.pivotPosY=this.height*this.pivotY,this.minX=this.x,this.minY=this.y,this.maxX=this.x+this.width,this.maxY=this.y+this.height},position:function(t,e){this.x=t,this.y=e,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},move:function(t,e){this.x+=t,this.y+=e,this.minX+=t,this.minY+=e,this.maxX+=t,this.maxY+=e},resize:function(t,e){this.width=0|t,this.height=0|e,this.pivotPosX=this.width*this.pivotX,this.pivotPosY=this.height*this.pivotY,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},pivot:function(t,e){void 0===e&&(e=t),this.pivotX=t,this.pivotY=e,this.pivotPosX=this.width*this.pivotX,this.pivotPosY=this.height*this.pivotY,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},vsAABB:function(t){return this.maxX<t.minX||this.minX>t.maxX?!1:this.maxY<t.minY||this.minY>t.maxY?!1:!0},vsBorderAABB:function(t){return this.maxX<=t.minX||this.minX>=t.maxX?!1:this.maxY<=t.minY||this.minY>=t.maxY?!1:!0},vsAABBIntersection:function(t){return this.maxX<t.minX||this.minX>t.maxX?0:this.maxY<t.minY||this.minY>t.maxY?0:this.minX>t.minX||this.minY>t.minY?1:this.maxX<t.maxX||this.maxY<t.maxY?1:2},vsPoint:function(t,e){return this.minX>t||this.maxX<t?!1:this.minY>e||this.maxY<e?!1:!0},vsBorderPoint:function(t,e){return this.minX>=t||this.maxX<=t?!1:this.minY>=e||this.maxY<=e?!1:!0},getSqrDistance:function(t,e){var i,n=0;return t<this.minX&&(i=this.minX-t,n+=i*i),t>this.maxX&&(i=t-this.maxX,n+=i*i),e<this.minY&&(i=this.minY-e,n+=i*i),e>this.maxY&&(i=e-this.maxY,n+=i*i),n},getDistanceVsAABB:function(t){var e=this.minX+(this.maxX-this.minX)/2,i=this.minY+(this.maxY-this.minY)/2,n=t.minX+(t.maxY-t.minY)/2,s=t.minY+(t.maxY-t.minY)/2,o=n-e,r=s-i;return Math.sqrt(o*o+r*r)},isUndefined:function(){return void 0===this.maxY},genCircle:function(){var t=this.maxX-this.minX,e=this.maxY-this.minY,i;return i=t>e?t/2:e/2,new meta.math.Circle(this.x,this.y,i)},print:function(t){console.log(t?"(AABB) "+t+" minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY:"(AABB) minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY)},pivotX:0,pivotY:0},"use strict",meta.math.AABBext=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.initWidth=0,this.initHeight=0,this.minX=0,this.minY=0,this.maxX=0,this.maxY=0},meta.math.AABBext.prototype={position:function(t,e){this.x=t,this.y=e,this.minX=this.absX-this.pivotPosX,this.minY=this.absY-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},move:function(t,e){this.x+=t,this.y+=e,this.minX+=t,this.minY+=e,this.maxX+=t,this.maxY+=e},updatePos:function(){this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},pivot:function(t,e){void 0===e&&(e=t),this.pivotX=t,this.pivotY=e,this.initPivotPosX=this.initWidth*this.pivotX|0,this.initPivotPosY=this.initHeight*this.pivotY|0,this.updatePivotPos()},updatePivotPos:function(){this.pivotPosX=this.scaleX>0?this.pivotX*this.width:(1-this.pivotX)*this.width,this.pivotPosY=this.scaleY>0?this.pivotY*this.height:(1-this.pivotY)*this.height,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},resize:function(t,e){this.initWidth=t,this.initHeight=e,this.initPivotPosX=t*this.pivotX|0,this.initPivotPosY=e*this.pivotY|0,this.width=t*Math.abs(this.scaleX)|0,this.height=e*Math.abs(this.scaleY)|0,this.updatePivotPos()},scale:function(t,e){this.scaleX=t*this.flipX,this.scaleY=e*this.flipY,this.width=Math.floor(this.initWidth*t),this.height=Math.floor(this.initHeight*e),this.updatePosTransform()},flip:function(t,e){void 0===t?(this.flipX=-this.flipX,this.scaleX*=-1):this.flipX!==t&&(this.flipX=t,this.scaleX*=-1),void 0===e||this.flipY!==e&&(this.flipY=e,this.scaleY*=-1),this.updatePosTransform()},rotate:function(t){this.angle=t,this.sin=Math.sin(t),this.cos=Math.cos(t),this.m11=this.cos*this.scaleX,this.m12=this.sin*this.scaleX,this.m21=-this.sin*this.scaleY,this.m22=this.cos*this.scaleY,this.__transformed=1},updatePosTransform:function(){this.pivotPosX=this.scaleX>0?this.pivotX*this.width:(1-this.pivotX)*this.width,this.pivotPosY=this.scaleY>0?this.pivotY*this.height:(1-this.pivotY)*this.height,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height,this.m11=this.cos*this.scaleX,this.m12=this.sin*this.scaleX,this.m21=-this.sin*this.scaleY,this.m22=this.cos*this.scaleY,this.__transformed=1},vsAABB:function(t){return this.maxX<=t.minX||this.minX>=t.maxX?!1:this.maxY<=t.minY||this.minY>=t.maxY?!1:!0},vsAABBIntersection:function(t){return this.maxX<t.minX||this.minX>t.maxX?0:this.maxY<t.minY||this.minY>t.maxY?0:this.minX>=t.minX||this.minY>=t.minY?1:this.maxX<=t.maxX||this.maxY<=t.maxY?1:2},vsPoint:function(t,e){return this.minX>=t||this.maxX<=t?!1:this.minY>=e||this.maxY<=e?!1:!0},getSqrDistance:function(t,e){var i,n=0;return t<this.minX&&(i=this.minX-t,n+=i*i),t>this.maxX&&(i=t-this.maxX,n+=i*i),e<this.minY&&(i=this.minY-e,n+=i*i),e>this.maxY&&(i=e-this.maxY,n+=i*i),n},getDistanceVsAABB:function(t){var e=this.minX+(this.maxX-this.minX)/2,i=this.minY+(this.maxY-this.minY)/2,n=t.minX+(t.maxY-t.minY)/2,s=t.minY+(t.maxY-t.minY)/2,o=n-e,r=s-i;return Math.sqrt(o*o+r*r)},genCircle:function(){var t=this.maxX-this.minX,e=this.maxY-this.minY,i;return i=t>e?t/2:e/2,new meta.math.Circle(this.x,this.y,i)},print:function(t){console.log(t?"(Volume) "+t+" minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY:"(Volume) minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY)},pivotX:0,pivotY:0,pivotPosX:0,pivotPosY:0,initPivotPosX:0,initPivotPosY:0,anchorPosX:0,anchorPosY:0,scaleX:1,scaleY:1,flipX:1,flipY:1,angle:0,sin:0,cos:1,m11:1,m12:0,m21:0,m22:1,__transformed:0},"use strict",meta.math.Circle=function(t,e,i){this.x=t,this.y=e,this.radius=i},meta.math.Circle.prototype={vsPoint:function(t,e){return 2*(this.x-t)+2*(this.y-e)<=2*radius},vsCircle:function(t){var e=this.radius+t.radius;e*=e;var i=this.x+t.x;i*=i;var n=this.y+t.y;return n*=n,i+n>e},overlapCircle:function(t){var e=Math.sqrt((this.x-t.x)*(this.y-t.y));return e>this.radius+t.radius?0:e<=Math.abs(this.radius+t.radius)?1:2},genAABB:function(){return new meta.math.AABB(this.x-this.radius,this.y-this.radius,this.x+this.radius,this.y+this.radius)},print:function(t){t?console.log("["+t+"] x:",this.x,"y:",this.y,"raidus:",this.radius):console.log("x:",this.x,"y:",this.y,"raidus:",this.radius)}},"use strict",meta.math.Matrix4=function(){this.m=new Float32Array(16),this.m[0]=1,this.m[5]=1,this.m[10]=1,this.m[15]=1},meta.math.Matrix4.prototype={reset:function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=1,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=1,this.m[11]=0,this.m[12]=0,this.m[13]=0,this.m[14]=0,this.m[15]=1},scale:function(t,e,i){this.m[0]=t,this.m[5]=e,this.m[10]=i},ortho:function(t,e,i,n,s,o){this.m[0]=2/(e-t),this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=2/(n-i),this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=-2/(o-s),this.m[11]=0,this.m[12]=-(e+t)/(e-t),this.m[13]=-(n+i)/(n-i),this.m[14]=-(o+s)/(o-s),this.m[15]=1}},"use strict",meta.math.Random=function(){this.seed=0,this.a=0,this.m=0,this.q=0,this.r=0,this.oneOverM=0,this.init()},meta.math.Random.prototype={init:function(){this.setSeed(3456789012,!0)},generate:function(){var t=Math.floor(this.seed/this.q),e=this.seed%this.q,i=this.a*e-this.r*t;return this.seed=i>0?i:i+this.m,this.seed*this.oneOverM},number:function(t,e){var i=this.generate();return Math.round((e-t)*i+t)},numberF:function(t,e){var i=this.generate();return(e-t)*i+t},setSeed:function(t,e){if(void 0!==e&&(e=!0),e===!0){var i=new Date;this.seed=t+16777215*i.getSeconds()+65535*i.getMinutes()}else this.seed=t;this.a=48271,this.m=2147483647,this.q=Math.floor(this.m/this.a),this.r=this.m%this.a,this.oneOverM=1/this.m}},meta.random=new meta.math.Random,"use strict",meta.Tween=function(){this.cache=null,this.chain=[]},meta.Tween.prototype={play:function(){if(this.cache){var t=this.cache;if(!t.owner)return this;if(t.owner.removed)return this;t.paused=!1,t.numRepeat=this.numRepeat,t._tFrame=meta.time.update,this.next(),this._play(),this.cache=null}else this.autoPlay=!0;return this},_play:function(){meta.renderer.addTween(this.cache)&&this._group&&this._group.activeUsers++},stop:function(t){return this.cache.currLink=null,this.cache.linkIndex=0,meta.renderer.removeTween(this.cache)&&(t&&t(this.cache.owner),this._group&&(this._group.activeUsers--,0===this._group.activeUsers&&this._group.callback&&this._group.callback())),this},paused:function(t){return void 0===t&&(t=!0),this.cache.paused=t,this},resume:function(){return this.cache.paused=!1,this},clear:function(){return this.stop(null),this.chain.length=0,this._group&&(this._group.users--,this._group=null),this},reset:function(){var t=this.cache;if(t.linkIndex=0,t.currLink=this.chain[0],!t.currLink)return this;for(var e in t.currLink.startValues)t.owner[e]=t.currLink.startValues[e];return this.stop(!1),this},next:function(){var t=!1,e=this.cache;if(e.linkIndex===this.chain.length){if(0===e.numRepeat)return this.stop(),this;if(e.linkIndex=0,-1!==e.numRepeat&&(e.numRepeat--,0===e.numRepeat))return this.onDone&&this.onDone.call(this.cache.owner),this.stop(),this;t=!0}e._isLinkDone=!1;var i,n=this.chain[e.linkIndex++],s=e.owner;if(t)for(i in n.startValues)s[i]=n.startValues[i];else for(i in n.endValues)n.startValues[i]=s[i];return n._onStart&&n._onStart.call(this),e._tStart=meta.time.update,e.currLink=n,this},repeat:function(t){return void 0===t&&(t=-1),this.numRepeat=t,this},set reverse(t){return void 0===t&&(t=!0),this.cache.isReverse=t,this},get reverse(){return this.cache.isReverse},update:function(t){var e=this.cache;if(!e.currLink)return this.stop(!1),void 0;var i=meta.time.update,n=i-e._tFrame;if(!(n<e.currLink.tFrameDelay)){var s=(i-e._tStart)/e.currLink.duration;if(s>1&&(s=1),e._isLinkDone){if(n<e.currLink.tDelay)return}else e._tFrame=i,e.currLink.update(s),e.currLink._onTick&&e.currLink._onTick.call(this);if(1===s){if(!e._isLinkDone&&e.currLink.tDelay>0)return e._isLinkDone=!0,void 0;this.next()}}},to:function(t,e,i){var n=new meta.Tween.Link(this,t,e,i);return this.chain.push(n),n},wait:function(t){var e=this.to(null,0,null);return e.wait(t),e},group:function(t){return t?this._group?(console.warn("(meta.Tween.group) Tween already is part of a group."),this):("object"==typeof t&&(this._group=t),this._group.users++,this):(console.warn("(meta.Tween.group) No group name specified."),this)},autoPlay:!1,_group:null,_removeFlag:0,numRepeat:0},meta.Tween.Cache=function(t){this.owner=t,this.tween=null,this.linkIndex=0,this.currLink=null,this.numRepeat=0,this.onDone=null,this.__index=-1,this.__removed=0,this._isLinkDone=!1,this._tStart=0,this._tFrame=0},meta.Tween.Cache.prototype={update:function(t){this.tween.cache=this,this.tween.update(t),this.tween.cache=null},stop:function(){this.tween.cache=this,this.tween.stop(),this.tween.cache=null},paused:!1,removed:!1,reverse:!1,_flags:0},meta.Tween.Group=function(t,e){"function"==typeof t&&(e=t,t=""),this.name=t,this.users=0,this.activeUsers=0,this.callback=e||null},"use strict",meta.Tween.Easing={linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintIntOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineIntOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)))},elasticOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/n)+1)},elasticInOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n):i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)*.5+1)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:function(t){return 1-meta.Tween.Easing.bounceOut(1-t)},bounceOut:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return.5>t?.5*meta.Tween.Easing.bounceIn(2*t):.5*meta.Tween.Easing.bounceOut(2*t-1)+.5}},"use strict",meta.Tween.Link=function t(e,i,n,s){this.tween=e,this.startValues={},this.endValues=i,this.duration=n,this._onDone=s||null},meta.Tween.Link.prototype={play:function(){return this.tween.play(),this},stop:function(){return this.tween.stop(),this},paused:function(t){return this.tween.paused(t),this},resume:function(){return this.tween.resume(),this},clear:function(){return this.tween.clear(),this},reset:function(){return this.tween.reset(),this},update:function(t){var e=this._easing(t),i,n,s,o=this.tween.cache.owner;for(var r in this.endValues)i=this.startValues[r],n=this.endValues[r],"string"==typeof i&&(n=i+parseFloat(n,4)),s=i+(n-i)*e,this.isRounding&&(s=Math.round(s)),o[r]=s},next:function(){return this.tween.next(),this},wait:function(t){return this.tDelay=t,this},frameDelay:function(t){return this.tFrameDelay=t,this},round:function(t){return void 0===t&&(t=!0),this.isRounding=t,this},repeat:function(t){return this.tween.repeat(t),this},reverse:function(t){return this.tween.reverse(t),this},easing:function(t){return this._easing="function"==typeof t?t:meta.Tween.Easing[t],void 0===this._easing&&(this._easing=meta.Tween.Easing.linear),this},onStart:function(t){return this._onStart=t,this},onDone:function(t){return this.tween.onDone=t,this},onTick:function(t){return this._onTick=t,this},to:function(t,e,i){return this.tween.to(t,e,i)},group:function(t){return this.tween.group(t)},_easing:meta.Tween.Easing.linear,_onStart:null,_onDone:null,_onTick:null,tDelay:0,tFrameDelay:0,isRounding:!1},"use strict",meta.Renderer=meta.class.extend({init:function(){this.holder=new Entity.Geometry,Entity.Geometry.prototype.renderer=this,Entity.Geometry.prototype.parent=this.holder},load:function(){this.engine=meta.engine,this.camera=meta.camera,this.cameraDefault=this.camera,this.cameraUI=new meta.Camera,this.chn={onDown:meta.createChannel(Entity.Event.INPUT_DOWN),onUp:meta.createChannel(Entity.Event.INPUT_UP),onClick:meta.createChannel(Entity.Event.CLICK),onDbClick:meta.createChannel(Entity.Event.DBCLICK),onDrag:meta.createChannel(Entity.Event.DRAG),onDragStart:meta.createChannel(Entity.Event.DRAG_START),onDragEnd:meta.createChannel(Entity.Event.DRAG_END),onHover:meta.createChannel(Entity.Event.HOVER),onHoverEnter:meta.createChannel(Entity.Event.HOVER_ENTER),onHoverExit:meta.createChannel(Entity.Event.HOVER_EXIT)},meta.subscribe(this,[Input.Event.DOWN,Input.Event.UP],this.onInput,meta.Priority.HIGH),meta.subscribe(this,Input.Event.MOVE,this.onInputMove,meta.Priority.HIGH),meta.subscribe(this,Input.Event.DBCLICK,this.onInputDbClick,meta.Priority.HIGH),meta.subscribe(this,meta.Event.ADAPT,this.onAdapt),meta.subscribe(this,meta.Event.RESIZE,this.onResize),meta.subscribe(this,meta.Event.CAMERA_MOVE,this.onCameraMove),this.holder.resize(this.camera.volume.width,this.camera.volume.height)},update:function(t){this.__updating=!0;for(var e=null,i=0,n=this.entitiesToUpdate.length,s=0;n>s;s++)this.entitiesToUpdate[s].update(t);if(this.tweens.length>0){var o=this.tweens.length,r=this.tweensRemove.length;if(r>0){var h;for(s=0;r>s;s++)i=this.tweensRemove[s],h=this.tweens[i],h&&h.__removed&&(o--,h.__index=-1,h.__removed=0,this.tweens[i]=this.tweens[o]);this.tweens.length=o,this.tweensRemove.length=0}for(s=0;o>s;s++)this.tweens[s].update(t)}if(this.__updating=!1,this.entitiesRemove.length>0&&(this._removeEntities(this.entitiesRemove),this.entitiesRemove.length=0),this._removeUpdating.length>0){var a,c;for(n=this._removeUpdating.length,s=0;n>s;s++)a=this._removeUpdating[s],c=this.entitiesToUpdate[this.entitiesToUpdate.length-1],c.__updateIndex=a,this.entitiesToUpdate[a]=c,this.entitiesToUpdate.pop();this._removeUpdating.length=0}if(this.entitiesAnimRemove.length>0){var u=null,l=this.entitiesAnim.length;for(n=this.entitiesAnimRemove.length,s=0;n>s;s++)i=this.entitiesAnimRemove[s],u=this.entitiesAnim[i],u.__removed&&(l--,u.__index=-1,u.__removed=0,this.entitiesAnim[i]=this.entitiesAnim[l]);this.entitiesAnim.length=l,this.entitiesAnimRemove.length=0}this.needSortDepth&&(this.entities.sort(this._sortEntities),this.entitiesPicking.sort(this._sortEntities),this.entitiesUI.sort(this._sortEntities),this.needSortDepth=!1,this.needRender=!0)},_sortEntities:function(t,e){return t.totalZ-e.totalZ},addEntity:function(t){t.__ui?(this.entitiesUI.push(t),this._addEntity(t),t.children&&this.addEntitiesUI(t.children)):(this.entities.push(t),this._addEntity(t),t.children&&this.addEntities(t.children))},addEntityUI:function(t){this.entitiesUI.push(t),this._addEntity(t),t.children&&this.addEntitiesUI(t.children)},_addEntity:function(t){t.__added=!0,t.update&&this.addUpdating(t),0!==t._z&&(this.needSortDepth=!0),t._pickable&&this.addPicking(t),t.__debug&&this.numDebug++,t._debugger||this.numEntities++
},addEntities:function(t){for(var e=t.length,i=0;e>i;i++)this.addEntity(t[i])},addEntitiesUI:function(t){for(var e=t.length,i=0;e>i;i++)this.addEntityUI(t[i])},removeEntity:function(t){if(t.__added){if(this.__updating);else var e=this.entities;t.__added=!1}},removeEntities:function(t){if(this.__updating)for(var e,i=t.length,n=0;i>n;n++)e=t[n],e.__added=!1,this.entitiesRemove.push(e);else this._removeEntities(t)},_removeEntities:function(t){for(var e,i,n=t.length,s=this.entities.length,o=this.entitiesUI.length,r=0;n>r;r++){if(e=t[r],e.__added=!1,e.__ui){for(i=0;o>i;i++)if(this.entitiesUI[i]===e){o--,this.entitiesUI[i]=this.entitiesUI[o],this.entitiesUI.pop();break}}else for(i=0;s>i;i++)if(this.entities[i]===e){s--,this.entities[i]=this.entities[s],this.entities.pop();break}e.children&&this._removeEntities(e.children)}},addUpdating:function(t){-1===t.__updateIndex&&(t.__updateIndex=this.entitiesToUpdate.length,this.entitiesToUpdate.push(t))},removeUpdating:function(t){if(-1!==t.__updateIndex){if(this.__updating)this._removeUpdating.push(t.__updateIndex);else{var e=this.entitiesToUpdate[this.entitiesToUpdate.length-1];e.__updateIndex=t.__updateIndex,this.entitiesToUpdate[t.__updateIndex]=e,this.entitiesToUpdate.pop()}t.__updateIndex=-1}},addPicking:function(t){t.__added&&(t.__picking||(t.__picking=!0,this.entitiesPicking.push(t)))},removePicking:function(t){t.__picking&&(t.__picking=!1)},addAnim:function(t){if(t.__removed)t.__removed=0;else{if(-1!==t.__index)return;t.__index=this.entitiesAnim.length,this.entitiesAnim.push(t)}},removeAnim:function(t){t.__removed||-1===t.__index||(this.entitiesAnimRemove.push(t.__index),t.__removed=1)},addTween:function(t){if(t.__removed)t.__removed=0;else{if(-1!==t.__index)return!1;t.__index=this.tweens.length,this.tweens.push(t)}return!0},removeTween:function(t){return t.__removed||-1===t.__index?!1:(this.tweensRemove.push(t.__index),t.__removed=1,!0)},onInput:function(t,e){if(this.enablePicking){this._checkHover(t);var i=Input.Event;if(i.DOWN===e){if(!this.hoverEntity)return;t.entity=this.hoverEntity,this.pressedEntity=this.hoverEntity,this.pressedEntity.pressed=!0,this.pressedEntity._style&&this.pressedEntity._onDown.call(this.pressedEntity,t),this.pressedEntity.onDown&&this.pressedEntity.onDown.call(this.pressedEntity,t),this.chn.onDown.emit(t,Entity.Event.INPUT_DOWN)}else i.UP===e&&this.pressedEntity&&(t.entity=this.hoverEntity,this.pressedEntity.pressed=!1,this.pressedEntity._style&&this.pressedEntity._onUp.call(this.pressedEntity,e),this.pressedEntity.onUp&&this.pressedEntity.onUp.call(this.pressedEntity,e),this.chn.onUp.emit(this.pressedEntity,Entity.Event.INPUT_UP),this.pressedEntity===this.hoverEntity&&(this.pressedEntity._style&&this.pressedEntity._onClick.call(this.pressedEntity,t),this.pressedEntity.onClick&&this.pressedEntity.onClick.call(this.pressedEntity,t),this.chn.onClick.emit(t,Entity.Event.CLICK)),this.pressedEntity.dragged&&(t.entity=this.pressedEntity,this.pressedEntity.dragged=!1,this.pressedEntity._style&&this.pressedEntity._onDragEnd.call(this.pressedEntity,t),this.pressedEntity.onDragEnd&&this.pressedEntity.onDragEnd.call(this.pressedEntity,t),this.chn.onDragEnd.emit(t,Entity.Event.DRAG_END),t.entity=this.hoverEntity),this.pressedEntity=null)}},onInputMove:function(t,e){return this.enablePicking?(this._checkHover(t),this._checkDrag(t)?(t.entity=this.hoverEntity,void 0):(t.entity=this.hoverEntity,void 0)):void 0},onInputDbClick:function(t,e){this.enablePicking&&(this._checkHover(t),this.hoverEntity?(t.entity=this.hoverEntity,this.hoverEntity._style&&this.hoverEntity._onDbClick.call(this.hoverEntity,t),this.hoverEntity.onDbClick&&this.hoverEntity.onDbClick.call(this.hoverEntity,t),this.chn.onDbClick.emit(t,Entity.Event.DBCLICK)):t.entity=null)},_checkHover:function(t){for(var e,i=this.entitiesPicking.length,n=i-1;n>=0;n--){if(e=this.entitiesPicking[n],this.enablePixelPicking){if(!e.isPointInsidePx(t.x,t.y))continue}else if(!e.isPointInside(t.x,t.y))continue;return this.hoverEntity!==e?(this.hoverEntity&&(t.entity=this.hoverEntity,this.hoverEntity.hover=!1,this.hoverEntity._style&&this.hoverEntity._onHoverExit.call(this.hoverEntity,t),this.hoverEntity.onHoverExit&&this.hoverEntity.onHoverExit.call(this.hoverEntity,t),this.chn.onHoverExit.emit(t,Entity.Event.HOVER_EXIT)),t.entity=e,e.hover=!0,e._style&&e._onHoverEnter.call(e,t),e.onHoverEnter&&e.onHoverEnter.call(e,t),this.chn.onHoverEnter.emit(t,Entity.Event.HOVER_ENTER),this.hoverEntity=e):(t.entity=e,e.onHover&&e.onHover.call(e,t),this.chn.onHover.emit(t,Entity.Event.HOVER)),t.entity=null,void 0}this.hoverEntity&&(t.entity=this.hoverEntity,this.hoverEntity.hover=!1,this.hoverEntity._style&&this.hoverEntity._onHoverExit.call(this.hoverEntity,t),this.hoverEntity.onHoverExit&&this.hoverEntity.onHoverExit.call(this.hoverEntity,t),this.chn.onHoverExit.emit(t,Entity.Event.HOVER_EXIT)),this.hoverEntity=null},_checkDrag:function(t){return this.pressedEntity?(t.entity=this.pressedEntity,this.pressedEntity.dragged?(this.pressedEntity.onDrag&&this.pressedEntity.onDrag.call(this.pressedEntity,t),this.chn.onDrag.emit(t,Entity.Event.DRAG)):(this.pressedEntity.dragged=!0,this.pressedEntity._style&&this.pressedEntity._onDragStart.call(this.pressedEntity,t),this.pressedEntity.onDragStart&&this.pressedEntity.onDragStart.call(this.pressedEntity,t),this.chn.onDragStart.emit(t,Entity.Event.DRAG_START)),!1):!0},onResize:function(t,e){this.holder.resize(t.width,t.height);for(var i,n=this.entities.length,s=0;n>s;s++)i=this.entities[s],i.parent===this.holder&&i._updateResize();for(n=this.entitiesUI.length,s=0;n>s;s++)i=this.entitiesUI[s],i.parent===this.holder&&i._updateResize()},onAdapt:function(t,e){},onCameraMove:function(t,e){this.needRender=!0},getUniqueID:function(){return this.__uniqueID++},set bgColor(t){this._bgColor=t,this.updateBgColor(),this.needRender=!0},get bgColor(){return this._bgColor},set transparent(t){this._transparent=t,this.updateBgColor(),this.needRender=!0},get transparent(){return this._transparent},set needRender(t){this._needRender=t},get needRender(){return this._needRender},addRender:function(t){this._renderFuncs.push(t)},removeRender:function(t){for(var e=this._renderFuncs.length,i=0;e>i;i++)if(this._renderFuncs[i]===t){this._renderFuncs[i]=this._renderFuncs[e-1],this._renderFuncs.pop();break}},meta:meta,engine:null,chn:null,holder:null,camera:null,cameraDefault:null,cameraUI:null,entities:[],entitiesRemove:[],entitiesToUpdate:[],_removeUpdating:[],numEntities:0,entitiesUI:[],entitiesAnim:[],entitiesAnimRemove:[],entitiesPicking:[],entitiesPickingRemove:[],hoverEntity:null,pressedEntity:null,enablePicking:!0,enablePixelPicking:!1,tweens:[],tweensRemove:[],_needRender:!0,needSortDepth:!1,_renderFuncs:[],numDebug:0,_bgColor:"#ddd",_transparent:!1,__uniqueID:0,__updating:!1}),"use strict",meta.CanvasRenderer=meta.Renderer.extend({init:function(){this._super(),this.ctx=meta.engine.canvas.getContext("2d"),meta.engine.ctx=this.ctx},render:function(t){for(var e=this.entitiesAnim.length,i=0;e>i;i++)this.entitiesAnim[i].update(t);if(this.needRender){this.clear(),this.ctx.save();var n=this.camera._zoom;for(this.ctx.setTransform(n,0,0,n,-this.camera._x*n|0,-this.camera._y*n|0),e=this.entities.length,i=0;e>i;i++)this.drawEntity(this.entities[i]);var s=this._renderFuncs.length;for(i=0;s>i;i++)this._renderFuncs[i].render(t);var o=null;if(this.meta.cache.debug||this.numDebug>0){for(this.ctx.save(),this.ctx.lineWidth=2,this.ctx.strokeStyle="red",this.ctx.fillStyle="red",i=0;e>i;i++)if(o=this.entities[i],this._debug||this.meta.cache.debug)if(o._static){var n=this.camera._zoom;o._debugger?this.ctx.setTransform(1,0,0,1,0,0):this.ctx.setTransform(n,0,0,n,0,0),this.drawVolume(o),this.ctx.setTransform(n,0,0,n,-this.camera._x*n|0,-this.camera._y*n|0)}else this.drawVolume(o);this.ctx.restore()}if(e=this.entitiesUI.length,e>0){for(this.camera=this.cameraUI,this.ctx.resetTransform(),i=0;e>i;i++)this.drawEntity(this.entitiesUI[i]);this.camera=this.cameraDefault}this.needRender=!1,this.ctx.restore()}},clear:function(){this._transparent?this.ctx.clearRect(0,0,this.engine.width,this.engine.height):(this.ctx.fillStyle=this._bgColor,this.ctx.fillRect(0,0,this.engine.width,this.engine.height))},drawEntity:function(t){if(t._visible)if(t.draw)this.ctx.save(),t.draw(this.ctx),this.ctx.restore();else if(t._static){var e=this.camera._zoom;t._debugger?this.ctx.setTransform(1,0,0,1,0,0):this.ctx.setTransform(e,0,0,e,0,0),this._drawEntity(t),this.ctx.setTransform(e,0,0,e,-this.camera._x*e|0,-this.camera._y*e|0)}else this._drawEntity(t)},_drawEntity:function(t){var e=t._texture;if(e){var i=t.volume,n=t.anim;if(i.__transformed){this.ctx.globalAlpha=t._alpha,this.ctx.transform(i.m11,i.m12,i.m21,i.m22,0|i.x,0|i.y),e.frames>1?e.drawFrame(this.ctx,-i.initPivotPosX,-i.initPivotPosY,n._frame):this.ctx.drawImage(e.canvas,-i.initPivotPosX,-i.initPivotPosY),this.ctx.globalAlpha=1;var s=this.camera._zoom;this.ctx.setTransform(s,0,0,s,-this.camera._x*s|0,-this.camera._y*s|0)}else e.frames>1?e.drawFrame(this.ctx,0|i.minX,0|i.minY,n._frame):this.ctx.drawImage(e.canvas,0|i.minX,0|i.minY)}},drawVolume:function(t){if(t._visible&&!t._debugger){var e=t.volume;0===e.__type?this._drawVolume(e):(this.ctx.save(),this.ctx.translate(0|e.x,0|e.y),this.ctx.rotate(t.volume.angle),this.ctx.translate(0|-e.x,0|-e.y),this._drawVolume(e),this.ctx.restore())}},_drawVolume:function(t){var e=Math.floor(t.minX),i=Math.floor(t.minY),n=Math.floor(t.maxX),s=Math.floor(t.maxY-1);this.ctx.beginPath(),this.ctx.moveTo(e,i),this.ctx.lineTo(n,i),this.ctx.lineTo(n,s),this.ctx.lineTo(e,s),this.ctx.lineTo(e,i-1),this.ctx.stroke(),this.ctx.fillRect(t.x-3,t.y-3,6,6)},updateBgColor:function(){}}),"use strict",meta.Anim=function(t){this.owner=t},meta.Anim.prototype={set:function(t){return t?(this.texture=t,t.frames>1?(this.texture=t,this.fps=t.fps,this.__tAnim=0,this._frame=this.reverse?t.frames-1:0,this.autoPlay&&meta.renderer.addAnim(this)):-1!==this.__index&&meta.renderer.removeAnim(this),void 0):(-1!==this.__index&&meta.renderer.removeAnim(this),this.texture=null,void 0)},play:function(t){this.loop=t||!1,meta.renderer.addAnim(this)},pause:function(){meta.renderer.removeAnim(this)},resume:function(){meta.renderer.addAnim(this)},stop:function(){this._frame=this.reverse?texture.frames-1:0,meta.renderer.removeAnim(this)},onEnd:null,update:function(t){if(this.__tAnim+=t,!(this.__tAnim<this.__delay)){var e=this.__tAnim/this.__delay|0;this.__tAnim-=e*this.__delay,this.reverse?(this._frame-=e,this._frame<0&&(this.onEnd&&this.onEnd.call(this.owner),this.pauseLastFrame?(meta.renderer.removeAnim(this),this._frame=0):this.loop?this._frame=(this.texture.frames+this._frame)%this.texture.frames:(meta.renderer.removeAnim(this),this._frame=this.texture.frames-1))):(this._frame+=e,this._frame>=this.texture.frames&&(this.onEnd&&this.onEnd.call(this.owner),this.pauseLastFrame?(meta.renderer.removeAnim(this),this._frame=this.texture.frames-1):this.loop?this._frame=this._frame%this.texture.frames:(meta.renderer.removeAnim(this),this._frame=0))),meta.renderer.needRender=!0}},set frame(t){this._frame=t,meta.renderer.needRender=!0},get frame(){return this._frame},set fps(t){this._fps=t,this.__delay=1/(t*this._speed)},get fps(){return this._fps},set speed(t){this._speed=t,this.__delay=1/(fps*this._speed)},get speed(){return this._speed},set paused(t){t?this.pause():this.resume()},get paused(){return!0},loop:!0,reverse:!1,autoPlay:!0,pauseLastFrame:!1,_fps:0,_speed:1,_frame:0,__index:-1,__removed:0,__delay:0,__tAnim:0},"use strict",window.Component={},"use strict";var Resource={};Resource.Controller=meta.Controller.extend({init:function(){this.resources={},this.resourcesInUse={},this._chn_added=meta.createChannel(Resource.Event.ADDED),this._chn_allLoaded=meta.createChannel(Resource.Event.ALL_LOADED);var t=document.createElement("canvas");Resource.Texture.prototype._tmpImg=t,Resource.Texture.prototype._tmpCtx=t.getContext("2d"),meta.subscribe(this,meta.Event.ADAPT,this.onAdapt);var e=Resource.Sound.prototype;meta.device.isAudioAPI?(e._context=new AudioContext,console.log("%cAudio: %cWebAudio ","font-weight: bold; padding: 2px 0 2px 0;","padding: 2px 0 2px 0;")):(e._loadFromUrl=e._loadFromUrl_legacy,e._clear=e._clear_legacy,e._createInstance=e._createInstance_legacy,e._syncLoading=!0,console.log("%cAudio: %c<audio> ","font-weight: bold; padding: 2px 0 1px 0; width: 500px;","padding: 2px 0 1px 0;"))},add:function(t){var e=this.resources[t.type];e||(e={},this.resources[t.type]=e);var i=t.path;if("unknown"===t.name&&i){var n=i.lastIndexOf("."),s=i.lastIndexOf("/");t.name=0>n||i.length-n>5?i.slice(s+1):i.slice(s+1,n)}return e[t.name]?(console.warn("[Resource.Manager.add]:","There is already a resource("+meta.enumToString(Resource.Type,t.type)+") added with a name: "+t.name),null):(e[t.name]=t,this._chn_added.emit(t,Resource.Event.ADDED),t)},remove:function(t){var e=this.resources[t.type];return e&&e[t.name]?(e[t.name]=null,void 0):(console.warn("[Resource.Manager.remove]:","Resource("+meta.enumToString(Resource.Type,t.type)+")("+t.name+") is not added to the manager."),void 0)},addToLoad:function(t){this.loading=!0,t.loading=!0,meta.engine.ready||this.numToLoad++},loadSuccess:function(t){var e=this.resourcesInUse[t.type];e||(e=[],this.resourcesInUse[t.type]=e),e.push(t),t.isLoading=!1,t.inUse=!0,meta.engine.ready||(this.numToLoad--,this.numLoaded++,0!==this.numToLoad||meta.engine.loading||(meta.engine.onReady(),this._chn_allLoaded.emit(this,Resource.Event.ALL_LOADED)))},loadFailed:function(t){t.loading=!1,meta.engine.ready||(this.numToLoad--,0!==this.numToLoad||meta.engine.loading||(meta.engine.onReady(),this._chn_allLoaded.emit(this,Resource.Event.ALL_LOADED)))},getTexture:function(t){if(!t)return console.warn("[Resource.Manager.getTexture]:","No name specified."),null;var e=this.resources[Resource.Type.TEXTURE];if(!e)return null;var i=e[t];return i?i:null},getSound:function(t){if(!t)return console.warn("[Resource.Manager.getSound]:","No name specified."),null;var e=this.resources[Resource.Type.SOUND];if(!e)return null;var i=e[t];return i?i:null},addToQueue:function(t){this._syncQueue||(this._syncQueue=[]),this._syncQueue.push(t)},loadNextFromQueue:function(){this.isSyncLoading=!1,this._syncQueue&&this._syncQueue.length&&(this._syncQueue[this._syncQueue.length-1].forceLoad(!0),this._syncQueue.pop())},onAdapt:function(t,e){var i=meta.unitRatio,n,s=this.resources[Resource.Type.TEXTURE];for(var o in s)n=s[o],n.unitRatio=i,n.load()},getUniqueID:function(){return++this._uniqueID},resources:null,resourcesInUse:null,rootPath:"",numLoaded:0,numToLoad:0,_syncQueue:null,isSyncLoading:!1,_chn_added:null,_chn_allLoaded:null,_uniqueID:0,loading:!1}),"use strict",Resource.Event={UNLOADED:"res-unloaded",LOADED:"res-loaded",RESIZE:"res-resize",CHANGED:"res-changed",ADDED:"res-added",ALL_LOADED:"res-all-loaded"},Resource.Type={BASIC:0,TEXTURE:1,SOUND:2,SPRITE_SHEET:3,FONT:4},Resource.TextureType={UNKNOWN:-1,CANVAS:0,WEBGL:1},Resource.AnimType={NONE:0,LINEAR_H:1,LINEAR_V:2,RADIAL:3,RADIAL_TOP_LEFT:4,RADIAL_TOP_RIGHT:5,RADIAL_BOTTOM_LEFT:6,RADIAL_BOTTOM_RIGHT:7},"use strict",Resource.Basic=meta.class.extend({_init:function(){this.id=Resource.ctrl.getUniqueID()},subscribe:function(t,e){this.chn||(this.chn=meta.createChannel("__res"+this.id)),this.chn.subscribe(t,e)},unsubscribe:function(t){this.chn&&(this.chn.unsubscribe(t),0===this.chn.numSubs&&(this.chn.remove(),this.chn=null))},emit:function(t,e){this.chn&&this.chn.emit(t,e)},set loaded(t){t?this._loaded?(this._loaded=t,this.emit(this,Resource.Event.CHANGED)):(this._loaded=t,this.emit(this,Resource.Event.LOADED)):this._loaded&&(this._loaded=t,this.emit(this,Resource.Event.UNLOADED))},get loaded(){return this._loaded},id:0,type:Resource.Type.BASIC,name:"unknown",path:"",fullPath:"",chn:null,_loaded:!1,loading:!1,used:!1}),"use strict",Resource.Texture=Resource.Basic.extend({init:function(t){this.generate();var e=typeof t;if("string"===e)this.load(t);else if("object"===e){for(var i in t)this[i]=t[i];(this.framesX>1||this.framesY>1)&&(this.frames=this.framesX*this.framesY,this.animated=!0),this.path&&this.load(this.path)}},remove:function(){},generate:function(){this.loaded=!0,this.canvas=document.createElement("canvas"),this.canvas.width=this.trueFullWidth,this.canvas.height=this.trueFullHeight,this.ctx=this.canvas.getContext("2d")},load:function(t){if(!this.loading&&(this.loaded=!1,t)){this.path=t;var e=this.path.lastIndexOf(".");(-1===e||this.path.length-e>4)&&(this.path+=".png"),this.fullPath=meta.cache.currResolution?Resource.ctrl.rootPath+meta.cache.currResolution.path+this.path:Resource.ctrl.rootPath+this.path;var i=this,n=new Image;n.onload=function(){return n.complete?(i.createFromImg(n),Resource.ctrl.loadSuccess(i),void 0):(console.warn("(Resource.Texture.load) Could not load texture from - "+n.src),Resource.ctrl.loadFailed(i),void 0)},n.onerror=function(t){Resource.ctrl.loadFailed(i)},n.src=this.fullPath,Resource.ctrl.addToLoad(this)}},createFromImg:function(t){this._loaded&&this.clear(),this.resizeSilently(t.width,t.height),this.ctx.drawImage(t,0,0),this.unitRatio=meta.unitRatio,this._reloading=!1,this.loaded=!0},_createCachedImg:function(){this._cachedImg||(this._cachedImg=document.createElement("canvas"),this._cachedImg.width=this.trueFullWidth,this._cachedImg.height=this.trueFullHeight,this._cachedCtx=this._cachedImg.getContext("2d"))},resize:function(t,e){this.resizeSilently(t,e),this.loaded=!0},resizeSilently:function(t,e){if(this.trueFullWidth!==t||this.trueFullHeight!==e){this.trueFullWidth=t,this.trueFullHeight=e,this.animated?(this.trueWidth=t/this.framesX,this.trueHeight=e/this.framesY):(this.trueWidth=t,this.trueHeight=e);var i=meta.engine.unitRatio;this.width=this.trueWidth*i+.5|0,this.height=this.trueHeight*i+.5|0,this.fullWidth=this.trueFullWidth*i+.5|0,this.fullHeight=this.trueFullHeight*i+.5|0,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this._loaded&&this.canvas.width>1&&this.canvas.height>1?(this._tmpImg.width=this.canvas.width,this._tmpImg.height=this.canvas.height,this._tmpCtx.drawImage(this.canvas,0,0),this.canvas.width=this.trueFullWidth,this.canvas.height=this.trueFullHeight,this.ctx.drawImage(this._tmpImg,0,0)):(this.canvas.width=this.trueFullWidth,this.canvas.height=this.trueFullHeight)}},upResize:function(t,e){t<this.trueFullWidth&&(t=this.trueFullWidth),e<this.trueFullHeight&&(e=this.trueFullHeight),this.resize(t,e)},draw:function(t,e,i){this.fromAtlas?t.drawImage(this.ptr.canvas,this._x,this._y,this.trueWidth,this.trueHeight,e,i,this.trueWidth,this.trueHeight):t.drawImage(this.canvas,e,i)},drawFrame:function(t,e,i,n){t.drawImage(this.canvas,this.trueWidth*(n%this.framesX),this.trueHeight*Math.floor(n/this.framesX),this.trueWidth,this.trueHeight,e,i,this.trueWidth,this.trueHeight)},clear:function(){this.ctx.clearRect(0,0,this.trueFullWidth,this.trueFullHeight)},drawOver:function(t,e,i){if(!t)return console.warn("(Resource.Texture.drawOver) No texture specified."),void 0;if(e=e||0,i=i||0,"string"==typeof t){var n=meta.getTexture(t);if(!n)return console.warn("(Resource.Texture.drawOver) No such texture with name - "+t),void 0;t=n}if(t.textureType===Resource.TextureType.WEBGL){if(!t._canvasCache)return t._canvasCache=new Resource.Texture(Resource.TextureType.CANVAS,t.path),t._canvasCache.load(),t=t._canvasCache,this._loadCache={name:"drawOver",texture:t,x:e,y:i},this.isLoaded=!1,t.subscribe(this,this.onTextureCacheEvent),void 0;t=t._canvasCache}var s=this.ctx;if(this.textureType&&(this._createCachedImg(),s=this._cachedCtx),s.drawImage(t.image,e,i),this.textureType){var o=meta.ctx;o.bindTexture(o.TEXTURE_2D,this.image),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,this._cachedImg)}this.isLoaded=!0},generateAlphaMask:function(){if(!this._isLoaded)return console.warn("[Resource.Texture.generateMask]:","Texture is not loaded yet."),void 0;if(0!==this.textureType)return console.warn("[Resource.Texture.generateMask]:","Only canvas textures are supported currently."),void 0;var t=new Resource.Texture(Resource.TextureType.CANVAS);t.resize(this.trueFullWidth,this.trueFullHeight);for(var e=this.ctx.getImageData(0,0,this.trueFullWidth,this.trueFullHeight),i=e.data,n=i.length,s=0;n>s;s+=4)i[s]=255,i[s+1]=255,i[s+2]=255;return t.ctx.putImageData(e,0,0),t.isLoaded=!0,t},onTextureCacheEvent:function(t,e){e===Resource.Event.LOADED&&(t.unsubscribe(this),"drawOver"===this._loadCache.name?this.drawOver(this._loadCache.texture,this._loadCache.x,this._loadCache.y):this[this._loadCache.name](this._loadCache.data),this._loadCache=null)},set offsetX(t){this._offsetX=t,this._loaded&&this.emit(this,Resource.Event.CHANGED)},set offsetY(t){this._offsetY=t,this._loaded&&this.emit(this,Resource.Event.CHANGED)},get offsetX(){return this._offsetX},get offsetY(){return this._offsetY},getData:function(){return this.ctx.getImageData(0,0,this.trueWidth,this.trueHeight).data},getPixelAt:function(t,e){return this.ctx.getImageData(t,e,1,1).data},applyCanvas:function(t){this.canvas=t,this.ctx=t.getContext("2d"),this.resize(t.width,t.height)},type:Resource.Type.TEXTURE,ptr:null,canvas:null,ctx:null,_x:0,_y:0,_width:0,_height:0,fullWidth:0,fullHeight:0,_widthRatio:0,_heightRatio:0,_offsetX:0,_offsetY:0,unitRatio:1,fps:9,frames:1,framesX:1,framesY:1,fromAtlas:!1,reloading:!1,_tmpImg:null,_tmpCtx:null,_cachedImg:null,_cachedCtx:null,_anim:null,_frames:null,_loadCache:null,_canvasCache:null}),"use strict",Resource.Sound=Resource.Basic.extend({init:function(t,e){if("string"==typeof t&&(e=t,t=void 0),e){var i=e.lastIndexOf(".");-1!==i&&e.length-i<=5&&(this.format=e.substr(i+1,e.length-i-1),e=e.substr(0,i)),this.path=Resource.ctrl.rootPath+e}this._instances=[];var n=this;meta.device.isAudioAPI?(this._request=new XMLHttpRequest,this._request.responseType="arraybuffer",this._request.onreadystatechange=function(){n._onStateChange()}):(this._context=this._getInstance(),this._context.audio.addEventListener("error",function(){n.format?n._onLoadFailed():n._loadNextExtension()}),this._numInstancesUsed=0)},load:function(){if(!this.isLoading){this.isLoading=!0,this.isLoaded=!1,Resource.ctrl.addToLoad(this);var t=Resource.ctrl;t.isSyncLoading?t.addToQueue(this):(this.syncLoading||(t.isSyncLoading=!0),this._loadNextExtension())}},forceLoad:function(){this._loadNextExtension()},_loadNextExtension:function(){var t;if(this.format)t=this.path;else{var e=meta.device.audioFormats;if(this._requestFormat++,this._requestFormat>e.length)return this._onLoadFailed(),void 0;t=this.path+"."+meta.device.audioFormats[this._requestFormat-1]}this._loadFromUrl(t)},_loadFromUrl:function(t){this._request.open("GET",t,!0),this._request.send()},_loadFromUrl_legacy:function(t){this._context.audio.src=t,this._context.audio.load()},_clear:function(){this._request.onreadystatechange=null,this._request=null},_clear_legacy:function(){},_onStateChange:function(){if(4===this._request.readyState)if(200===this._request.status){var t=this;this._context.decodeAudioData(this._request.response,function(e){t._onDecodeSuccess(e)},function(){t._onDecodeError()}),this._request=null}else this.format?this._onLoadFailed():this._loadNextExtension()},_onDecodeSuccess:function(t){this.format||(this.path+="."+meta.device.audioFormats[this._requestFormat-1]),this._buffer=t,this._isLoading=!1,this._clear(),this.isLoaded=!0,Resource.ctrl.loadSuccess(this);for(var e=this._instances.length,i=0;e>i;i++)this._createSource(this._instances[i])},_onDecodeError:function(){this.format||(this.path+="."+meta.device.audioFormats[this._requestFormat-1]),console.warn("[Resource.Sound.load]:","Error decoding file: "+this.path),this._isLoading=!1,this._clear(),Resource.ctrl.loadFailed(this)},_onLoadFailed:function(){if(!this.format){var t=meta.device.audioFormats[this._requestFormat-1];t&&(this.path+="."+t)}console.warn("[Resource.Sound.load]:","Error loading file: "+this.path),this._isLoading=!1,this._clear(),Resource.ctrl.loadFailed(this)},play:function(t,e){var i=this._getInstance();i.isLoop=t||!1,i.play(e)},stop:function(){for(var t=0;t<this._numInstancesUsed;t++)this._instances[t]._stop();this._numInstancesUsed=0},pause:function(){for(var t=0;t<this._numInstancesUsed;t++)this._instances[t].pause()},resume:function(){for(var t=0;t<this._numInstancesUsed;t++)this._instances[t].resume()},_createSource:function(t){var e=this._context.createGain();e.connect(this._context.destination);var i=this._context.createBufferSource();i.buffer=this._buffer,i.loop=t._isLoop,i.connect(e),i.start||(i.start=i.noteOn),i.stop||(i.stop=i.noteOff);var n=this;return i.onended=function(){n._clearInstance(t)},t.source=i,t.gainNode=e,i},_createInstance:function(){return new Resource.AudioInstance},_createInstance_legacy:function(){return new Resource.AudioInstance_legacy(this)},_getInstance:function(){this._instances.length===this._numInstancesUsed&&(this._instances.length+=1,this._instances[this._numInstancesUsed]=this._createInstance());var t=this._instances[this._numInstancesUsed];return t.id=this._numInstancesUsed,this._numInstancesUsed++,t},_clearInstance:function(t){this._numInstancesUsed--;var e=this._instances[this._numInstancesUsed];e.id=t.id,this._instances[t.id]=e},set volume(t){if(this._volume!==t){this._volume=t;for(var e=this._instances.length,i=0;e>i;i++)this._instances[i].volume=t}},get volume(){return this._volume},get isPlaying(){return this._numInstancesUsed>0?!0:!1},type:Resource.Type.SOUND,format:"",_instances:null,_numInstancesUsed:0,_autoIsLoop:!1,_autoTime:0,_context:null,_buffer:null,_request:null,_requestFormat:0,_volume:1,_isInQueue:!1,_syncLoading:!1}),Resource.AudioInstance=function(){this.id=-1,this.source=null,this.gainNode=null,this.auto,this._volume=1,this._mixedVolume=1},Resource.AudioInstance.prototype={set volume(t){this._mixedVolume=this._volume*t,this.gainNode.gain.value=this._mixedVolume},get volume(){return this._volume},get mixedVolume(){return this._mixedVolume}},Resource.AudioInstance_legacy=function(t){this.id=-1,this.parent=t,this.isPlaying=!1,this.isLoop=!1,this._canPlay=!1,this._metaLoaded=!1,this._isLoaded=!1,this._volume=1,this._mixedVolume=1,this.audio=new Audio,this.audio.preload="auto",this._addEvents(t)},Resource.AudioInstance_legacy.prototype={play:function(t){this.isPlaying=!0,this._isLoaded?(this.audio.currentTime=t||0,this.audio.play()):this._autoPlay=!0},stop:function(){this.isPlaying=!1,this.isLoop=!1,this.audio.pause(),this.parent._clearInstance(this)},_stop:function(){this.isPlaying=!1,this.isLoop=!1,this.audio.pause()},pause:function(){this.isPlaying=!1,this.audio.pause()},resume:function(){this.isPlaying=!0,this.audio.play()},_addEvents:function(){var t=this,e=function(){t.audio.removeEventListener("canplaythrough",e),t._canPlay=!0,meta.device.support.onloadedmetadata&&t._metaLoaded&&t._onLoaded()};if(this.audio.addEventListener("canplaythrough",e,!1),meta.device.support.onloadedmetadata){var i=function(){t.audio.removeEventListener("loadedmetadata",i),t._metaLoaded=!0,t._canPlay&&t._onLoaded()};this.audio.addEventListener("loadedmetadata",i,!1)}this.audio.addEventListener("ended",function(){t._onEnd()},!1),this.parent._isLoaded&&(this.audio.src=this.parent.path,this.audio.load())},_onLoaded:function(){if(!this.parent._isLoaded){this.parent.format||(this.parent.path+="."+meta.device.audioFormats[this.parent._requestFormat-1]),this.parent._isLoading=!1,this.parent.isLoaded=!0;for(var t,e=this.parent._instances,i=this.parent._instances.length,n=1;i>n;n++)t=e[n],t.audio.src=this.parent.path,t.audio.load();Resource.ctrl.loadSuccess(parent),Resource.ctrl.loadNextFromQueue()}this._isLoaded=!0,this._autoPlay&&this.audio.play()},_onEnd:function(){this.isLoop?(this.audio.play(),this.audio.currentTime=0):this.isPlaying&&(this.isPlaying=!1,this.parent._clearInstance(this))},set currentTime(t){this.isPlaying?this.audio.currentTime=t||0:(this.audio.play(),this.audio.currentTime=t||0,this.audio.pause())},get currentTime(){return this.audio.currentTime},set volume(t){t>1?t=1:0>t&&(t=0),this._mixedVolume=this._volume*t,this.audio.volume=this._mixedVolume},get volume(){return this._volume},get mixedVolume(){return this._mixedVolume},_autoPlay:!1},"use strict",Resource.SpriteSheet=Resource.Basic.extend({init:function(t,e){if("string"==typeof t)e=t,t=void 0;else for(var i in t)this[i]=t[i];if(e){var n=e.lastIndexOf(".");-1!==n&&e.length-n<=5&&(this.format=e.substr(n+1,e.length-n-1),e=e.substr(0,n)),this.path=Resource.ctrl.rootPath+e,this.format||(this.format="xml")}},load:function(){if(!this.isLoading){this.isLoading=!0,this.isLoaded=!1,this._isAtlasLoaded=!1,this.texture?"string"==typeof this.texture&&(this.texture=new Resource.Texture(this.texture)):this.texture=new Resource.Texture(this.path),this.texture._isLoaded||(this.texture.subscribe(this,this._onTextureEvent),this.texture._isLoading||this.texture.load());var t=this,e=this.path+"."+this.format;this._request=new XMLHttpRequest,this._request.open("GET",e,!0),this._request.onreadystatechange=function(){t._onStateChange()},this._request.send(),Resource.ctrl.addToLoad(this)}},loadData:function(t,e){if(e=e||this.format,e||(e="xml"),this.format=e,this.isLoaded=!0,"xml"===e){var i=new DOMParser,n=i.parseFromString(t,"text/xml");return this.loadXML(n)}if("json"===e){var s=JSON.parse(t);return this.loadJSON(s)}if("plist"===e){var i=new DOMParser,o=i.parseFromString(t,"text/xml");return this.loadPlist(o)}return console.warn("[Resource.SpriteSheet.loadData]:","Trying to load an unsupported format - "+this.format),!1},loadXML:function(t){if(!t)return console.warn("[Resource.SpriteSheet.loadXML]:","Invalid XML file."),!1;for(var e=t.documentElement.childNodes,i=e.length,n,s=0;i>s;s++)if(n=e[s],"SubTexture"===n.nodeName)this._loadXML_Starling(n);else if("sprite"===n.nodeName)this._loadXML_genericXML(n);else if("dict"===n.nodeName)return this.loadPlist(t);return!0},_loadXML_Starling:function(t){var e=new Resource.Texture;e.fromAtlas=!0,e.ptr=this.texture,e.name=t.getAttribute("name"),e.x=t.getAttribute("x"),e.y=t.getAttribute("y"),e.resize(t.getAttribute("width"),t.getAttribute("height")),e.isLoaded=!0,Resource.ctrl.add(e)},_loadXML_genericXML:function(t){var e=new Resource.Texture;e.fromAtlas=!0,e.ptr=this.texture,e.name=t.getAttribute("n"),e.x=t.getAttribute("x"),e.y=t.getAttribute("y"),e.resize(t.getAttribute("w"),t.getAttribute("h")),e.isLoaded=!0,Resource.ctrl.add(e)},loadPlist:function(t){if(!t)return console.warn("[Resource.SpriteSheet.loadPlist]:","Invalid Plist file."),!1;for(var e=t.documentElement.childNodes,i=e.length,n,s=0;i>s;s++)if(n=e[s],"dict"===n.nodeName)return this._loadPlist_dict(n)},_loadPlist_dict:function(t){for(var e=t.childNodes,i=e.length,n="",s=0;i>s;s++)if(t=e[s],"key"===t.nodeName)n=t.textContent;else if("dict"===t.nodeName){if(!n)continue;"frames"===n&&this._loadPlist_frames(t)}},_loadPlist_frames:function(t){for(var e=t.childNodes,i=e.length,n="",s=0;i>s;s++)t=e[s],"key"===t.nodeName?n=t.textContent:"dict"===t.nodeName&&this._loadPlist_frame(t,n)},_loadPlist_frame:function(t,e){var i=new Resource.Texture;i.fromAtlas=!0,i.ptr=this.texture,i.name=e;for(var n=t.childNodes,s=n.length,o="",r,h=0;s>h;h++)if(t=n[h],"key"===t.nodeName)o=t.textContent;else if("string"===t.nodeName&&"frame"===o)return r=t.textContent.match(/[0-9]+/g),i.x=parseInt(r[0]),i.y=parseInt(r[1]),i.resize(parseInt(r[2]),parseInt(r[3])),i.isLoaded=!0,Resource.ctrl.add(i),void 0},loadJSON:function(t){return t?(t.frames instanceof Array?this._loadJSON_array(t):this._loadJSON_hash(t),!0):(console.warn("[Resource.SpriteSheet.loadFromJSON]:","Invalid JSON file."),!1)},_loadJSON_array:function(t){for(var e,i,n=t.frames,s=n.length,o=0;s>o;o++)e=n[o],i=new Resource.Texture,i.fromAtlas=!0,i.ptr=this.texture,i.name=e.filename,e=e.frame,i.x=e.x,i.y=e.y,i.resize(e.w,e.h),i.isLoaded=!0,Resource.ctrl.add(i)},_loadJSON_hash:function(t){var e,i,n=t.frames;for(var s in n)e=n[s].frame,i=new Resource.Texture,i.fromAtlas=!0,i.ptr=this.texture,i.name=s,i.x=e.x,i.y=e.y,i.resize(e.w,e.h),i.isLoaded=!0,Resource.ctrl.add(i)
},loadAtlas:function(){if("object"!=typeof this.atlas)return console.warn("[Resource.SpriteSheet.loadFromAtlas]:","Incorrect atlas object, expected to be an Array."),!1;for(var t=[],e,i,n,s=this.atlas.length,o=0;s>o;o++)e=this.atlas[o],n=e.name||this.params,n?(e.x=e.x||this.params.x||0,e.y=e.y||this.params.y||0,e.width=e.width||this.params.width||1,e.height=e.height||this.params.height||1,t.push(e),i=new Resource.Texture,i.fromAtlas=!0,i.ptr=this.texture,i.name=n,i.x=e.x,i.y=e.y,i.resize(e.width,e.height),i.numFrames=e.numFrames||this.params.numFrames||1,i.isLoaded=!0,Resource.ctrl.add(i)):console.warn("[Resource.SpriteSheet.loadFromAtlas]:","No name defined for atlas item in "+this.name+" spritesheet.");return this.texture._frames=t,this.atlas=null,this.isLoaded=!0,!0},_onTextureEvent:function(t,e){e===Resource.Event.LOADED&&(this.texture.unsubscribe(this),this._isAtlasLoaded&&(this.loadData(this._response,this.format),Resource.ctrl.loadSuccess(this),this._response=null))},_onStateChange:function(){4===this._request.readyState&&(200===this._request.status?(this._isAtlasLoaded=!0,this._response=this._request.response,this._request=null,this.texture._isLoaded&&(this.loadData(this._response,this.format),Resource.ctrl.loadSuccess(this),this._response=null)):(this._isLoading=!1,this._request.onreadystatechange=null,this._request=null,Resource.ctrl.loadFailed(this)))},type:Resource.Type.SPRITE_SHEET,format:"",atlas:null,params:null,texture:null,_request:null,_response:null,_isAtlasLoaded:!1}),"use strict",Resource.Font=Resource.Basic.extend({init:function(t,e){if("string"==typeof t)e=t,t=void 0;else for(var i in t)this[i]=t[i];if(e){var n=e.lastIndexOf(".");-1!==n&&e.length-n<=5&&(this.format=e.substr(n+1,e.length-n-1),e=e.substr(0,n)),this.path=Resource.ctrl.rootPath+e,this.format||(this.format="fnt")}},load:function(){console.log("load")},type:Resource.Type.FONT,format:""}),"use strict",Resource.SVG=Resource.Texture.extend({fillRect:function(t,e,i,n){this.fullWidth<2&&this.fullHeight<2&&(this.resize(i+t,n+e),this.ctx.fillStyle=this._fillStyle),this.ctx.fillRect(t,e,i,n),this.loaded=!0},line:function(t,e,i,n){this.fullWidth<2&&this.fullHeight<2&&(this.resize(i,n),this.ctx.lineWidth=this._lineWidth,this.ctx.strokeStyle=this._strokeStyle),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,n),this.ctx.stroke(),this.loaded=!0},circle:function(t){this.fullWidth<2&&this.fullHeight<2&&(this.resize(2*t,2*t),this.ctx.lineWidth=this._lineWidth,this.ctx.fillStyle=this._fillStyle,this.ctx.strokeStyle=this._strokeStyle),this.ctx.beginPath(),this.ctx.arc(t,t,t,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.loaded=!0},tile:function(t,e,i){if(!t)return console.warn("[Resource.Texture.tile]:","No parameters specified."),void 0;if("string"==typeof t.texture&&(t.texture=Resource.ctrl.getTexture(t.texture)),!t.texture)return console.warn("[Resource.Texture.tile]:","Undefined texture."),void 0;var i=t.texture;if(!i._loaded)return i._isLoading||i.load(),this._loadCache={name:"tile",data:t},this.loaded=!1,i.subscribe(this,this.onTextureCacheEvent),void 0;var n=meta;t.x=t.x||0,t.y=t.y||0,t.width=t.width||i.fullWidth,t.height=t.height||i.fullHeight,t.width*=n.unitSize,t.height*=n.unitSize,this.resize(t.width,t.height),t.center&&(t.x+=(this.fullWidth&i.fullWidth-1)/2,t.y+=(this.fullHeight&i.fullHeight-1)/2);var s=this.ctx,o=t.x,r=t.y,h=Math.ceil(this.fullWidth/i.fullWidth)||1,a=Math.ceil(this.fullHeight/i.fullHeight)||1;o>0&&(h+=Math.ceil(o/i.fullWidth),o-=i.fullWidth),r>0&&(a+=Math.ceil(r/i.fullHeight),r-=i.fullHeight);for(var c=r,u=0;h>u;u++){for(var l=0;a>l;l++)s.drawImage(i.image,o,r),r+=i.trueHeight;o+=i.trueWidth,r=c}this.loaded=!0},stroke:function(t){if(!t)return console.warn("[Resource.Texture.stroke]:","No parameters specified."),void 0;if(!t.buffer)return console.warn("[Resource.Texture.stroke]:","No buffer defined."),void 0;var e=meta,i=e.unitSize,n=Number.POSITIVE_INFINITY,s=n,o=Number.NEGATIVE_INFINITY,r=o,h,a,c,u,l=t.buffer,d=l.length;for(a=0;d>a;a+=2)c=l[a]*i|0,u=l[a+1]*i|0,n>c&&(n=c),s>u&&(s=u),c>o&&(o=c),u>r&&(r=u),l[a]=c,l[a+1]=u;n>0&&(n=0),s>0&&(s=0);var m=this.ctx;t.addWidth=t.addWidth||0,t.addHeight=t.addHeight||0,t.lineWidth=t.lineWidth||1,t.color||t.fillColor||(t.color="#000000");var f=t.lineWidth/2,v=-n+f+.5*t.addWidth,p=-s+f+.5*t.addHeight;for(this.resize(o-n+t.lineWidth+t.addWidth,r-s+t.lineWidth),this.textureType&&(this._createCachedImg(),m=this._cachedCtx),m.lineWidth=t.lineWidth,t.lineCap&&(m.lineCap=t.lineCap),t.lineDash&&m.setLineDash(t.lineDash),m.beginPath(),m.moveTo(l[0]+v,l[1]+p),a=2;d>a;a+=2)m.lineTo(l[a]+v,l[a+1]+p);if(t.fillColor&&(m.fillStyle=t.fillColor,m.closePath(),m.fill()),t.color&&(m.strokeStyle=t.color,m.stroke()),this.textureType===Resource.TextureType.WEBGL){var _=e.ctx;_.bindTexture(_.TEXTURE_2D,this.image),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,this._cachedImg)}this.isLoaded=!0},border:function(t){if(!t)return console.warn("[Resource.Texture.strokeBorder]:","No parameters specified."),void 0;t.width=t.width||this.trueFullWidth,t.height=t.height||this.trueFullHeight;var e=1;t.borderWidth&&(e=t.borderWidth),t.buffer=[0,0,t.width-e,0,t.width-e,t.height-e,0,t.height-e,0,0],this.stroke(t)},arc:function(t){if(!t)return console.warn("[Resource.Texture.arc]:","No parameters specified."),void 0;var e=this.ctx;t.x=t.x||0,t.y=t.y||0,t.radius=t.radius||5,t.startAngle=t.startAngle||0,t.endAngle=t.endAngle||2*Math.PI,t.borderWidth=t.borderWidth||1,t.color||t.borderColor||(t.borderColor=t.borderColor||"#000000"),t.closePath=void 0===t.closePath?!0:t.closePath;var i=2*t.radius+t.borderWidth;if(t.drawOver||this.resize(t.x+i+1,t.y+i+1),this.textureType&&(this._createCachedImg(),e=this._cachedCtx),e.lineWidth=t.borderWidth,e.clearRect(0,0,this.trueFullWidth,this.trueFullHeight),t.closePath?(e.beginPath(),e.arc(t.x+t.radius+t.borderWidth/2+.5,t.y+t.radius+t.borderWidth/2+.5,t.radius,t.startAngle,t.endAngle,!1),e.closePath()):e.arc(t.x+t.radius+t.borderWidth/2,t.y+t.radius+t.borderWidth/2,t.radius,t.startAngle,t.endAngle,!1),t.color&&(e.fillStyle=t.color,e.fill()),t.borderColor&&(e.strokeStyle=t.borderColor,e.stroke()),this.textureType===Resource.TextureType.WEBGL){var n=meta.ctx;n.bindTexture(n.TEXTURE_2D,this.image),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this._cachedImg)}this.isLoaded=!0},rect:function(t,e,i,n){if("object"!=typeof t)return this.rect({width:t,height:e,color:i,borderWidth:n}),void 0;if(!t)return console.warn("[Resource.Texture.rect]:","No parameters specified."),void 0;var s=this.ctx,o=t.width||1,e=t.height||1;t.color=t.color||"#0000000";var n=t.borderWidth||1;t.drawOver||this.resize(o,e),this.textureType&&(this._createCachedImg(),s=this._cachedCtx),s.strokeStyle=t.color,s.lineWidth=n;var r=Math.ceil(n/2);if(n%2===1?(s.save(),s.translate(.5,.5),s.beginPath(),s.moveTo(r,r),s.lineTo(o-r-1,r),s.lineTo(o-r-1,e-r-1),s.lineTo(r,e-r-1),s.closePath(),s.stroke(),s.restore()):(s.beginPath(),s.moveTo(r,r),s.lineTo(o-r,r),s.lineTo(o-r,e-r),s.lineTo(r,e-r),s.closePath(),s.stroke()),t.fillColor&&(s.fillStyle=t.fillColor,s.fill()),this.textureType===Resource.TextureType.WEBGL){var h=meta.ctx;h.bindTexture(h.TEXTURE_2D,this.image),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,this._cachedImg)}this.isLoaded=!0},roundRect:function(t,e,i,n,s){if("object"!=typeof t)return this.roundRect({width:t,height:e,radius:i,color:n,borderWidth:s}),void 0;if(!t)return console.warn("[Resource.Texture.rect]:","No parameters specified."),void 0;var o=this.ctx,r=t.width||1,e=t.height||1;t.color=t.color||"#0000000";var i=t.radius||1,s=t.borderWidth||3;t.drawOver||this.resize(r,e),this.textureType&&(this._createCachedImg(),o=this._cachedCtx),o.strokeStyle=t.color,o.lineWidth=s;var h=Math.ceil(s/2);if(s%2===1?(o.save(),o.translate(.5,.5),o.beginPath(),o.moveTo(h+i,h),o.lineTo(r-h-i,h),o.quadraticCurveTo(r-h,h,r-h,h+i),o.lineTo(r-h,e-h-i),o.quadraticCurveTo(r-h,e-h,r-h-i,e-h),o.lineTo(h+i,e-h),o.quadraticCurveTo(h,e-h,h,e-h-i),o.lineTo(h,i+h),o.quadraticCurveTo(h,h,h+i,h),o.closePath(),o.stroke(),o.restore()):(o.beginPath(),o.moveTo(h+i,h),o.lineTo(r-h-i,h),o.quadraticCurveTo(r-h,h,r-h,h+i),o.lineTo(r-h,e-h-i),o.quadraticCurveTo(r-h,e-h,r-h-i,e-h),o.lineTo(h+i,e-h),o.quadraticCurveTo(h,e-h,h,e-h-i),o.lineTo(h,i+h),o.quadraticCurveTo(h,h,h+i,h),o.closePath(),o.stroke()),t.fillColor&&(o.fillStyle=t.fillColor,o.fill()),this.textureType===Resource.TextureType.WEBGL){var a=meta.ctx;a.bindTexture(a.TEXTURE_2D,this.image),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this._cachedImg)}this.isLoaded=!0},bazier:function(t,e,i){this.isLoaded=!0},gradient:function(t){if(!t)return console.warn("[Resource.Texture.gradient]:","No data specified."),void 0;if(!t.colors||!t.colors.length)return console.warn("[Resource.Texture.gradient]:","No data.colors specified."),void 0;var e=this.ctx;t.dirX=t.dirX||0,t.dirY=t.dirY||0,t.width=t.width||this.trueFullWidth||1,t.height=t.height||this.trueFullHeight||1,t.drawOver||this.resize(t.width,t.height),this.textureType&&(this._createCachedImg(),e=this._cachedCtx);var i=t.colors,n=i.length,s,o,r,h;t.dirX<0?(s=this.trueFullWidth,o=0):(s=0,o=this.trueFullWidth*t.dirX),t.dirY<0?(r=this.trueFullHeight,h=0):(r=0,h=this.trueFullHeight*t.dirY);for(var a=e.createLinearGradient(s,r,o,h),c=0;n>c;c++)a.addColorStop(i[c][0],i[c][1]);if(e.fillStyle=a,e.clearRect(0,0,this.trueFullWidth,this.trueFullHeight),e.fillRect(0,0,this.trueFullWidth,this.trueFullHeight),this.textureType){var u=meta.ctx;u.bindTexture(u.TEXTURE_2D,this.image),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,this._cachedImg)}this.isLoaded=!0},grid:function(t,e,i,n){if("number"==typeof t)return this.grid({cellWidth:t,cellHeight:e,numCellsX:i,numCellsY:n}),void 0;if(!t)return console.warn("[Resource.Texture.grid]:","No params specified."),void 0;var s=t.cellWidth||1,e=t.cellHeight||1,i=t.numCellsX||1,n=t.numCellsY||1;t.x=t.x||0,t.y=t.y||0,t.color=t.color||"#000000",t.borderWidth=t.borderWidth||1,t.drawOver=t.drawOver||!1;var o=t.x+t.cellWidth*t.numCellsX+1,r=t.y+t.cellHeight*t.numCellsY+1;t.drawOver||this.resize(o,r);var h=this.ctx;this.textureType&&(this._createCachedImg(),h=this._cachedCtx),h.strokeStyle=t.color,h.lineWidth=t.borderWidth,h.save(),h.translate(.5,.5);for(var a=0;i+1>a;a++)h.moveTo(a*e,0),h.lineTo(a*e,r);for(var c=0;n+1>c;c++)h.moveTo(0,c*e),h.lineTo(o,c*e);if(h.stroke(),h.restore(),this.textureType){var u=meta.ctx;u.bindTexture(u.TEXTURE_2D,this.image),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,this._cachedImg)}this.isLoaded=!0},onTextureEvent:function(t,e){t===Resource.Event.LOADED&&(this.tile(e),e.unsubscribe(this))},set lineWidth(t){this._lineWidth=t,this.ctx.lineWidth=t},get lineWidth(){return this._lineWidth},set fillStyle(t){this._fillStyle=t,this.ctx.fillStyle=t},get fillStyle(){return this._fillStyle},set strokeStyle(t){this._strokeStyle=t,this.ctx.strokeStyle=t},get strokeStyle(){return this._strokeStyle},_lineWidth:2,_fillStyle:"#000",_strokeStyle:"#000"}),"use strict";var Entity={Event:{INPUT_UP:"entityUp",INPUT_DOWN:"entityDown",CLICK:"entityClick",DBCLICK:"entityDbClick",DRAG:"drag",DRAG_START:"dragStart",DRAG_END:"dragEnd",HOVER:"hover",HOVER_ENTER:"hoverEnter",HOVER_EXIT:"hoverExit",STATE_CHANGE:"stateChange"},PositionType:{CENTER:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_LEFT:3,BOTTOM_RIGHT:4,TOP:5,BOTTOM:6,LEFT:7,RIGHT:8}};"use strict",Entity.Geometry=meta.class.extend({_init:function(t){this.volume=new meta.math.AABBext,this.anim=new meta.Anim(this),this.initFromParam(t)},initFromParam:function(t){if(t)if("string"==typeof t){var e=Resource.ctrl.getTexture(t);e?this.texture=e:console.warn("(Entity.Geometry) Unavailable texture - "+t)}else this.texture=t},update:null,draw:null,updatePos:function(){if(this.volume.x=this._x+this._parentX+this.anchorPosX,this.volume.y=this._y+this._parentY+this.anchorPosY,this.volume.updatePos(),this.children)for(var t,e=this.children.length,i=0;e>i;i++)t=this.children[i],t.ignoreParentPos||(t._parentX=this.volume.x,t._parentY=this.volume.y,t.updatePos());this.renderer.needRender=!0},position:function(t,e){(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.updatePos())},move:function(t,e){(0!==t||0!==e)&&(this._x+=t,this._y+=e,this.updatePos())},moveForward:function(t){var e=this._x+t*Math.cos(this.volume.angle-1.57079),i=this._y+t*Math.sin(this.volume.angle-1.57079);(this._x!==e||this._y!==i)&&(this._x=e,this._y=i,this.updatePos())},moveDirected:function(t,e){var i=this._x+-t*Math.cos(this.volume.angle-1.57079+e),n=this._y+-t*Math.sin(this.volume.angle-1.57079+e);(this._x!==i||this._y!==n)&&(this._x=i,this._y=n,this.updatePos())},strafe:function(t){var e=this._x+-t*Math.cos(this._angleRad+Math.PI),i=this._y+-t*Math.sin(this._angleRad+Math.PI);(this._x!==e||this._y!==i)&&(this._x=e,this._y=i,this.updatePos())},set x(t){this._x=t,this.updatePos()},set y(t){this._y=t,this.updatePos()},get x(){return this._x},get y(){return this._y},get absX(){return this.volume.x},get absY(){return this.volume.y},set z(t){this._z!==t&&(this._z=t,this.updateZ())},get z(){return this._z},updateZ:function(){if(this.totalZ=this._z+this._parentZ,this.children)for(var t,e=this.children.length,i=0;e>i;i++)t=this.children[i],t._parentZ=this.totalZ+1,t.updateZ();this.renderer.needSortDepth=!0},pivot:function(t,e){this.volume.pivot(t,e),meta.renderer.needRender=!0},set pivotX(t){this.volume.pivot(t,this.volume.pivotY),meta.renderer.needRender=!0},set pivotY(t){this.volume.pivot(this.volume.pivotX,t),meta.renderer.needRender=!0},get pivotX(){return this.volume.pivotX},get pivotY(){return this.volume.pivotY},anchor:function(t,e){void 0===e&&(e=t),this._anchorX=t,this._anchorY=e,this.updateAnchor()},updateAnchor:function(){if(this.anchorPosX=this.parent.volume.width*this._anchorX,this.anchorPosY=this.parent.volume.height*this._anchorY,this.volume.x=this._x+this._parentX+this.anchorPosX,this.volume.y=this._y+this._parentY+this.anchorPosY,this.volume.updatePos(),this.children)for(var t,e=this.children.length,i=0;e>i;i++)t=this.children[i],t._ignoreParentPos||(t._parentX=this.volume.x,t._parentY=this.volume.y,t.updateAnchor())},set anchorX(t){this._anchorX=t,this.updateAnchor()},set anchorY(t){this._anchorY=t,this.updateAnchor()},get anchorX(){return this._anchorX},get anchroY(){return this._anchorY},set angle(t){t=t*Math.PI/180,this.volume.angle!==t&&(this._angle=t,this.updateAngle())},set angleRad(t){this._angle!==t&&(this._angle=t,this.updateAngle())},get angle(){return 180*this.volume.angle/Math.PI},get angleRad(){return this.volume.angle},updateAngle:function(){if(this.volume.rotate(this._angle+this._parentAngle),this.children)for(var t,e=this.children.length,i=0;e>i;i++)t=this.children[i],t._ignoreParentAngle||(t._parentAngle=this.volume.angle,t.updateAngle());this.renderer.needRender=!0},scale:function(t,e){void 0===e&&(e=t),this._scaleX=t,this._scaleY=e,this.updateScale()},updateScale:function(){if(this.volume.scale(this._scaleX*this._parentScaleX,this._scaleY*this._parentScaleY),this.updateAnchor(),this.children)for(var t,e=this.children.length,i=0;e>i;i++)t=this.children[i],t._ignoreParentScale||(t._parentScaleX=this.volume.scaleX,t._parentScaleY=this.volume.scaleY,t.updateScale())},set scaleX(t){this._scaleX!==t&&(this._scaleX=t,this.updateScale())},set scaleY(t){this._scaleY!==t&&(this._scaleY=t,this.updateScale())},get scaleX(){return this._scaleX},get scaleY(){return this._scaleY},flip:function(t,e){this.volume.flip(t,e),meta.renderer.needRender=!0},set flipX(t){this.flip(t,this.volume.flipY)},set flipY(t){this.flip(this.volume.flipX,t)},get flipX(){return this.volume.flipX},get flipY(){return this.volume.flipY},set alpha(t){this._alpha=t,this.volume.__transformed=1,this.renderer.needRender=!0},get alpha(){return this._alpha},resize:function(t,e){if(this.volume.resize(t,e),this.updatePos(),this.children)for(var i=this.children.length,n=0;i>n;n++)this.children[n]._updateResize();this.renderer.needRender=!0},_updateResize:function(){this.updateAnchor(),this.onResize&&this.onResize()},onResize:null,_onTextureEvent:function(t,e){var i=Resource.Event;e===i.LOADED?this.loaded=!0:e===i.UNLOADED&&(this.loaded=!1),this.updateFromTexture()},updateFromTexture:function(){this._texture?this.volume.resize(this._texture.width,this._texture.height):this.volume.resize(0,0),this.updateAnchor()},set texture(t){if(this.texture!==t){if(this._texture&&this._texture.unsubscribe(this),t){if("string"==typeof t){if(this._texture=Resource.ctrl.getTexture(t),!this._texture)return console.warn("(Entity.Geometry) Unavailable texture - "+t),void 0}else this._texture=t;this._texture.subscribe(this,this._onTextureEvent),this._texture._loaded&&(this.updateFromTexture(),this.loaded=!0)}else this._texture=t,this.loaded=!1;this.anim.set(this._texture)}},get texture(){return this._texture},set needRender(t){this._needRender=t,t&&(meta.renderer.needRender=!0)},get needRender(){return this._needRender},set updating(t){t?this.renderer.addUpdating(this):this.renderer.removeUpdating(this)},get updating(){return this.__updateIndex>-1?!0:!1},attach:function(t){return t?(this.children?this.children.push(t):this.children=[t],this._static&&(t._static=!0),this._debugger&&(t._debugger=!0),t.parent=this,this.updatePos(),this.updateZ(),0!==this.totalAngle&&this.updateAngle(),this._view&&this._view._active&&this.renderer.addEntity(t),void 0):(console.warn("(Entity.Geometry.attach) Invalid entity passed"),void 0)},detach:function(t){this.renderer.needRender=!0},detachAll:function(){if(this.children){for(var t=this.children.length,e=0;t>e;e++)this.detach(this.children[e]);this.children=null,this.renderer.needRender=!0}},set visible(t){this._visible!==t&&(this._visible=t,this.renderer.needRender=!0)},get visible(){return this._visible},set static(t){if(this._static!==t){if(this._static=t,this.children)for(var e=this.children.length,i=0;e>i;i++)this.children[i].static=t;this.renderer.needRender=!0}},get static(){return this._static},set debugger(t){this._debugger!==t&&(this._debugger=t,this.renderer.needRender=!0)},get debugger(){return this._debugger},set state(t){this._state!==t&&(this.onStateExit&&this.onStateExit(),this._state=t,this._style&&this.updateState(),this.onStateEnter&&this.onStateEnter())},get state(){return this._state},set style(t){t?(this._style=t instanceof meta.Style?t:new meta.Style(t),this.updateState()):this._style=null},get style(){return this._style},updateState:function(){this._style.update(this)},onStateChange:null,set pickable(t){this._pickable!==t&&(this._pickable=t,t?meta.renderer.addPicking(this):meta.renderer.removePicking(this))},get pickable(){return this._pickable},isPointInside:function(t,e){if(1==this.volume.__transformed){var i=t-this.volume.x,n=e-this.volume.y;t=i*this.volume.cos+n*this.volume.sin+this.volume.x,e=n*this.volume.cos-i*this.volume.sin+this.volume.y}return this.volume.vsPoint(t,e)},isPointInsidePx:function(t,e){var i=this.volume;if(1==i.__transformed){var n=t-i.x,s=e-i.y;t=n*i.cos+s*i.sin+i.x,e=s*i.cos-n*i.sin+i.y}if(!this.volume.vsPoint(t,e))return!1;var n=(t-i.minX)/i.scaleX|0,s=(e-i.minY)/i.scaleY|0,o=this._texture.getPixelAt(n,s);return o[3]>50?!0:!1},onDown:null,onUp:null,onClick:null,onDbClick:null,onDrag:null,onDragStart:null,onDragEnd:null,onHover:null,onHoverEnter:null,onHoverExit:null,addTimer:function(t,e,i){var n=meta.addTimer(this,t,e,i);return this.timers?this.timers.push(n):this.timers=[n],n},set tween(t){if(!t)return this._tween=null,void 0;if(this._tweenCache?this._tweenCache.stop():this._tweenCache=new meta.Tween.Cache(this),t instanceof meta.Tween.Link)this._tweenCache.tween=t.tween;else{if(!(t instanceof meta.Tween))return console.warn("(Entity.Geometry.set::tween) Ivalid object! Should be meta.Tween or meta.Tween.Link object"),void 0;this._tweenCache.tween=t}var e=this._tweenCache.tween;e.autoPlay&&(e.cache=this._tweenCache,e.play())},get tween(){return this._tweenCache?this._tweenCache.tween:null},addComponent:function(t,e,i){t instanceof Object&&(i=e,e=t,t=null);var n=new e;if(n.owner=this,t){if(this[t])return console.warn("(Entity.Geometry.addComponent) Already in use: "+t),null;this[t]=n}if(i)for(var s in i)n[s]=i[s];return this.components?this.components.push(n):this.components=[n],n.load&&n.load(),this.loaded&&n.ready&&n.ready(),n},removeComponent:function(t){var e=this[t];if(!e||"object"!=typeof e)return console.warn("(Entity.Geometry.removeComponent) Invalid component in: "+t),void 0;for(var i=!1,n=this.components.length,s=0;n>s;s++)if(this.components[s]===e){this.components[s]=this.components[n-1],this.components.pop(),i=!0;break}return i?(e.unload&&e.unload(),this[t]=null,void 0):(console.warn("(Entity.Geometry.removeComponent) No such components added in: "+t),void 0)},removeAllComponents:function(){if(components)for(var t=this.components.length,e=0;t>e;e++)this.removeComponent(this.components[e])},lookAt:function(t,e){this.angleRad=this._ignoreParentAngle?-Math.atan2(t-this.volume.x,e-this.volume.y)+Math.PI:-Math.atan2(t-this.volume.x,e-this.volume.y)+Math.PI-this.parent.volume.angle},set ignoreParentPos(t){this._ignoreParentPos=t,t?(this._parentX=0,this._parentY=0,this.updatePos()):this.parent.updatePos()},get ignoreParentPos(){return this._ignoreParentPos},set ignoreParentAngle(t){this._ignoreParentAngle=t,t?(this._parentAngle=0,this.updateAngle()):this.parent.updateAngle()},get ignoreParentAngle(){return this._ignoreParentAngle},set ignoreParentScale(t){this._ignoreParentScale=t,t?(this._parentScaleX=1,this._parentScaleY=1,this.updateScale()):this.parent.updateScale()},get ignoreParentScale(){return this._ignoreParentScale},set debug(t){this.__debug!==t&&(this.__debug=t,t?meta.renderer.numDebug++:meta.renderer.numDebug--,meta.renderer.needRender=!0)},get debug(){return this.__debug},renderer:null,parent:null,_view:null,_texture:null,_x:0,_y:0,_parentX:0,_parentY:0,_z:0,totalZ:0,_parentZ:0,_angle:0,_parentAngle:0,_alpha:1,totalAlpha:0,_parentAlpha:0,_scaleX:1,_scaleY:1,_parentScaleX:1,_parentScaleY:1,_anchorX:0,_anchorY:0,anchorPosX:0,anchorPosY:0,loaded:!0,_removed:!1,_visible:!0,_static:!1,_debugger:!1,body:null,children:null,anim:null,_style:null,_styleState:null,_styleAction:null,_styleParams:null,_styleActionParams:null,_state:"*",_action:"",__stateIndex:-1,timers:null,_tweenCache:null,components:null,_pickable:!1,__picking:!1,hover:!1,pressed:!1,dragged:!1,_ignoreParentPos:!1,_ignoreParentZ:!1,_ignoreParentAngle:!1,_ignoreParentAlpha:!1,_ignoreParentScale:!1,__added:!1,__debug:!1,__updateIndex:-1}),"use strict",Entity.Text=Entity.Geometry.extend({init:function(t){this.texture=new Resource.Texture,this._texture.resize(this._fontSize,this._fontSize);var e=typeof t;("string"===e||"number"===e)&&(this._text=t,this.updateTxt())},initFromParam:function(){},updateTxt:function(){var t=this._texture.ctx;t.font=this._style+" "+this._fontSizePx+" "+this._font;var e=t.measureText(this._text),i=e.width,n=0;this._outline&&(i+=2*this._outlineWidth,n+=this._outlineWidth),this._shadow&&(i+=2*this._shadowBlur,n+=this._shadowBlur),this._texture.resize(i,1.3*this._fontSize),t.clearRect(0,0,this.volume.width,this.volume.height),t.font=this._style+" "+this._fontSizePx+" "+this._font,t.fillStyle=this._color,t.textBaseline="top",this._shadow&&(t.shadowColor=this._shadowColor,t.shadowOffsetX=this._shadowOffsetX,t.shadowOffsetY=this._shadowOffsetY,t.shadowBlur=this._shadowBlur),t.fillText(this._text,n,0),this._outline&&(t.lineWidth=this._outlineWidth,t.strokeStyle=this._outlineColor,t.strokeText(this._text,this._outlineWidth,0)),this.renderer.needRender=!0},set text(t){this._text=t,this.updateTxt()},get text(){return this._text},set font(t){this._font=t,this.updateTxt()},get font(){return this._font},set size(t){this._fontSize=t,this._fontSizePx=t+"px",this.updateTxt()},get size(){return this._fontSize},set color(t){this._color=t,this.updateTxt()},get color(){return this._color},set style(t){this._style!==t&&(this._style=t,this.updateTxt())},get style(){return this._style},set outlineColor(t){this._outlineColor!==t&&(this._outlineColor=t,this._outline=!0,his.updateTxt())},get outlineColor(){return this._outlineColor},set outlineWidth(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._outline=!0,this.updateTxt())},get outlineWidth(){return this._outlineWidth},set outline(t){this._outline!==t&&(this._outline=t,this.updateTxt())},get outline(){return this._outline},set shadow(t){this._shadow!==t&&(this._shadow=t,this.updateTxt())},get shadow(){return this._shadow},set shadowColor(t){this._shadowColor!==t&&(this._shadowColor=t,this._shadow=!0,this.updateTxt())},get shadowColor(){return this._shadowColor},set shadowBlur(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._shadow=!0,this.updateTxt())},get shadowBlur(){return this._shadowBlur},set shadowOffsetX(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._shadow=!0,this.updateTxt())},set shadowOffsetY(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._shadow=!0,this.updateTxt())},get shadowOffsetX(){return this._shadowOffsetY},get shadowOffsetY(){return this._shadowOffsetY},_text:"",_font:"Tahoma",_fontSize:12,_fontSizePx:"12px",_color:"#fff",_style:"",_outline:!1,_outlineColor:"#000",_outlineWidth:1,_shadow:!0,_shadowColor:"#000",_shadowBlur:3,_shadowOffsetX:0,_shadowOffsetY:0}),"use strict",Entity.Tiling=Entity.Geometry.extend({init:function(t){var e=meta.camera.volume,i=new Resource.Texture;i.resizeSilently(e.width,e.height),this.texture=i,this.tile(t)},tile:function(t){if(this.tileTexture&&!this.tileTexture._loaded&&this.tileTexture.unsubscribe(this),"string"==typeof t){if(this.tileTexture=meta.getTexture(t),!this.tileTexture)return console.warn("(Entity.Tiling.tile) Could not find texture with a name - "+t),void 0}else this.tileTexture=t;return this.tileTexture._loaded?(this.updateTiling(),void 0):(this.tileTexture.subscribe(this,this.onTextureEvent),void 0)},options:function(t){this.tileX=t.tileX||0,this.tileY=t.tileY||0;var e=t.follow||!1;e!==this.follow?meta.subscribe(this,meta.Event.CAMERA_MOVE,this.onResize):meta.unsubscribe(this,meta.Event.CAMERA_MOVE),this.follow=e,this.updateTiling()},updateTiling:function(){if(this.tileTexture._loaded){this._texture.clear();var t=this.tileX,e=this.tileY,i=meta.camera.volume,n=Math.abs(i.x%this.tileTexture.fullWidth-this.tileTexture.fullWidth),s=Math.abs(i.y%this.tileTexture.fullHeight-this.tileTexture.fullHeight),o=Math.ceil((this._texture.fullWidth+n)/this.tileTexture.fullWidth),r=Math.ceil((this._texture.fullHeight+s)/this.tileTexture.fullHeight);t=o,e=r;for(var h=n,a=s,c=this._texture.ctx,u=this.tileTexture.canvas,n=h,s=a,l=0;e>l;l++){for(var d=0;t>d;d++)c.drawImage(u,n,s),n+=this.tileTexture.width;n=h,s+=this.tileTexture.height}this._texture.loaded=!0}},updateScale:function(){this._super(),this.updateResolution(),this.updateTiling()},updateResolution:function(){var t=meta.camera.volume,e=t.width/this.volume.scaleX,i=t.height/this.volume.scaleY;(this._texture.fullWidth!==e||this._texture.fullHeight!==i)&&this._texture.resizeSilently(e,i)},onTextureEvent:function(t,e){e===Resource.Event.LOADED&&(this.tileTexture.unsubscribe(this),this.updateTiling())},onResize:function(t,e){this.updateResolution(),this.updateTiling()},tileTexture:null,follow:!1,tileX:0,tileY:0}),"use strict",Entity.SVG=Entity.Geometry.extend({set lineWidth(t){this._lineWidth=t,this.renderer.needRender=!0},get lineWidth(){return this._lineWidth},set strokeStyle(t){this._strokeStyle=t,this.renderer.needRender=!0},get strokeStyle(){return this._strokeStyle},_lineWidth:0,_strokeStyle:"#000"}),"use strict",Entity.Line=Entity.SVG.extend({draw:function(t){this.globalAlpha=this._alpha,t.lineWidth=this._lineWidth,t.strokeStyle=this._strokeStyle,t.beginPath(),t.moveTo(this.volume.x+this.x1,this.volume.y+this.y1),t.lineTo(this.volume.x+this.x2,this.volume.y+this.y2),t.stroke(),this.globalAlpha=1},set:function(t,e,i,n){(this.x2!==i||this.y2!==n||this.x1!==t||this.y1!==e)&&(this.x1=t,this.y1=e,this.x2=i,this.y2=n,this.renderer.needRender=!0)},x1:0,y1:0,x2:0,y2:0}),"use strict",window.Input={},Input.Controller=meta.Controller.extend({init:function(){this.engine=meta.engine,this.keys=new Array(this.numKeys),this.inputs=new Array(this.numInputs),this.touches=[],this._event={event:null,x:0,y:0,prevScreenX:0,prevScreenY:0,screenX:0,screenY:0,keyCode:0,entity:null},this.addEventListeners(),this._loadIgnoreKeys(),meta.subscribe(this,meta.Event.FOCUS,this.onFocus)},release:function(){this.removeEventListeners(),meta.unsubscribe(this,meta.Event.FOCUS,this.onFocus)},onKeyDown:function(t){if(window.top&&this._iFrameKeys[t.keyCode]&&t.preventDefault(),void 0!==this._cmdKeys[t.keyCode]&&this._numCmdKeys++,void 0!==this._ignoreKeys[t.keyCode]&&this._numCmdKeys<=0&&t.preventDefault(),!(this.blockInput||this.isStickyKeys&&this.keys[t.keyCode])){if(this.keys[t.keyCode]=!0,this._event.event=t,this._event.prevScreenX=0,this._event.prevScreenY=0,this._event.screenX=0,this._event.screenY=0,this._event.x=0,this._event.y=0,this._event.keyCode=t.keyCode,this.chn.keyDown.emit(this._event,Input.Event.KEY_DOWN),this._callbacks&&this._callbacks[t.keyCode])for(var e=this._callbacks[t.keyCode],i=e.length,n=0;i>n;n++)e[n]();if(this.keyRepeat){if(!this._inputTimer){var s=this;this._inputTimer=meta.addTimer(this,function(){s._event.keyCode=s._repeatKey,s.chn.keyDown.emit(s._event,Input.Event.KEY_DOWN)},this.keyRepeat)}this._repeatKey=t.keyCode,this._inputTimer.resume(),this._inputTimer.tAccumulator=0}}},onKeyUp:function(t){window.top&&this._iFrameKeys[t.keyCode]&&t.preventDefault(),void 0!==this._cmdKeys[t.keyCode]&&this.keys[t.keyCode]&&this._numCmdKeys--,void 0===this._ignoreKeys[t.keyCode]&&this._numCmdKeys<=0&&t.preventDefault(),this.blockInput||(this.keys[t.keyCode]=!1,this._event.event=t,this._event.prevScreenX=0,this._event.prevScreenY=0,this._event.prevX=0,this._event.prevY=0,this._event.x=0,this._event.y=0,this._event.keyCode=t.keyCode,this._e,this.chn.keyUp.emit(this._event,Input.Event.KEY_UP),this.keyRepeat&&this._inputTimer&&this._inputTimer.pause())},onMouseDown:function(t){if(!this.blockInput){this.inputs[t.button]=!0;var e=meta,i=e.camera;this.screenX=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,this.screenY=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,this.x=this.screenX*i.zoomRatio+i.volume.x|0,this.y=this.screenY*i.zoomRatio+i.volume.y|0,this._event.event=t,this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.x,this._event.y=this.y,this._event.keyCode=t.button,this.chn.inputDown.emit(this._event,Input.Event.DOWN),this._event.entity=null}},onMouseUp:function(t){if(!this.blockInput){this.inputs[t.button]=!1;var e=meta,i=e.camera;this.screenX=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,this.screenY=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,this.x=this.screenX*i.zoomRatio+i.volume.x|0,this.y=this.screenY*i.zoomRatio+i.volume.y|0,this._event.event=t,this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.x,this._event.y=this.y,this._event.keyCode=t.button,this.chn.inputUp.emit(this._event,Input.Event.UP),this.chn.inputClick.emit(this._event,Input.Event.CLICK),this._event.entity=null}},onMouseMove:function(t){if(t.preventDefault(),!this.blockInput){var e=meta,i=e.camera;this.screenX=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,this.screenY=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,this.x=this.screenX*i.zoomRatio+i.volume.x|0,this.y=this.screenY*i.zoomRatio+i.volume.y|0,this._event.event=t,this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.x,this._event.y=this.y,this._event.keyCode=-1,this.chn.inputMove.emit(this._event,Input.Event.MOVE),this._event.entity=null
}},onMouseDbClick:function(t){if(!this.blockInput){this.inputs[t.button]=!1;var e=meta,i=e.camera;this.screenX=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,this.screenY=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,this.x=this.screenX*i.zoomRatio+i.volume.x|0,this.y=this.screenY*i.zoomRatio+i.volume.y|0,this._event.event=t,this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.x,this._event.y=this.y,this._event.keyCode=t.button,this.chn.inputDbClick.emit(this._event,Input.Event.DBCLICK),this._event.entity=null}},onTouchDown:function(t){t.preventDefault();for(var e=meta,i=e.camera,n,s,o,r,h,a,c=t.changedTouches,u=c.length,l=0;u>l;l++)a=this.touches.length,n=t.changedTouches[l],this.touches.push(n.identifier),this.numTouches++,s=(n.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,o=(n.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,r=s*i.zoomRatio+i.volume.x|0,h=o*i.zoomRatio+i.volume.y|0,this._event.event=t,this._event.prevScreenX=s,this._event.prevScreenY=o,this._event.screenX=s,this._event.screenY=o,this._event.x=r,this._event.y=h,this._event.keyCode=a,0===a&&(this.screenX=s,this.screenY=o,this.x=r,this.y=h),this.chn.inputDown.emit(this._event,Input.Event.DOWN),this._event.entity=null},onTouchUp:function(t){t.preventDefault();for(var e=meta,i=e.camera,n,s,o,r,h,a,c=t.changedTouches,u=c.length,l=0;u>l;l++)n=t.changedTouches[l],s=this._getTouchID(n.identifier),-1!==s&&(this.touches.splice(s,1),this.numTouches--,o=(n.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,r=(n.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,h=o*i.zoomRatio+i.volume.x|0,a=r*i.zoomRatio+i.volume.y|0,this._event.event=t,0===s?(this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this.screenX=o,this.screenY=r,this.x=h,this.y=a):(this._event.prevScreenX=o,this._event.prevScreenY=r),this._event.screenX=o,this._event.screenY=r,this._event.x=h,this._event.y=a,this._event.keyCode=s,this.chn.inputDown.emit(this._event,Input.Event.UP),this.chn.inputClick.emit(this._event,Input.Event.CLICK),this._event.entity=null)},onTouchMove:function(t){t.preventDefault();for(var e=meta,i=e.camera,n,s,o,r,h,a,c=t.changedTouches,u=c.length,l=0;u>l;l++)n=t.changedTouches[l],s=this._getTouchID(n.identifier),-1!==s&&(o=(n.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,r=(n.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,h=o*i.zoomRatio+i.volume.x|0,a=r*i.zoomRatio+i.volume.y|0,this._event.event=t,0===s?(this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this.inputX=h,this.inputY=a,this.screenX=o,this.screenY=r,this.x=h,this.y=a):(this._event.prevScreenX=o,this._event.prevScreenY=r),this._event.screenX=o,this._event.screenY=r,this._event.x=h,this._event.y=a,this._event.keyCode=s,this.chn.inputMove.emit(this._event,Input.Event.MOVE),this._event.entity=null)},onFocus:function(t,e){e===!1&&this.resetInput()},isDown:function(t){return this.keys[t]},isInputDown:function(t){return this.inputs[t]||this.numTouches-1===t},addEventListeners:function(){var t=this;this.chn={keyDown:meta.createChannel(Input.Event.KEY_DOWN),keyUp:meta.createChannel(Input.Event.KEY_UP),inputDown:meta.createChannel(Input.Event.DOWN),inputUp:meta.createChannel(Input.Event.UP),inputMove:meta.createChannel(Input.Event.MOVE),inputClick:meta.createChannel(Input.Event.CLICK),inputDbClick:meta.createChannel(Input.Event.DBCLICK)},this.func={keyDown:function(e){t.onKeyDown(e)},keyUp:function(e){t.onKeyUp(e)},mouseDown:function(e){t.onMouseDown(e)},mouseUp:function(e){t.onMouseUp(e)},mouseDbClick:function(e){t.onMouseDbClick(e)},mouseMove:function(e){t.onMouseMove(e)},touchDown:function(e){t.onTouchDown(e)},touchUp:function(e){t.onTouchUp(e)},touchMove:function(e){t.onTouchMove(e)},touchCancel:function(e){t.onTouchCancel(e)}},window.addEventListener("mousedown",this.func.mouseDown),window.addEventListener("mouseup",this.func.mouseUp),window.addEventListener("mousemove",this.func.mouseMove),window.addEventListener("dblclick",this.func.mouseDbClick),window.addEventListener("touchstart",this.func.touchDown),window.addEventListener("touchend",this.func.touchUp),window.addEventListener("touchmove",this.func.touchMove),window.addEventListener("touchcancel",this.func.touchUp),window.addEventListener("touchleave",this.func.touchUp),meta.device.support.onkeydown&&window.addEventListener("keydown",this.func.keyDown),meta.device.support.onkeyup&&window.addEventListener("keyup",this.func.keyUp)},removeEventListeners:function(){window.removeEventListener("mousedown",this.func.mouseDown),window.removeEventListener("mouseup",this.func.mouseUp),window.removeEventListener("mousemove",this.on.mouseMove),window.removeEventListener("dblclick",this.on.mouseDbClick),window.removeEventListener("touchstart",this.on.touchDown),window.removeEventListener("touchend",this.on.touchUp),window.removeEventListener("touchmove",this.on.touchMove),window.removeEventListener("touchcancel",this.on.touchUp),window.removeEventListener("touchleave",this.on.touchUp),meta.device.support.onkeydown&&window.removeEventListener("keydown",this.on.keyDown),meta.device.support.onkeyup&&window.removeEventListener("keyup",this.on.keyUp)},resetInput:function(){var t;for(this._event.event=null,this._event.prevX=0,this._event.prevY=0,this._event.x=0,this._event.y=0,this._event.keyCode=0,t=0;t<this.numKeys;t++)this.keys[t]&&(this.keys[t]=!1,this._event.keyCode=t,this.chn.keyUp.emit(this._event,Input.Event.KEYUP));for(t=0;t<this.numInputs;t++)this.inputs[t]&&(this.inputs[t]=!1,this._event.keyCode=t,this.chn.inputUp.emit(this._event,Input.Event.UP));if(this._numCmdKeys=0,this.numTouches){for(t=0;t<this.numTouches;t++)this._event.keyCode=t,this.chn.inputUp.emit(this._event,Input.Event.UP);this.touches.length=0,this.numTouches=0}},onKey:function(t,e){this._callbacks?this._callbacks[t]?this._callbacks[t].push(e):this._callbacks[t]=[e]:(this._callbacks={},this._callbacks[t]=[e])},getEvent:function(){return this._event.event=null,this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.inputX,this._event.y=this.inputY,this._event.keyCode=-1,this._event},_loadIgnoreKeys:function(){this._ignoreKeys=[],this._ignoreKeys[8]=1,this._ignoreKeys[9]=1,this._ignoreKeys[13]=1,this._ignoreKeys[17]=1,this._ignoreKeys[91]=1,this._ignoreKeys[38]=1,this._ignoreKeys[39]=1,this._ignoreKeys[40]=1,this._ignoreKeys[37]=1,this._ignoreKeys[124]=1,this._ignoreKeys[125]=1,this._ignoreKeys[126]=1,this._cmdKeys=[],this._cmdKeys[91]=1,this._cmdKeys[17]=1,this._iFrameKeys=[],this._iFrameKeys[37]=1,this._iFrameKeys[38]=1,this._iFrameKeys[39]=1,this._iFrameKeys[40]=1},_ignoreFKeys:function(t){this._ignoreKeys[112]=t,this._ignoreKeys[113]=t,this._ignoreKeys[114]=t,this._ignoreKeys[115]=t,this._ignoreKeys[116]=t,this._ignoreKeys[117]=t,this._ignoreKeys[118]=t,this._ignoreKeys[119]=t,this._ignoreKeys[120]=t,this._ignoreKeys[121]=t,this._ignoreKeys[122]=t,this._ignoreKeys[123]=t},set ignoreFKeys(t){this._ignoreFKeys(t?1:0)},get ignoreFKeys(){return!!this._ignoreKeys[112]},_getTouchID:function(t){for(var e=0;e<this.numTouches;e++)if(this.touches[e]===t)return e;return-1},engine:meta.engine,chn:null,func:null,keys:null,inputs:null,touches:null,blockInput:!1,isStickyKeys:!0,keyRepeat:0,_inputTimer:null,_repeatKey:0,numKeys:256,numInputs:10,numTouches:0,x:0,y:0,screenX:0,screenY:0,_event:null,_ignoreKeys:null,_cmdKeys:null,_iFrameKeys:null,_numCmdKeys:0,_callbacks:null}),"use strict",Input.Event={KEY_DOWN:"keydown",KEY_UP:"keyup",DOWN:"down",UP:"up",MOVE:"move",CLICK:"click",DBCLICK:"dbclick"},Input.Key={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"[":91,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,ESC:27,SPACE:32,NUM_0:48,NUM_1:49,NUM_2:50,NUM_3:51,NUM_4:52,NUM_5:53,NUM_6:54,NUM_7:55,NUM_8:56,NUM_9:57,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DELETE:127,PLUS:187,MINUS:189,TILDE:192,APOSTROPHE:222,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,BUTTON_LEFT:0,BUTTON_MIDDLE:1,BUTTON_RIGHT:2},"use strict";var Physics={};Physics.Manifold=function(){this.a=null,this.b=null,this.normal=new meta.math.Vector2(0,0),this.penetration=0},Physics.Controller=meta.Controller.extend({init:function(){meta.subscribe(this,meta.Event.DEBUG,this.onDebug)},update:function(t){for(var e,i,n,s,o=this.items.length,r=0;o>r;r++)if(e=this.items[r],e.updateItem(t,this.manifold),e.owner.visible)for(n=r+1;o>n;n++)i=this.items[n],i.owner.visible&&e.flag!==i.flag&&(s=this.overlapAABB(e.volume,i.volume),s&&(e.onCollision&&(this.manifold.a=e.owner,this.manifold.b=i.owner,e.onCollision(this.manifold)),i.onCollision&&(this.manifold.a=i.owner,this.manifold.b=e.owner,i.onCollision(this.manifold))))},render:function(t){var e=meta.renderer.ctx;e.save(),e.fillStyle="#00ff00",e.globalAlpha=.4;for(var i=this.items.length,n=0;i>n;n++)this.drawVolume(e,this.items[n]);e.restore()},drawVolume:function(t,e){var i=e.volume;t.fillRect(0|i.minX,0|i.minY,i.width,i.height)},overlapAABB:function(t,e){var i=e.minX-t.minX,n=e.minY-t.minY,s=(t.maxX-t.minX)/2,o=(e.maxX-e.minX)/2,r=s+o-Math.abs(i);if(r>0){s=(t.maxY-t.minY)/2,o=(e.maxY-e.minY)/2;var h=s+o-Math.abs(n);if(h>0)return h>r?(0>i?this.manifold.normal.set(-1,0):this.manifold.normal.set(1,0),this.manifold.penetration=r,!0):(0>n?this.manifold.normal.set(0,-1):this.manifold.normal.set(0,1),this.manifold.penetration=h,!0)}return!1},add:function(t){return t instanceof Entity.Geometry?(t.addComponent("body",Physics.Body),void 0):(console.warn("(Physics.Controller.add) Object should be a part of Entity.Geometry:",t),void 0)},onDebug:function(t,e){t?meta.renderer.addRender(this):meta.renderer.removeRender(this)},items:[],manifold:new Physics.Manifold,_relativeVel:new meta.math.Vector2(0,0),_impulseX:0,_impulseY:0,_percent:.8,_slop:.01}),"use strict",Physics.Body=meta.class.extend({init:function(){this.velocity=new meta.math.Vector2(0,0)},load:function(){this._volume=this.owner.volume,Physics.ctrl.items.push(this)},unload:function(){},updateItem:function(t,e){this.speed+=this.acceleration*t,this.speed>this.maxSpeed&&(this.speed=this.maxSpeed);var i=this.owner.volume;if(this.volume.position(i.x,i.y),this.haveTarget){var n=meta.math.length(i.x,i.y,this.targetX,this.targetY);n<=this.speed*t?(this.volume.position(this.targetX,this.targetY),this.owner.position(this.targetX,this.targetY),this.stop()):(this._helperVec.x=this.targetX-i.x,this._helperVec.y=this.targetY-i.y,this._helperVec.normalize(),this.velocity.x=this._helperVec.x*this.speed,this.velocity.y=this._helperVec.y*this.speed)}if(this.volume.move(this.velocity.x*t,this.velocity.y*t),this.worldBounds){var s=this.volume.x,o=this.volume.y,r=meta.world;this.volume.minX<0?(s=this.volume.x-this.volume.minX,e.normal.set(1,0)):this.volume.maxX>r.width&&(s+=r.width-this.volume.maxX,e.normal.set(-1,0)),this.volume.minY<0?(o=this.volume.y-this.volume.minY,e.normal.set(0,1)):this.volume.maxY>r.height&&(o+=r.height-this.volume.maxY,e.normal.set(0,-1)),this.volume.position(s,o)}this.owner.position(this.volume.x,this.volume.y)},onCollision:null,moveTo:function(t,e,i,n){this.targetX=t,this.targetY=e,this.haveTarget=!0,this.speed=i||600,this.moveToCB=n||null},stop:function(){this.speed=0,this.acceleration=0,this.velocity.x=0,this.velocity.y=0,this.haveTarget&&(this.haveTarget=!1,this.moveToCB&&(this.moveToCB.call(this.owner),this.moveToCB=null)),this.onStop&&this.onStop.call(this.owner)},onStop:null,set volume(t){this._volume=t,this._volume.position(this.owner.volume.x,this.owner.volume.y)},get volume(){return this._volume},set mass(t){this._mass=t,this.invMass=0===t?0:1/t},get mass(){return this._mass},_volume:null,_mass:100,invMass:.01,restitution:.6,velocity:null,worldBounds:!1,ghost:!1,targetX:0,targetY:0,haveTarget:!1,moveToCB:null,maxSpeed:Number.MAX_VALUE,acceleration:0,_helperVec:new meta.math.Vector2(0,0)}),"use strict";var UI={};UI.Controller=meta.Controller.extend({init:function(){var t=new Resource.Texture;t.fillRect({color:"#111",width:120,height:30});var e=new Resource.Texture;e.fillRect({color:"#ff0000",width:120,height:30}),this.coreStyle={button:{"*:hover":{cursor:"pointer"},"*:pressed, *:drag":{cursor:"pointer",offsetX:1,offsetY:1}},checkbox:{"*:hover":{cursor:"pointer"},"*:pressed, *:drag":{cursor:"pointer",offsetX:1,offsetY:1}}},this.style={button:{"*":{texture:t},"*:hover":{texture:e,cursor:"pointer"},"*:pressed":{texture:e,cursor:"pointer",offsetX:1,offsetY:1}},checkbox:{"*":{texture:t},"*:hover":{texture:e,cursor:"pointer"},"*:pressed":{texture:e,cursor:"pointer",offsetX:1,offsetY:1},"[off]":{texture:t},"[on]":{texture:e}}}},coreStyle:null,style:null}),"use strict",UI.Button=Entity.Geometry.extend({_initParams:function(t){this.style=t?meta.createStyle(t,UI.ctrl.coreStyle.button):UI.ctrl.style.button},set text(t){this._text?this._text.setText(t):(this._text=new Entity.Text(t),this._text.size=12,this._text.color="#ffffff",this.attach(this._text),this._text.anchor(.5),this._text.pickable=!1)},get text(){return this._text?this._text._text:""},_text:null}),"use strict",UI.Checkbox=Entity.Geometry.extend({_initParams:function(t){this.style=t?meta.createStyle(t,UI.ctrl.coreStyle.checkbox):UI.ctrl.style.checkbox;var e=this,i=new Entity.Geometry;i.style=this._style.childStyle,i.anchor(.5),i.pickable=!1,i.onChange=function(){e._onChildChange(this)},this.attach(i),this.state="off",this._onClick=this.toggle},toggle:function(){var t=this.children[0];t.state=this.group?"on":"on"===t.state?"off":"on"},_onChange:function(){this.children[0].state=this._state,this.group&&"on"===this._state&&this.group._onStateChange(this)},_onChildChange:function(t){this.state=this.children[0]._state},set checked(t){this.state=t?"on":"off"},get checked(){return"on"===this._state},set text(t){this._text?this._text.setText(t):(this._text=new Entity.Text(t),this._text.size=12,this._text.color="#ffffff",this.attach(this._text),this._text.anchor(.5),this._text.pickable=!1)},get text(){return this._text?this._text._text:""},_text:null,group:null,value:""}),"use strict",UI.ProgressBar=Entity.Geometry.extend({init:function(){this.texture=new Resource.Texture,this.volume.resize(300,30),this.buildElement()},buildElement:function(){this.texture.fillRect({width:this.width,height:this.height,color:"white"})},updateElement:function(){},set min(t){this._min!==t&&(this._min=t,this.updateElement())},set max(t){this._max!==t&&(this._max=t,this.updateElement())},set value(t){this._value!==t&&(this._value=t,this.updateElement())},get min(){return this._min},get max(){return this._max},get value(){return this._value},_min:0,_max:100,_value:0}),"use strict",UI.Group=Entity.Geometry.extend({add:function(t){t.group&&t.detach(),this.children||(t.state="on",this._value=t.value),this.attach(t),t.group=this},_onStateChange:function(t){this.prevValue=this._value,this._value=t.value;for(var e,i=this.children.length,n=0;i>n;n++)e=this.children[n],e!==t&&(this.children[n].state="off");this.onChange(this)},set value(t){if(this.children)for(var e=this.children.length,i=0;e>i;i++)if(this.children[i].value===t){this.children[i].state="on";break}},get value(){return this._value},prevValue:"",_value:""}),"use strict",meta.createEngine=function(){meta.onDomLoad(function(){meta.engine.autoInit&&meta.engine.create()})},meta.createEngine(),meta.loadScript=function(t,e){meta.engine&&meta.engine.isLoaded?meta._loadScript({s:t,c:e}):(meta.cache.scripts||(meta.cache.scripts=[]),meta.cache.scripts.push({s:t,c:e}))},meta._loadScript=function(t){var e=document.createElement("script"),i=document.scripts[0];"async"in i?(e.async=!1,e.onload=t.c,e.src=t.s,document.head.appendChild(e)):i.readyState?(meta.cache.pendingScripts||(meta.cache.pendingScripts=[]),meta.cache.pendingScripts.push(e),e.onreadystatechange=meta._onReadyStateChange,e.src=t.s):document.write("<script src='"+src+"' defer></script>")},meta._onReadyStateChange=function(){for(var t,e=meta.cache.pendingScripts;e[0]&&"loaded"===e[0].s.readyState;)t=e.shift(),t.s.onreadystatechange=null,document.scripts[0].parentNode.insertBefore(t.s,firstScript),t.c&&t.c()},meta._loadAllScripts=function(){var t=meta.cache.scripts;if(!t)return!1;var e=t.length;if(0===e)return!1;var i=function(){var t=meta.cache;t.numScriptsToLoad--;var e=meta.cache.scripts,n=e.length;if(n>0){t.numScriptsToLoad+=n,t.scripts=[];for(var s,o=0;n>o;o++)s=e[o],s.c=i,meta._loadScript(s)}0===t.numScriptsToLoad&&(t.scripts=null,meta.engine._continueLoad())},n,s=meta.cache;s.numScriptsToLoad+=t.length,s.scripts=[];for(var o=0;e>o;o++)n=t[o],n.c=i,meta._loadScript(n);return!0},meta.import=function(t){if(t){var e=t.split("/"),i=e[0],n;1===e.length?(n="latest",t+="/latest"):n=e[e.length-1];var s=meta.modules[i];if(s)return s.version!==n&&console.error("[meta.loadPackage]:","There is already added module ["+s.name+"] but with different version: "+s.version),void 0;s={name:i,version:n},meta.modules[i]=s,meta.isUrl(t)||(t=meta.importUrl+t+"/module.js"),meta.loadScript(t,null)}},"use strict",meta.Debugger=function(){this.holder=null,this.txt=null,this.fps=0,this.memory=0,this.numEntities=0,this.created=!1,this.init()},meta.Debugger.prototype={init:function(){meta.subscribe(this,meta.Event.DEBUG,this.onDebug)},create:function(){this.view=meta.getView("debugger"),this.view.static=!0;var t=new Resource.SVG;t.fillStyle="#000",t.fillRect(0,0,200,290),this.holder=new Entity.Geometry(t),this.holder.anchor(0,1),this.holder.position(0,-290),this.holder.alpha=.8,this.holder.debugger=!0,this.view.attach(this.holder);var e=new Entity.Text;e.position(10,10),e.text="fps: 60",this.holder.attach(e);var i=new Entity.Text;i.position(10,25),this.holder.attach(i);var n=new Entity.Text;n.position(10,40),n.text="entities: 0",this.holder.attach(n);var s=new Entity.Text;s.position(10,65),this.holder.attach(s);var o=new Entity.Text;o.text="world:",o.position(10,90),this.holder.attach(o);var r=new Entity.Text;r.position(20,105),this.holder.attach(r);var h=new Entity.Text;h.position(20,120),this.holder.attach(h);var a=new Entity.Text;a.position(20,135),this.holder.attach(a);var c=new Entity.Text;c.text="camera:",c.position(10,155),this.holder.attach(c);var u=new Entity.Text;u.position(20,170),this.holder.attach(u);var l=new Entity.Text;l.position(20,185),this.holder.attach(l);var d=new Entity.Text;d.position(20,200),this.holder.attach(d);var m=new Entity.Text;m.position(20,215),this.holder.attach(m);var f=new Entity.Text;f.text="cursor:",f.position(10,235),this.holder.attach(f);var v=new Entity.Text;v.position(20,250),this.holder.attach(v);var p=new Entity.Text;p.position(20,265),this.holder.attach(p),this.txt={fps:e,memory:i,entities:n,resolution:s,worldBoundsMin:r,worldBoundsMax:h,worldResolution:a,cameraBoundsMin:u,cameraBoundsMax:l,cameraResolution:d,cameraZoom:m,world:v,screen:p},this.created=!0},load:function(){this.view.active=!0;var t=this;this.timer=meta.addTimer(this,function(){t.updateTxt()},1e3),meta.subscribe(this,Input.Event.MOVE,this.onInputMove),meta.subscribe(this,meta.Event.RESIZE,this.onResize),meta.subscribe(this,meta.Event.WORLD_RESIZE,this.onWorldResize),meta.subscribe(this,meta.Event.CAMERA_MOVE,this.onCameraMove),meta.subscribe(this,meta.Event.CAMERA_RESIZE,this.onCameraResize),this.updateTxt(),this.onCameraMove(meta.camera,0),this.onCameraResize(meta.camera,0),this.onResize(meta.engine),this.onWorldResize(meta.world,0),this.onInputMove(Input.ctrl,0)},unload:function(){meta.unsubscribe(this,Input.Event.MOVE),meta.unsubscribe(this,meta.Event.RESIZE),meta.unsubscribe(this,meta.Event.WORLD_RESIZE),meta.unsubscribe(this,meta.Event.CAMERA_MOVE),meta.unsubscribe(this,meta.Event.CAMERA_RESIZE),this.timer.stop(),this.view.active=!1},updateTxt:function(){var t=meta.engine.fps;t!==this.fps&&(this.txt.fps.text="fps: "+t,this.fps=t);var e=(window.performance.memory.usedJSHeapSize/1048576).toFixed(2);e!==this.memory&&(this.txt.memory.text="memory: "+e+"mb",this.memory=e);var i=meta.renderer.numEntities;i!==this.numEntities&&(this.txt.entities.text="entities: "+i,this.numEntities=i)},onDebug:function(t,e){t?(this.created||this.create(),this.load()):this.unload()},onInputMove:function(t,e){this.txt.world.text="world: "+t.x+", "+t.y,this.txt.screen.text="screen: "+t.screenX+", "+t.screenY},onCameraMove:function(t,e){var i=t.volume;this.txt.cameraBoundsMin.text="boundsMin: "+Math.round(i.minX)+", "+Math.round(i.minY),this.txt.cameraBoundsMax.text="boundsMax: "+Math.round(i.maxX)+", "+Math.round(i.maxY),this.txt.cameraResolution.text="width: "+i.width+", height: "+i.height},onCameraResize:function(t,e){this.txt.cameraZoom.text="zoom: "+t.zoom},onResize:function(t,e){this.txt.resolution.text="width: "+t.width+", height: "+t.height},onWorldResize:function(t,e){var i=t.volume;this.txt.worldBoundsMin.text="boundsMin: "+Math.round(i.minX)+", "+Math.round(i.minY),this.txt.worldBoundsMax.text="boundsMax: "+Math.round(i.maxX)+", "+Math.round(i.maxY),this.txt.worldResolution.text="width: "+i.width+", height: "+i.height}},meta.debugger=new meta.Debugger;