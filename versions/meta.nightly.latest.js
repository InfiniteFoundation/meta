"use strict";var meta={version:"1.2.0",importUrl:"http://meta.infinite-games.com/store/",device:null,renderer:null,camera:null,channels:[],modules:{},time:{delta:0,deltaF:0,maxDelta:250,scale:1,update:0,render:0,fps:0,elapsed:0,frameIndex:0,updateFreq:1e3/60},cache:{width:0,height:0,metaTagsAdded:!1,timerIndex:0,initFuncs:[],loadFuncs:[],readyFuncs:[],updateFuncs:[],renderFuncs:[],view:null,views:{},scripts:null,pendingScripts:null,numScriptsToLoad:0,resolutions:null,currResolution:null,imageSmoothing:!0,debug:!1},set init(t){this.cache.initFuncs.push(t),this.engine&&this.engine.inited&&t()},set load(t){this.cache.loadFuncs.push(t),this.engine&&this.engine.loaded&&t()},set ready(t){this.cache.readyFuncs.push(t),this.engine&&this.engine.ready&&t()},set update(t){this.cache.updateFuncs.push(t)},set render(t){this.cache.renderFuncs.push(t)},set debug(t){this.cache.debug!==t&&(this.cache.debug=t,t?meta.emit(meta.Event.DEBUG,t,meta.Event.DEBUG):meta.emit(meta.Event.DEBUG,t,meta.Event.DEBUG),meta.renderer.needRender=!0)},get debug(){return this.cache.debug}};"use strict",meta.engine={create:function(){this._container=document.body,this._container.style.cssText=this.elementStyle,this._createRenderer(),this._printInfo(),this.autoMetaTags&&this._addMetaTags(),this.chn={resize:meta.createChannel(meta.Event.RESIZE),adapt:meta.createChannel(meta.Event.FULLSCREEN),focus:meta.createChannel(meta.Event.FOCUS),fullScreen:meta.createChannel(meta.Event.FULLSCREEN),debug:meta.createChannel(meta.Event.DEBUG)};var t=this;this.cb={resize:function(e){t.onResize()},focus:function(e){t.onFocusChange(!0)},blur:function(e){t.onFocusChange(!1)}},window.addEventListener("resize",this.cb.resize,!1),window.addEventListener("orientationchange",this.cb.resize,!1),meta.device.hidden?(this.cb.visibilityChange=function(){t.onVisibilityChange()},document.addEventListener(meta.device.visibilityChange,this.cb.visibilityChange)):(window.addEventListener("focus",this.cb.focus),window.addEventListener("blur",this.cb.blur)),meta.device.support.fullScreen&&(this.cb.fullscreen=function(){t.cb.fullscreen()},document.addEventListener(meta.device.fullScreenOnChange,this.cb.fullscreen)),meta.subscribe(this,Input.Event.KEY_DOWN,this.onKeyDown),meta.camera=new meta.Camera,this.sortAdaptions(),this.onResize(),meta.world=new meta.World(this.width,this.height),this._initAll()},_initAll:function(){var t=meta.cache,e=new meta.View("master");t.views.master=e,t.view=e;for(var i=t.initFuncs.length,n=0;i>n;n++)t.initFuncs[n]();this._addCorePlugins(),this.inited=!0,console.log(" "),this._loadAll()},_loadAll:function(){meta.device.support.consoleCSS?console.log("%c(Loading started)","background: #eee; font-weight: bold;"):console.log("(Loading started)"),this.loading=!0,meta._loadAllScripts()||this._continueLoad()},_continueLoad:function(){meta.renderer.load();for(var t=meta.cache,e=t.loadFuncs.length,i=0;e>i;i++)t.loadFuncs[i]();var n,s=this.controllers.length;for(i=0;s>i;i++)n=this.controllers[i],n.load(),n.loaded=!0;this.loadedCtrls=!0,this.loading=!1,meta.cache.view.active=!0,0===Resource.ctrl.numToLoad&&this.onReady()},onReady:function(){this.loaded=!0,meta.device.support.consoleCSS?console.log("%c(Loading ended)","background: #eee; font-weight: bold;"):console.log("(Loading ended)");for(var t=this.controllers.length,e=0;t>e;e++)this.controllers[e].ready();this.ready=!0;for(var i=meta.cache.readyFuncs.length,e=0;i>e;e++)meta.cache.readyFuncs[e]();this._startMainLoop()},_startMainLoop:function(){this.time.update=Date.now(),this.time.render=this.time.update;var t=this;this._renderLoop=function(){t.render()},this._updateLoop=function(){t.update()},this.update(),this.render()},update:function(){this.time.frameIndex++;var t=Date.now();this.time.pause?(this.time.delta=0,this.time.deltaF=0):(this.time.delta=t-this.time.update,this.time.delta>this.time.maxDelta&&(this.time.delta=this.time.maxDelta),this.time.delta*=this.time.scale,this.time.deltaF=this.time.delta/1e3);for(var e=this.time.deltaF,i=this.meta.cache.updateFuncs,n=i.length,s=0;n>s;s++)i[s](e);this.meta.renderer.update(e),this._updateTimers(this.time.delta),this.time.update=t;var o=Date.now(),h=Math.max(0,this.time.updateFreq-(o-t));window.setTimeout(this._updateLoop,h)},_updateTimers:function(t){for(var e,i=!1,n=this.timers.length,s=n-1;s>-1;s--)if(e=this.timers[s],!e.paused)for(e.tAccumulator+=t;e.tAccumulator>=e.tDelta;)if(e.tAccumulator-=e.tDelta,0!==e.numTimes&&e.func.call(e.owner,e),e.tStart+=e.tDelta,-1!==e.numTimes&&(e.numTimes--,e.numTimes<=0)){i=!0,n--,n>0&&(this.timers[e.__index]=this.timers[n],this.timers[e.__index].__index=e.__index,s--);break}i&&(this.timers.length=n)},render:function(){var t=Date.now(),e=t-this.time.render,i=e/1e3;t-this.time.fps>=1e3&&(this.time.fps=t,this.fps=this._fpsCounter,this._fpsCounter=0),meta.renderer.render(i);for(var n=this.meta.cache.renderFuncs,s=n.length,o=0;s>o;o++)n[o](i);this._fpsCounter++,this.time.render=t,requestAnimationFrame(this._renderLoop)},sortAdaptions:function(){var t=meta,e=t.cache.resolutions;if(e){var i=e.length;if(!(1>=i)){e.sort(function(e,i){var n=t.math.length2(e.width,e.height),s=t.math.length2(i.width,i.height);return n-s});for(var n=e[0],s,o,h=1;i>h;h++)o=e[h-1],s=e[h],s.unitSize=s.height/n.height,s.zoomThreshold=o.unitSize+(s.unitSize-o.unitSize)/100*33;meta.maxUnitSize=e[i-1].unitSize,meta.maxUnitRatio=1/meta.maxUnitSize,t.camera.bounds(n.width,n.height)}}},adapt:function(){var t=meta,e=t.cache.resolutions;if(!e)return!1;var i=e.length;if(1>i)return!1;for(var n,s=e[0],o=t.camera.zoom,h=i-1;h>=0;h--)if(n=e[h],o>=n.zoomThreshold){s=n;break}return s===t.cache.currResolution?!0:(t.cache.currResolution=s,t.unitSize=s.unitSize,t.unitRatio=1/t.unitSize,this.chn.adapt.emit(s,meta.Event.ADAPT),!0)},onKeyDown:function(t,e){t.keyCode===Input.Key.TILDE&&(meta.debug=!meta.cache.debug,meta.renderer.needRender=!0)},onResize:function(){this._resize(this.meta.cache.width,this.meta.cache.height)},resize:function(t,e){var i=this.meta.cache;i.width=t||0,i.height=e||0,this._resize(i.width,i.height)},_resize:function(t,e){var i=this._container;i===document.body?((0===t||t>window.innerWidth)&&(t=window.innerWidth),(0===e||e>window.innerHeight)&&(e=window.innerHeight)):((0===t||t>i.clientWidth)&&(t=i.clientWidth),(0===e||e>i.clientHeight)&&(e=i.clientHeight)),this.width=0|t,this.height=0|e,this.canvas.width=t,this.canvas.height=e,this.canvas.style.width=t*this.scaleX+"px",this.canvas.style.height=e*this.scaleY+"px",this.ctx.imageSmoothingEnabled=meta.cache.imageSmoothing,this.ctx.webkitImageSmoothingEnabled=meta.cache.imageSmoothing,this.ctx.mozImageSmoothingEnabled=meta.cache.imageSmoothing,this.ctx.msImageSmoothingEnabled=meta.cache.imageSmoothing,this.ctx.oImageSmoothingEnabled=meta.cache.imageSmoothing,this._updateOffset(),this.chn.resize.emit(this,meta.Event.RESIZE),meta.renderer.needRender=!0},scale:function(t,e){this.scaleX=t||1,this.scaleY=e||this.scaleX,this._resize(this.meta.cache.width,this.meta.cache.height)},onFocusChange:function(t){this.focus=t,this.enablePauseOnBlur&&(this.pause=!t),this.chn.focus.emit(t,meta.Event.FOCUS)},onVisibilityChange:function(){this.onFocusChange(document[meta.device.hidden]?!1:!0)},onFullScreenChangeCB:function(){var t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;meta.device.fullscreen=!!t},onCtxLost:function(){console.log("(Context lost)")},onCtxRestored:function(){console.log("(Context restored)")},_addMetaTags:function(){if(!this.metaTagsAdded){var t=document.createElement("meta");t.setAttribute("http-equiv","Content-Type"),t.setAttribute("content","text/html; charset=utf-8"),document.head.appendChild(t);var e=document.createElement("meta");e.setAttribute("http-equiv","encoding"),e.setAttribute("content","utf-8"),document.head.appendChild(e);var i="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height",n=document.createElement("meta");n.setAttribute("name","viewport"),n.setAttribute("content",i),document.head.appendChild(n);var s=document.createElement("meta");s.setAttribute("name","apple-mobile-web-app-capable"),s.setAttribute("content","yes"),document.head.appendChild(s);var o=document.createElement("meta");o.setAttribute("name","apple-mobile-web-app-status-bar-style"),o.setAttribute("content","black-translucent"),document.head.appendChild(o),this.metaTagsAdded=!0}},_createRenderer:function(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","meta-canvas"),this.canvas.style.cssText=this.canvasStyle;var t=this.meta.cache.container;t?t.appendChild(this.canvas):document.body.appendChild(this.canvas),meta.renderer=new meta.CanvasRenderer},_updateOffset:function(){this.offsetLeft=0,this.offsetTop=0;var t=this._container;if(t.offsetParent)do this.offsetLeft+=t.offsetLeft,this.offsetTop+=t.offsetTop;while(t=t.offsetParent);var e=this._container.getBoundingClientRect();this.offsetLeft+=e.left,this.offsetTop+=e.top},_addCorePlugins:function(){meta.register("Resource"),meta.register("Input"),meta.register("Physics")},_printInfo:function(){meta.device.support.consoleCSS?(console.log("%c META v"+meta.version+" ","background: #000; color: white; font-size: 12px; padding: 2px 0 1px 0;","http://infinite-games.com "),console.log("%cBrowser: %c"+meta.device.name+" "+meta.device.version+"	","font-weight: bold; padding: 2px 0 1px 0;","padding: 2px 0 1px 0;"),console.log("%cRenderer: %cCanvas ","font-weight: bold; padding: 2px 0 2px 0;","padding: 2px 0 2px 0;")):(console.log("META v"+meta.version+" http://infinite-games.com "),console.log("Browser: "+meta.device.name+" "+meta.device.version+"	"),console.log("Renderer: Canvas "))},fullscreen:function(t){var e=meta.device;if(e.fullscreen!==t)if(t){if(!e.support.fullScreen)return console.warn("(meta.engine.enterFullScreen): Device does not support fullscreen mode"),void 0;document.documentElement[e.fullScreenRequest](Element.ALLOW_KEYBOARD_INPUT)}else document[meta.device.fullScreenExit]()},toggleFullscreen:function(){this.fullscreen(!meta.device.fullscreen)},set container(t){this._container!==t&&(this._container&&this._container.removeChild(this.canvas),this._container=t?t:document.body,this._container.appendChild(this.canvas),this.onResize())},get container(){return this._container},set imageSmoothing(t){meta.cache.imageSmoothing=t,this.inited&&this.onResize()},get imageSmoothing(){return meta.cache.imageSmoothing},set cursor(t){meta.element.style.cursor=t},get cursor(){return meta.element.style.cursor},elementStyle:"padding:0; margin:0;",canvasStyle:"position:absolute; overflow:hidden; translateZ(0); -webkit-backface-visibility:hidden; -webkit-perspective: 1000; -webkit-touch-callout: none; -webkit-user-select: none; zoom: 1;",meta:meta,time:meta.time,_container:null,width:0,height:0,offsetLeft:0,offsetTop:0,scaleX:1,scaleY:1,canvas:null,ctx:null,chn:null,cb:null,autoInit:!0,autoMetaTags:!0,inited:!1,loading:!1,loaded:!1,loadedCtrls:!1,ready:!1,focus:!1,pause:!1,webgl:!1,_updateLoop:null,_renderLoop:null,controllers:[],controllersToRemove:[],timers:[],fps:0,_fpsCounter:0,enablePauseOnBlur:!0,enableAdaptive:!0,unitSize:1,unitRatio:1,maxUnitSize:1,maxUnitRatio:1},"use strict",meta.Device=function(){this.name="unknown",this.version="0",this.versionBuffer=null,this.vendors=["","webkit","moz","ms","o"],this.support={},this.audioFormats=[],this.mobile=!1,this.isPortrait=!1,this.isAudioAPI=!1,this.hidden=null,this.visibilityChange=null,this.fullScreenRequest=null,this.fullScreenExit=null,this.fullScreenOnChange=null,this.fullscreen=!1,this.load()},meta.Device.prototype={load:function(){this.checkBrowser(),this.mobile=this.isMobileAgent(),this.checkConsoleCSS(),this.support.onloadedmetadata="object"==typeof window.onloadedmetadata,this.support.onkeyup="object"==typeof window.onkeyup,this.support.onkeydown="object"==typeof window.onkeydown,this.support.canvas=this.isCanvasSupport(),this.support.webgl=this.isWebGLSupport(),this.modernize()},checkBrowser:function(){var t={Chrome:[/Chrome\/(\S+)/],Firefox:[/Firefox\/(\S+)/],MSIE:[/MSIE (\S+);/],Opera:[/OPR\/(\S+)/,/Opera\/.*?Version\/(\S+)/,/Opera\/(\S+)/],Safari:[/Version\/(\S+).*?Safari\//]},e=navigator.userAgent,i,n,s,o=2;for(i in t)for(;n=t[i].shift();)if(s=e.match(n)){this.version=s[1].match(new RegExp("[^.]+(?:.[^.]+){0,"+--o+"}"))[0],this.name=i,this.versionBuffer=this.version.split(".");for(var h=this.versionBuffer.length,r=0;h>r;r++)this.versionBuffer[r]=parseInt(this.versionBuffer[r]);break}(null===this.versionBuffer||"unknown"===this.name)&&console.warn("[meta.Device.checkBrowser]:","Could not detect browser.")},checkConsoleCSS:function(){this.support.consoleCSS=this.mobile||"Chrome"!==this.name&&"Opera"!==this.name?!1:!0},modernize:function(){this.supportConsole(),this.supportPageVisibility(),this.supportFullScreen(),this.supportRequestAnimFrame(),this.supportPerformanceNow(),this.supportAudioFormats(),this.supportAudioAPI()},isMobileAgent:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isCanvasSupport:function(){return!!window.CanvasRenderingContext2D},isWebGLSupport:function(){var t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");return!!e},supportConsole:function(){window.console||(window.console={},window.console.log=meta.emptyFuncParam,window.console.warn=meta.emptyFuncParam,window.console.error=meta.emptyFuncParam)},supportPageVisibility:function(){void 0!==document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):void 0!==document.hidden?(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"):void 0!==document.hidden?(this.hidden="mozhidden",this.visibilityChange="mozvisibilitychange"):void 0!==document.hidden&&(this.hidden="mshidden",this.visibilityChange="msvisibilitychange")},supportFullScreen:function(){this._fullScreenRequest(),this._fullScreenExit(),this._fullScreenOnChange(),this.support.fullScreen=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled},_fullScreenRequest:function(){var t=document.documentElement;void 0!==t.requestFullscreen?this.fullScreenRequest="requestFullscreen":void 0!==t.webkitRequestFullscreen?this.fullScreenRequest="webkitRequestFullscreen":void 0!==t.mozRequestFullScreen?this.fullScreenRequest="mozRequestFullScreen":void 0!==t.msRequestFullscreen&&(this.fullScreenRequest="msRequestFullscreen")},_fullScreenExit:function(){void 0!==document.exitFullscreen?this.fullScreenExit="exitFullscreen":void 0!==document.webkitExitFullscreen?this.fullScreenExit="webkitExitFullscreen":void 0!==document.mozCancelFullScreen?this.fullScreenExit="mozCancelFullScreen":void 0!==document.msExitFullscreen&&(this.fullScreenExit="msExitFullscreen")},_fullScreenOnChange:function(){void 0!==document.onfullscreenchange?this.fullScreenOnChange="fullscreenchange":void 0!==document.onwebkitfullscreenchange?this.fullScreenOnChange="webkitfullscreenchange":void 0!==document.onmozfullscreenchange?this.fullScreenOnChange="mozfullscreenchange":void 0!==document.onmsfullscreenchange&&(this.fullScreenOnChange="msfullscreenchange")},supportRequestAnimFrame:function(){window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}())},supportPerformanceNow:function(){void 0===window.performance&&(window.performance={}),void 0===window.performance.now&&(window.performance.now=Date.now)},supportAudioFormats:function(){var t=document.createElement("audio");""!=t.canPlayType('audio/mp4; codecs="mp4a.40.2"').replace(/no/i,"")&&this.audioFormats.push("m4a"),t.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")&&this.audioFormats.push("ogg"),t.canPlayType("audio/mpeg;").replace(/no/,"")&&this.audioFormats.push("mp3"),t.canPlayType('audio/wav; codecs="1"').replace(/no/,"")&&this.audioFormats.push("wav")},supportAudioAPI:function(){window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext)}},meta.device=new meta.Device,"use strict",meta.device.mobile&&(window.onerror=function(t,e,i){alert(e+": "+i+" "+t)}),"use strict",meta.emptyFunc=function(){},meta.emptyFuncParam=function(t){},meta.loadTexture=function(t,e,i){meta._loadResource("Texture",t,e,i)||console.warn("[meta.loadTexture]:","Unsupported parameter was passed.")},meta.preloadTexture=function(t,e,i){meta._preloadResource("Texture",t,e,i)||console.warn("[meta.preloadTexture]:","Unsupported parameter was passed.")},meta.loadSound=function(t,e){meta._loadResource("Sound",t,e)||console.warn("[meta.loadSound]:","Unsupported parameter was passed.")},meta.preloadSound=function(t,e){meta._preloadResource("Sound",t,e)||console.warn("[meta.preloadSound]:","Unsupported parameter was passed.")},meta.loadSpriteSheet=function(t,e){meta._preloadResource("SpriteSheet",t,e)||console.warn("[meta.loadSpriteSheet]:","Unsupported parameter was passed.")},meta.loadFont=function(t,e){meta._preloadResource("Font",t,e)||console.warn("[meta.loadFont]:","Unsupported parameter was passed.")},meta._loadResource=function(t,e,i){if(i){var n=i.lastIndexOf("/");0>=n&&(i+="/")}else i="";if(e instanceof Array)for(var s=e.length,o=0;s>o;o++)meta._addResource(t,e[o],i);else{if("object"!=typeof e&&"string"!=typeof e)return!1;meta._addResource(t,e,i)}return!0},meta._preloadResource=function(t,e,i){if(i){var n=i.lastIndexOf("/");n!==i.length-1&&(i+="/")}else i="";if(e instanceof Array)for(var s=e.length,o=0;s>o;o++)meta._addResource(t,e[o],i);else{if("object"!=typeof e&&"string"!=typeof e)return!1;meta._addResource(t,e,i)}return!0},meta._addResource=function(t,e,i){var n;return"object"==typeof e?(e.path&&(e.path=i+e.path),n=new Resource[t](e)):n=new Resource[t](i+e),Resource.ctrl.add(n),n},meta.getTexture=function(t){return Resource.ctrl.getTexture(t)},meta.getSound=function(t){return Resource.ctrl.getSound(t)},meta.createCtrl=function(t,e){if(!t)return console.error("(meta.createCtrl)No controller name is defined."),null;var i=t.split(".");if(i.length>2)return console.error('(meta.createCtrl) Name should be in format "MyScope.Controller".'),null;var n=i[0],s=window[n];if(!s)return console.error("(meta.createCtrl) No such scope defined: "+n),null;if(s.ctrl)return console.error("(meta.register) Controller ("+h.name+") is already added in scope."),null;var o;if(o=1===i.length?"Controller":i[1],!s[o])return console.error("(meta.createCtrl) No Controller ("+o+") found in scope: "+n),null;e=e||meta.view;var h=new s[o](e);return s.ctrl=h,h.name=n,h.view=e,h},meta.addCtrl=function(t){if(!t)return console.error("[meta.addCtrl]:","Invalid controller passed."),void 0;var e=window[t.name];e.ctrl=t,meta.engine.controllers.push(t),meta.engine.isCtrlLoaded&&t.load(),meta.engine.isReady&&t.ready()},meta.removeCtrl=function(t){if(!t)return console.error("[meta.addCtrl]:","Invalid controller passed."),void 0;var e=window[t.name];return e.ctrl?e.ctrl!==t?(console.error("[meta.removeCtrl]:","Controller ("+t.name+") is not the same what is already added to the scope."),void 0):(t.unload(),t.release(),meta.engine.controllersToRemove.push(t),void 0):(console.error("[meta.removeCtrl]:","No controller added to the scope."),void 0)},meta.register=function(t,e){var i=meta.createCtrl(t,e);if(i)return meta.engine.controllers.push(i),meta.engine.isCtrlLoaded&&i.load(),meta.engine.isReady&&i.ready(),i},meta.unregister=function(t){if(!t)return console.error("[meta.unregister]:","No controller name is defined."),void 0;var e=t.split(".");if(e.length>2)return console.error("[meta.unregister]:",'Name should be in format "MyScope.Controller".'),void 0;var i=e[0],n=window[i];if(!n)return console.error("[meta.unregister]:","No such scope defined: "+i),void 0;if(n[i])return console.error("[meta.unregister]:","Controller ("+i+") is already added in scope."),void 0;var s;if(s=1===e.length?"Controller":e[1],!n[s])return console.error("[meta.unregister]:","No Controller ("+s+") found in scope: "+i),void 0;var o=n.ctrl;return o?(o.unload(),o.release(),meta.engine.controllersToRemove.push(o),void 0):(console.error("[meta.unregister]:","No Controller ("+s+") found in scope: "+i),void 0)},meta.unregisterAll=function(){for(var t,e=meta.engine.controllers,i=e.length,n=0;i>n;n++)t=window[e[n].name].ctrl,t.unload(),t.release(),window[e[n].name].ctrl=null;e.length=0},meta.onDomLoad=function(t){if("interactive"===document.readyState||"complete"===document.readyState)return t(),void 0;var e=function(i){t(),window.removeEventListener("DOMContentLoaded",e)};window.addEventListener("DOMContentLoaded",e)},meta.enumToString=function(t,e){if(void 0===t)return"unknown";for(var i in t)if(t[i]===e)return i;return"unknown"},meta.hexToRgb=function(t){t.length<6&&(t+=t.substr(1,4));var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}},meta.isUrl=function(t){return-1!==t.indexOf("http://")||-1!==t.indexOf("https://")?!0:!1},meta.toUpperFirstChar=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},meta.serialize=function(t){var e=[];for(var i in t)e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")},meta.addDescription=function(t){var e=new Entity.Text(t);e.color="#ffffff",e.anchor(.5);var i=new Resource.Texture;i.fillRect({width:e.width+10,height:e.height+10,color:"#000000"});var n=new Entity.Geometry(i);n.z=9999,n.anchor(.5,0),n.positionTop(0,10),n.isPickable=!1,n.ignoreZoom=!0,n.disableDebug=!0,meta.view.attach(n),n.attach(e)},meta.adaptTo=function(t,e,i){if(meta.engine&&meta.engine.isInited)return console.warn("[meta.adaptTo]:","Only usable before engine is initialized."),void 0;var n=meta.cache.resolutions;n||(n=[],meta.cache.resolutions=n);var s=i.charAt(i.length-1);"/"!==s&&(i+="/");var o={width:t,height:e,path:i,unitSize:1,zoomThreshold:1};n.push(o)},meta.removeFromArray=function(t,e){for(var i=e.length,n=0;i>n;n++)if(t===e[n]){e[n]=e[i-1],e.pop();break}},meta.shuffleArray=function(t){for(var e=t.length,i,n;e;)n=Math.floor(Math.random()*e--),i=t[e],t[e]=t[n],t[n]=i;return t},meta.rotateArray=function(t){for(var e=t[0],i=t.length-1,n=0;i>n;n++)t[n]=t[n+1];t[i]=e},meta.nextPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},"use strict",meta.Channel=function(t){this.name=t,this.subs=[],this.numSubs=0,this._isEmiting=!1,this._subsToRemove=null},meta.Channel.prototype={remove:function(){meta.channels[this.name]=null},emit:function(t,e){this._isEmiting=!0;for(var i,n=0;n<this.numSubs;n++)i=this.subs[n],i.func.call(i.owner,t,e);if(this._isEmiting=!1,this._subsToRemove){for(var s=this._subsToRemove.length,o=0;s>o;o++)this.unsubscribe(this._subsToRemove[o]);this._subsToRemove=null}},subscribe:function(t,e,i){if(i=i||0,!e)return console.warn("(meta.Channel.subscribe) No callback function passed."),void 0;for(var n=0;n<this.numSubs;n++)if(this.subs[n].owner===t)return console.warn("(meta.Channel.subscribe) Already subscribed to channel: "+this.name),void 0;var s=new meta.Subscriber(t,e,i);this.subs.push(s),this.numSubs++,i?(this._havePriority=!0,this.subs.sort(this._sortFunc)):this._havePriority&&this.subs.sort(this._sortFunc)},unsubscribe:function(t){if(this._isEmiting)return this._subsToRemove||(this._subsToRemove=[]),this._subsToRemove.push(t),void 0;for(var e,i=0;i<this.numSubs;i++)if(e=this.subs[i],e.owner===t){this.subs[i]=this.subs[this.numSubs-1],this.subs.pop(),this.numSubs--;break}this._havePriority&&this.subs.sort(this._sortFunc)},_sortFunc:function(t,e){return t.priority>e.priority?-1:1},_havePriority:!1},meta.Subscriber=function(t,e,i){this.owner=t,this.func=e,this.priority=i},meta.createChannel=function(t){if(!t)return console.warn("(meta.createChannel) No name was specified!"),null;var e=meta.channels[t];return e||(e=new meta.Channel(t),meta.channels[t]=e),e},meta.releaseChannel=function(t){return t?(meta.channels[t]&&(meta.channels[t]=null),void 0):(console.warn("(meta.releaseChannel) No name was specified!"),void 0)},meta.subscribe=function(t,e,i,n){if("object"!=typeof t)return console.warn("(meta.subscribe) No owner passed."),void 0;if(!i)return console.warn("(meta.subscribe) No callback function passed."),void 0;if("string"!=typeof e){if("[object Array]"===Object.prototype.toString.call(e)){for(var s=e.length,o=0;s>o;o++)meta.subscribe(t,e[o],i,n);return}return console.warn("(meta.subscribe) Wrong type for channel object: "+typeof e),void 0}var h=meta.channels[e];if(h)e=h;else if(e=meta.createChannel(e),!e)return;e.subscribe(t,i,n)},meta.unsubscribe=function(t,e){if("string"!=typeof e){if("[object Array]"===Object.prototype.toString.call(e)){for(var i=e.length,n=0;i>n;n++)meta.unsubscribe(t,e[n]);return}return console.warn("(meta.unsubscribe) Wrong type for channel object."),void 0}return e=meta.channels[e],e?(e.unsubscribe(t),void 0):(console.warn("(meta.unsubscribe) No name was specified!"),void 0)},meta.emit=function(t,e,i){return"string"!=typeof t||(t=meta.channels[t],t)?(t.emit(e,i),void 0):(console.warn("(meta.emit) No name was specified!"),void 0)},"use strict",meta.View=function(t){this.name=t,this.entities=[],this.views=null,this.parentView=null,this.numEntities=0,this._x=0,this._y=0,this._z=0,this._tween=null,this._active=!1},meta.View.prototype={remove:function(){if("master"===this.name)return console.warn("(meta.View.remove) Master view can't be removed"),void 0;if(this.parentView&&this.parentView.detachView(this),this.views)for(var t=this.views.length,e=0;t>e;e++)this.views[e].remove();this.active=!1,this._unregisterFromEngine();for(var i,n=this.entities.length,s=0;n>s;s++)i=this.entities[s],i._view=null,i.remove();this.entities.length=0,this.numEntities=0},attach:function(t){return t.isRemoved?(console.warn("(meta.View.add) Removed entity can not be added to the view."),void 0):t._view?(console.warn(t._view===this?"(meta.View.attach) Entity is already added to this view.":"(meta.View.attach) Entity is already added to some other view."),void 0):((0!==this._x||0!==this._y)&&t.updatePos(),this.entities.push(t),this.numEntities++,this._attachChildren(t.children),t._view=this,t._viewNodeID=this.numEntities,this._z&&(t.z=t._z),t.texture||(t.isLoaded=!0),this._active&&meta.engine.ready&&meta.renderer.addEntity(t),void 0)},_attachChildren:function(t){if(t)for(var e,i=t.length,n=0;i>n;n++)e=t[n],e.isRemoved||(e._view=this,this._attachChildren(e.children))},detach:function(t){if(!t.isRemoved){if(!t._view)return console.warn("(meta.View.detach) Entity does not have view."),void 0;if(t._view!==this)return console.warn("(meta.View.detach) Entity is part of other view: "+t.view.name),void 0;if(t._parent!==t._entityCtrl)return console.warn("(meta.View.detach) Entity children are not part of view."),void 0;t.isRemoved=!0,t.removeCore(),this.numEntities--;var e=this.entities[this.numEntities];e.core.viewIndex=this.numEntities,this.entities[this.numEntities]=e,this.entities.pop(),this._active&&Renderer.ctrl.removeEntities(t)}},attachView:function(t){if(!t)return this.parentView?(console.warn("(meta.View.attach) No view was passed."),void 0):(meta.cache.view.attachView(this),void 0);if("string"==typeof t){var e=meta.cache.views[t];if(!e)return console.warn("(meta.View.attach) No such view found: "+t),void 0;t=e}else if(!(t instanceof meta.View))return console.warn("(meta.View.attach) Trying to attach invalid view object."),void 0;return t._active?(console.warn("(meta.View.attach) Can't attach an active view."),void 0):t.parentView?(console.warn("(meta.View.attach) View is already part of other view."),void 0):(this.views||(this.views=[]),this.views.push(t),t.parentView=this,this._active&&(t.active=!0),void 0)},detachView:function(t){if(!t)return this.parentView?(this.parentView.detachView(this),void 0):(console.warn("(meta.View.detachView) No view was passed."),void 0);if("string"==typeof t){var e=meta.cache.views[t];if(!e)return console.warn('(meta.View.detachView) No such view found: "'+t+'"'),void 0;t=e}if(!t.parentView)return console.warn("(meta.View.detachView) View has not parents to detach from"),void 0;if(t.parentView!==this)return console.warn("(meta.View.detachView) Detaching from wrong parent"),void 0;for(var i=this.views.length,n=0;i>n;n++)if(this.views[n]===t){this.views[n]=this.views[i-1],this.views.pop();break}t.active=!1,t.parentView=null},detachViews:function(){if(this.views){for(var t,e=this.views.length,i=this.views.length,n=0;i>n;n++)t=this.views[n],t.active=!1,t.parentView=null;this.views.length=0}},register:function(t){var e=meta.createCtrl(t,this);this.controllers?this.controllers.push(e):this.controllers=[e],this._active&&(!this.parentView||this.parentView._active)&&meta.addCtrl(e)},unregister:function(t){for(var e=this.controllers.length,i=0;e>i;i++)this.controllers[i].name===t&&(this._active&&meta.unregister(t),this.controllers[i]=this.controllers[e-1],this.controllers.pop())},_unregisterFromEngine:function(){if(this.controllers)for(var t=this.controllers.length,e=0;t>e;e++)meta.unregister(this.controllers[e])},_makeActive:function(){var t;if(this.controllers){var e=this.controllers.length;for(t=0;e>t;t++)meta.addCtrl(this.controllers[t])}if(meta.renderer.addEntities(this.entities),this.views){var i=this.views.length;for(t=0;i>t;t++)this.views[t].active=!0}},_makeInactive:function(){var t;if(this.controllers){var e=this.controllers.length;for(t=0;e>t;t++)meta.removeCtrl(this.controllers[t])}if(Renderer.ctrl.removeEntities(this.entities),this.views){var i=this.views.length;for(t=0;i>t;t++)this.views[t].active=!1}},set active(t){this._active!==t&&(t?this._makeActive():this._makeInactive(),this._active=t)},get active(){return this._active},set x(t){if(this._x!==t){this._x=t;for(var e,i=this.entities.length,n=0;i>n;n++)e=this.entities[n],e.forcePosition(e._x,e._y)}},set y(t){if(this._y!==t){this._y=t;for(var e,i=this.entities.length,n=0;i>n;n++)e=this.entities[n],e.forcePosition(e._x,e._y)}},set z(t){this._z=t;for(var e=this.entities.length,i=0;e>i;i++)this.entities[i].z=this.entities[i]._z},get x(){return this._x},get y(){return this._y},get z(){return this._z},get tween(){return this._tween||(this._tween=new meta.Tween(this)),this._tween},controllers:null},meta.createView=function(t,e){if(!t||"string"!=typeof t)return console.error("(meta.createView) Invalid name of the view"),void 0;var i=meta.cache.views[t];if(i)return console.error("(meta.createView) View with a name - "+t+", already exist"),void 0;if(i=new meta.View(t),meta.cache.views[t]=i,e)if(e instanceof Array)for(var n=e.length,s=0;n>s;s++)i.register(e[s]);else i.register(e)},meta.setView=function(t){if(!t)return console.error("(meta.setView) No view passed"),void 0;var e=meta.cache;if("string"==typeof t){var i=t;t=e.views[i],t||(console.warn("(meta.setView) Creating empty view, could be unintended - "+i),t=new meta.View(i),e.views[i]=t)}t.active||(e.view.detachViews(),e.view.attachView(t))},meta.getView=function(t){if(!t)return console.error("(meta.getView) No name specified"),null;var e=meta.cache.views[t];return e||(e=new meta.View(t),meta.cache.views[t]=e),e},meta.attachView=function(t){if(!meta.cache.view)return console.warn("(meta.attachView) No current active view"),void 0;if("string"==typeof t){var e=meta.cache.views[t];if(!e)return console.warn("(meta.attachView) No such view found: "+t),void 0;t=e}meta.cache.view.attachView(t)},meta.detachView=function(t){if(!meta.cache.view)return console.warn("(meta.detachView) No current active view."),void 0;if("string"==typeof t){var e=meta.cache.views[t];if(!t)return console.warn("(meta.detachView) No such view found: "+t),void 0;t=e}meta.cache.view.detachView(t)},Object.defineProperty(meta,"view",{set:function(t){meta.setView(t)},get:function(){return meta.cache.view
}}),"use strict",meta.Camera=function(){this._x=0,this._y=0,this.volume=new meta.math.AdvAABB(0,0,0,0),this.zoomBounds=null,this._zoom=1,this.prevZoom=1,this.zoomRatio=1,this._draggable=!1,this._isDraggable=!1,this._isAutoZoom=!1,this._enableBorderIgnore=!0,this._enableCentering=!1,this._enableCenteringX=!0,this._enableCenteringY=!0,this._chnMove=null,this._chnResize=null,this._wasMoved=!1,this.init()},meta.Camera.prototype={init:function(){this._chnMove=meta.createChannel(meta.Event.CAMERA_MOVE),this._chnResize=meta.createChannel(meta.Event.CAMERA_RESIZE),meta.subscribe(this,meta.Event.RESIZE,this._onResize),meta.subscribe(this,meta.Event.WORLD_RESIZE,this._onWorldResize),this.zoomBounds={width:-1,height:-1,minWidth:-1,minHeight:-1,maxWidth:-1,maxHeight:-1}},release:function(){this._chnMove.release(),meta.unsubscribe(this,meta.Event.RESIZE),meta.unsubscribe(this,meta.Event.WORLD_RESIZE)},updateView:function(){if(this._isAutoZoom?this.updateAutoZoom():this.updateZoom(),!this._wasMoved){if(this._enableCentering){var t=meta.world;this._x=this._enableCenteringX?Math.floor((this.volume.width-t.width)/2):0,this._y=this._enableCenteringY?Math.floor((this.volume.height-t.height)/2):0}else this._x=0,this._y=0;this.volume.move(this._x,this._y)}this._chnMove.emit(this,meta.Event.CAMERA_MOVE)},updateZoom:function(){this.prevZoom!==this._zoom&&(this.zoomRatio=1/this._zoom,this.volume.scale(this.zoomRatio,this.zoomRatio),this._chnResize.emit(this,meta.Event.CAMERA_RESIZE))},updateAutoZoom:function(){var t=meta,e=this.zoomBounds.width,i=this.zoomBounds.height,n=t.width/e,s=t.height/i;this.prevZoom=this._zoom,this._zoom=n,n>s&&(this._zoom=s),t.engine.adapt()&&(e=this.zoomBounds.width,i=this.zoomBounds.height,n=t.width/e,s=t.height/i,this._zoom=n,n>s&&(this._zoom=s),this.volume.resize(t.width,t.height)),this.updateZoom()},bounds:function(t,e){this._isAutoZoom=!0,this.zoomBounds.width=t,this.zoomBounds.height=e,(0!==this.width||0!==this.height)&&this.updateView()},minBounds:function(t,e){this._isAutoZoom=!0,this.zoomBounds.minWidth=t,this.zoomBounds.minHeight=e,this.updateView()},maxBounds:function(t,e){this._isAutoZoom=!0,this.zoomBounds.maxWidth=t,this.zoomBounds.maxHeight=e,this.updateView()},_onInput:function(t,e){var i=Input.Event;if(e===i.MOVE)this._drag(t);else if(e===i.DOWN){if(0!==t.keyCode)return;this._startDrag(t)}else if(e===i.UP){if(0!==t.keyCode)return;this._endDrag(t)}},_onResize:function(t,e){this.volume.resize(t.width,t.height),this.updateView(),this._chnResize.emit(this,meta.Event.CAMERA_RESIZE)},_onWorldResize:function(t,e){},_startDrag:function(t){this._draggable&&(this._isDraggable=!0)},_endDrag:function(t){this._isDraggable=!1},_drag:function(t){if(this._isDraggable){var e=meta,i=t.screenX-t.prevScreenX,n=t.screenY-t.prevScreenY;this._x+=i,this._y+=n,this.volume.move(-i,-n),this._wasMoved=!0,this.enableBorderIgnore||(-this._x<0&&(this._x=0),-this._y<0&&(this._y=0)),this._chnMove.emit(this,e.Event.CAMERA_MOVE),meta.renderer.needRender=!0}},set x(t){this._x!==t&&(this._x=t,this._wasMoved=!0,this.updateView())},set y(t){this._y!==t&&(this._y=t,this._wasMoved=!0,this.updateView())},get x(){return this._x},get y(){return this._y},get width(){return this.volume.width},get height(){return this.volume.height},set zoom(t){this._zoom!==t&&(this.prevZoom=this._zoom,this._zoom=t,this.updateView())},get zoom(){return this._zoom},set enableBorderIgnore(t){this._enableBorderIgnore=t,this.updateView()},get enableBorderIgnore(){return this._enableBorderIgnore},set draggable(t){if(this._draggable!==t){this._draggable=t;var e=[Input.Event.DOWN,Input.Event.UP,Input.Event.MOVE];t?meta.subscribe(this,e,this._onInput):(meta.unsubscribe(this,e),this._isDraggable=!1)}},get draggable(){return this._draggable},set isAutoZoom(t){this._isAutoZoom!==t&&(this._isAutoZoom=t,this.updateView())},get isAutoZoom(){return this._isAutoZoom},set enableCentering(t){this._enableCentering=t,this.updateView()},set enableCenteringX(t){this._enableCenteringX=t,this.updateView()},set enableCenteringY(t){this._enableCenteringY=t,this.updateView()},get enableCentering(){return this._enableCentering},get enableCenteringX(){return this._enableCenteringX},get enableCenteringY(){return this._enableCenteringY}},"use strict",meta.World=function(t,e){this.chn=null,this.volume=new meta.math.AdvAABB(0,0,0,0),this.minWidth=-1,this.minHeight=-1,this.maxHeight=-1,this.maxHeight=-1,this.centerX=0,this.centerY=0,this.gridX=0,this.gridY=0,this.gridWidth=0,this.gridHeight=0,this.numGridX=0,this.numGridY=0,this.haveGrid=!1,this._discardUnusedSpace=!1,this.lockGrid=!1,this.showBounds=!1,this.init(t,e)},meta.World.prototype={init:function(t,e){this.bounds(t,e),this.chn=meta.createChannel(meta.Event.WORLD_RESIZE),meta.subscribe(this,meta.Event.CAMERA_RESIZE,this.onCameraResize)},updateVolume:function(){var t=meta,e=t.camera.width+.5|0,i=t.camera.height+.5|0;this.centerX=e/2,this.centerY=i/2,this.volume.resize(e,i),this.chn&&this.chn.emit(t.Event.WORLD_RESIZE,this)},bounds:function(t,e){this.volume.resize(t,e),this.updateVolume()},minBounds:function(t,e){this.minWidth=t,this.minHeight=e,this.updateVolume()},maxBounds:function(t,e){this.maxWidth=t,this.maxHeight=e,this.updateVolume()},setGrid:function(t){t.x=t.x||0,t.y=t.y||0,t.width=t.width||16,t.height=t.height||16,t.sizeX=t.sizeX||1,t.sizeY=t.sizeY||1,this.setGridPosition(t.x,t.y),this.setGridResolution(t.width,t.height),this.setGridSize(t.sizeX,t.sizeY)},setGridResolution:function(t,e){this.gridWidth=t,this.gridHeight=e,this.haveGrid=t||e,this.lockGrid||(this.numGridX=Math.floor(this.width/t),this.numGridY=Math.floor(this.height/e)),this.haveGrid&&this._discardUnusedSpace&&this.setBounds(this.numGridX*this.gridWidth,this.numGridY*this.gridHeight)},setGridSize:function(t,e){if(this.numGridX=t,this.numGridY=e,this.lockGrid=t||e,this.haveGrid){var i=this.numGridX*this.gridWidth,n=this.numGridY*this.gridHeight;this.width>i&&(i=this.width),this.height>n&&(n=this.height),this.setBounds(i,n),this.lockGrid||(this.numGridX=Math.floor(this.width/this.gridWidth),this.numGridY=Math.floor(this.height/this.gridHeight))}},setGridPosition:function(t,e){this.gridX=t,this.gridY=e},getGridPosX:function(t){return this.gridX+this.gridWidth*t},getGridPosY:function(t){return this.gridY+this.gridHeight*t},getGridFromWorldX:function(t){var e=Math.floor((t-this.gridX)/this.gridWidth);return-1>e?e=-1:e>=this.numGridX&&(e=-1),e},getGridFromWorldY:function(t){var e=Math.floor((t-this.gridY)/this.gridHeight);return-1>e?e=-1:e>=this.numGridY&&(e=-1),e},get randX(){return meta.random.number(0,this.volume.width)},get randY(){return meta.random.number(0,this.volume.height)},onCameraResize:function(t,e){this.updateVolume()},set discardUnusedSpace(t){this._discardUnusedSpace=t,t&&this.haveGrid&&this.setBounds(this.gridX+this.numGridX*this.gridWidth,this.gridY+this.numGridY*this.gridHeight)},get discardUnusedSpace(){return this._discardUnusedSpace},get left(){return this.volume.minX},get right(){return this.volume.maxX},get top(){return this.volume.minY},get bottom(){return this.volume.maxY},get width(){return this.volume.width},get height(){return this.volume.height}},"use strict",function(t){var e=!1,i=/\b_super\b/;t.meta.Class=function(){},t.meta.Class.extend=function(t){function n(t,i,n,s,o,h){e||(this._init&&this._init(t,i,n,s,o,h),this.init&&this.init(t,i,n,s,o,h))}var s=this.prototype;e=!0;var o=new this;e=!1;for(var h in t){var r=Object.getOwnPropertyDescriptor(t,h);r.get||r.set?Object.defineProperty(o,h,r):o[h]="function"==typeof t[h]&&"function"==typeof s[h]&&i.test(t[h])?function(t,e){return function(i,n,o,h,r,a){var c=this._super;this._super=s[t],this._fn=e;var u=this._fn(i,n,o,h,r,a);return this._super=c,u}}(h,t[h]):t[h]}return n.prototype=o,n.prototype.constructor=o.init,n.extend=this.extend,n},t.meta.Class=t.meta.Class}(void 0!==typeof window?window:global),"use strict",meta.Controller=meta.Class.extend({init:meta.emptyFunc,_init:function(t){this.view=t},release:meta.emptyFunc,load:meta.emptyFunc,unload:meta.emptyFunc,ready:meta.emptyFunc,update:meta.emptyFuncParam,view:null,name:"unknown",isLoaded:!1}),"use strict",meta.Timer=function(t,e,i,n){this.owner=t,this.id=meta.cache.timerIndex++,this.func=e,this.onRemove=null,this.tDelta=i,this.numTimes=n,void 0===this.numTimes&&(this.numTimes=-1),this.tAccumulator=0,this.tStart=Date.now()},meta.Timer.prototype={remove:function(){this.owner=null,this.func=null,this.numTimes=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.tStart=Date.now()},onRemove:null,paused:!1},meta.addTimer=function(t,e,i,n){"function"==typeof t&&(n=i,i=e,e=t,t=window);var s=new meta.Timer(t,e,i,n);return s.__index=meta.engine.timers.length,meta.engine.timers.push(s),s},"use strict",meta.Style=function(t){this.states={},this.setStates(t),this.defaultState||this.setState("*",null)},meta.Style.prototype={setState:function(t,e){if(-1!==t.indexOf(","))for(var i=t.split(/[ ,]+/),n=i.length,s=0;n>s;s++)this.defineState(i[s],e);else this.defineState(t,e)},defineState:function(t,e){var i,n,s,o,h;if("string"==typeof e&&(e={texture:e}),"["===t.charAt(0))return t=t.substr(1,t.length-2),this.childStyle||(this.childStyle=new meta.Style),this.childStyle.setState(t,e),void 0;var r=t.indexOf(":");if(-1!==r){var a=t.substr(r+1,t.length-r-1);t=t.substr(0,r),t||(t="*"),i=this.states[t],i?i.actions||(i.actions={}):(i=new meta.StyleState(t),i.actions={},this.states[t]=i);var c;if("*"===t){this.defaultState=i;for(s in this.states)if(h=this.states[s],h.actions&&(c=h.actions[a],c)){n=c.params;for(o in e)n[o]||(n[o]=e[o])}}else if(this.defaultState&&this.defaultState.actions&&(c=this.defaultState.actions[a],c)){n=c.params;for(o in n)e[o]||(e[o]=n[o])}i.actions[a]=new meta.StyleState(a,e),this.haveActions=!0}else if(t||(t="*"),i=this.states[t],i){n=i.params;for(o in n)n[o]||(n[o]=e[o]);i._updateTexture()}else{if(this.defaultState){n=this.defaultState.params;for(o in n)e[o]||(e[o]=n[o])}if(i=new meta.StyleState(t,e),"*"===t){this.defaultState=i;for(s in this.states){n=this.states[s].params;for(o in e)n[o]||(n[o]=e[o])}}this.states[t]=i}return this},setStates:function(t){for(var e in t)this.setState(e,t[e])},setHiddenState:function(t,e,i){var n=this.setState(t,e,i);return n&&(n.isHidden=!0),n},removeState:function(t){return this.states[t]?(delete this.states[t],void 0):(console.warn("[meta.Brush.removeState]:","No such state: "+t),void 0)},update:function(t){if(t.isNeedStyle=!1,this.states){var e=this.states[t._state];if(!e){if(!this.defaultState)return console.warn("[meta.Style.update]:","Could not get state from the style: "+t._state),void 0;e=this.defaultState}if(e!==t._styleState){var i,n=t._styleParams;for(i in n)t[i]=n[i];n={},t._styleParams=n;var s=e.params;for(i in s)n[i]=t[i],t[i]=s[i];t._styleState=e,t._inputFlags&&this.updateAction(t)}}},updateAction:function(t){var e=t._styleActionParams;for(var i in e)t[i]=e[i];e={},t._styleActionParams=e;var n,s=this.states[t._state];if(!s){if(!this.defaultState)return;s=this.defaultState}if(s.actions)n=s.actions[t._action];else{if(!this.defaultState.actions)return;n=this.defaultState.actions[t._action]}if(n){var o=n.params;for(var i in o)e[i]=t[i],t[i]=o[i]}},getRandomState:function(){if(!this.states)return null;var t=null,e=0;for(var i in this.states)this.states[i].isHidden||Math.random()<1/++e&&(t=i);return t},states:null,defaultState:null,haveActions:!1,childStyle:null},meta.StyleState=function(t,e){this.name=t,this.params=e,this.isHidden=!1,this._updateTexture()},meta.StyleState.prototype={_updateTexture:function(){if(this.params&&void 0!==this.params.texture){var t=this.params.texture;if("string"!=typeof t)return;var e=meta.getTexture(t);if(!e)return console.warn("[meta.StyleState]:","Could not get texture from texture name: "+t),void 0;this.params.texture=e}}},meta.createStyle=function(t,e){if(!t)return e?e:null;e=e||null;var i=Object.create(e);if("string"==typeof t||t instanceof Resource.Texture)i["*"]?i["*"].texture=t:i["*"]={texture:t};else if("object"==typeof t){var n,s,o,s,h,r,a,c,u,l,d;for(s in t)if(n=t[s],"string"==typeof n&&(n={texture:n}),-1!==s.indexOf(","))for(l=s.split(/[ ,]+/),d=l.length,h=0;d>h;h++){if(u=l[h],a=i[u],a){c={};for(r in a)c[r]=a[r];a=c}else a={};for(r in n)a[r]=n[r];i[u]=a}else{if(a=i[s],a){c={};for(r in a)c[r]=a[r];a=c}else a={};for(r in n)a[r]=n[r];i[s]=a}}return i},"use strict",meta.Event={RESIZE:"resize",WORLD_RESIZE:"world-resize",CAMERA_MOVE:"camera-move",CAMERA_RESIZE:"camera-resize",FOCUS:"focus",FULLSCREEN:"fullscreen",ADAPT:"adapt",DEBUG:"debug"},meta.Priority={LOW:0,MEDIUM:5e3,HIGH:1e4},meta.Cursor={ALIAS:"alias",ALL_SCROLL:"all-scroll",CELL:"cell",CONTEXT_MENU:"context-menu",COL_RESIZE:"col-resize",COPY:"copy",CROSSHAIR:"crosshair",DEFAULT:"default",E_RESIZE:"e-resize",EW_RESIZE:"ew-resize",GRAB:"grab",GRABBING:"grabbing",HELP:"help",MOVE:"move",N_RESIZE:"n-resize",NE_RESIZE:"ne-resize",NESW_RESIZE:"nesw-resize",NS_RESIZE:"ns-reisize",NW_RESIZE:"nw-resize",NWSE_RESIZE:"nwse-resize",NO_DROP:"no-drop",NONE:"none",NOT_ALLOWED:"not-allowed",POINTER:"pointer",PROGRESS:"progress",ROW_RESIZE:"row-resize",S_RESIZE:"s-resize",SE_RESIZE:"se-resize",SW_RESIZE:"sw-resize",TEXT:"text",VERTICAL_TEXT:"vertical-text",W_RESIZE:"w-resize",WAIT:"wait",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",INITIAL:"initial"},"use strict",meta.getTexture=function(t){return Resource.ctrl.getTexture(t)},"use strict",meta.ajax=function(params){params.responseType="html"===params.dataType?"document":"script"===params.dataType||"json"===params.dataType?"text":void 0===params.dataType?"GET":params.dataType,void 0===params.type&&(params.type="GET");var data=meta.serialize(params.data),xhr=new XMLHttpRequest;return xhr.open(params.type,params.url,!0),xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhr.onload=function(){4===xhr.readyState&&200===xhr.status?void 0!==params.success&&params.success("document"===params.responseType?xhr.responseXML:"script"===params.dataType?eval(xhr.responseText):"json"===params.dataType?JSON.parse(xhr.responseText):xhr.responseText):void 0!==params.error&&params.error()},xhr.send(data),xhr},"use strict",meta.math={},meta.math={degToRad:function(t){return t*Math.PI/180},radToDeg:function(t){return 180*t/Math.PI},radiansToPoint:function(t,e,i,n){var s=i-t,o=n-e;return Math.atan(s/o)},clamp:function(t,e,i){return e>t?e:t>i?i:t},map:function(t,e,i,n,s){return t==e?n:(t-e)*(s-n)/(i-e)+n},length:function(t,e,i,n){var s=i-t,o=n-e;return Math.sqrt(s*s+o*o)},length2:function(t,e){return Math.sqrt(t*t+e*e)},limit:function(t,e){return t>e?e:-e>t?-e:t},lerp:function(t,e,i){return t+(e-t)*i},lookAt:function(t,e,i,n){return Math.atan2(i-t,e-n)},lookAtEntity:function(t,e){return meta.math.lookAt(t.x,t.y,e.x,e.y)}},"use strict",meta.math.Vector2=function(t,e){this.x=t,this.y=e},meta.math.Vector2.prototype={reset:function(){this.x=0,this.y=0},set:function(t,e){this.x=t,this.y=e},add:function(t){this.x+=t,this.y+=t},sub:function(t){this.x-=t,this.y-=t},mul:function(t){this.x*=t,this.y*=t},div:function(t){this.x/=t,this.y/=t},addVec2:function(t){this.x+=t.x,this.y+=t.y},subVec2:function(t){this.x-=t.x,this.y-=t.y},mulVec2:function(t){this.x*=t.x,this.y*=t.y},divVec2:function(t){this.x/=t.x,this.y/=t.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);t>0?(this.x/=t,this.y/=t):(this.x=0,this.y=0)},dot:function(t){return this.x*t.x+this.y*t.y},truncate:function(t){var e=Math.sqrt(this.x*this.x+this.y*this.y);e>t&&(this.x*=t/e,this.y*=t/e)},limit:function(t){this.x>t?this.x=t:this.x<-t&&(this.x=-t),this.y>t?this.y=t:this.y<-t&&(this.y=-t)},lengthSq:function(){return this.x*this.x+this.y*this.y},heading:function(){var t=Math.atan2(-this.y,this.x);return-t+.5*Math.PI},perp:function(){var t=this.x;this.x=-this.y,this.y=t},print:function(t){console.log(t?'[vec "'+t+'"] x: '+this.x+" y: "+this.y:"[vec] x: "+this.x+" y: "+this.y)}},"use strict",meta.math.AABB=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.initWidth=this.width,this.initHeight=this.height,this.minX=this.x,this.minY=this.y,this.maxX=this.x+this.width,this.maxY=this.y+this.height},meta.math.AABB.prototype={set:function(t,e){this.x=t,this.y=e,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},move:function(t,e){this.minX+=t,this.minY+=e,this.maxX+=t,this.maxY+=e},updatePos:function(){this.pivotPosX=this.scaleX>0?this.pivotX*this.width:(1-this.pivotX)*this.width,this.pivotPosY=this.scaleY>0?this.pivotY*this.height:(1-this.pivotY)*this.height,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},updatePosTransform:function(){this.pivotPosX=this.scaleX>0?this.pivotX*this.width:(1-this.pivotX)*this.width,this.pivotPosY=this.scaleY>0?this.pivotY*this.height:(1-this.pivotY)*this.height,this.minX=this.x-this.pivotPosX,this.minY=this.y-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height;var t=Math.sin(this.angle),e=Math.cos(this.angle);this.m11=e*this.scaleX,this.m12=t*this.scaleX,this.m21=-t*this.scaleY,this.m22=e*this.scaleY},resize:function(t,e){this.initWidth=t,this.initHeight=e,this.initPivotPosX=t*this.pivotX|0,this.initPivotPosY=e*this.pivotY|0,this.width=t*this.scaleX|0,this.height=e*this.scaleY|0,this.updatePos()},pivot:function(t,e){(this.pivotX!==t||this.pivotY!==e)&&(this.pivotX=t,this.pivotY=e,this.initPivotPosX=this.initWidth*this.pivotX|0,this.initPivotPosY=this.initHeight*this.pivotY|0,this.updatePos())},rotate:function(t){this.angle=t;var e=Math.sin(t),i=Math.cos(t);this.m11=i*this.scaleX,this.m12=e*this.scaleX,this.m21=-e*this.scaleY,this.m22=i*this.scaleY},scale:function(t,e){this.scaleX=t*this.flipX,this.scaleY=e*this.flipY,this.width=Math.floor(this.initWidth*t),this.height=Math.floor(this.initHeight*e),this.updatePosTransform()},flip:function(t,e){void 0===t?(this.flipX=-this.flipX,this.scaleX*=-1):this.flipX!==t&&(this.flipX=t,this.scaleX*=-1),void 0===e||this.flipY!==e&&(this.flipY=e,this.scaleY*=-1),this.updatePosTransform()},vsAABB:function(t){return this.maxX<t.minX||this.minX>t.maxX?!1:this.maxY<t.minY||this.minY>t.maxY?!1:!0},vsBorderAABB:function(t){return this.maxX<=t.minX||this.minX>=t.maxX?!1:this.maxY<=t.minY||this.minY>=t.maxY?!1:!0},vsAABBIntersection:function(t){return this.maxX<t.minX||this.minX>t.maxX?0:this.maxY<t.minY||this.minY>t.maxY?0:this.minX>t.minX||this.minY>t.minY?1:this.maxX<t.maxX||this.maxY<t.maxY?1:2},vsPoint:function(t,e){return this.minX>t||this.maxX<t?!1:this.minY>e||this.maxY<e?!1:!0},vsBorderPoint:function(t,e){return this.minX>=t||this.maxX<=t?!1:this.minY>=e||this.maxY<=e?!1:!0},getSqrDistance:function(t,e){var i,n=0;return t<this.minX&&(i=this.minX-t,n+=i*i),t>this.maxX&&(i=t-this.maxX,n+=i*i),e<this.minY&&(i=this.minY-e,n+=i*i),e>this.maxY&&(i=e-this.maxY,n+=i*i),n},getDistanceVsAABB:function(t){var e=this.minX+(this.maxX-this.minX)/2,i=this.minY+(this.maxY-this.minY)/2,n=t.minX+(t.maxY-t.minY)/2,s=t.minY+(t.maxY-t.minY)/2,o=n-e,h=s-i;return Math.sqrt(o*o+h*h)},isUndefined:function(){return void 0===this.maxY},genCircle:function(){var t=this.maxX-this.minX,e=this.maxY-this.minY,i;return i=t>e?t/2:e/2,new meta.math.Circle(this.x,this.y,i)},print:function(t){console.log(t?"(AABB) "+t+" minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY:"(AABB) minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY)},parentX:0,parentY:0,pivotX:0,pivotY:0,pivotPosX:0,pivotPosY:0,initPivotPosX:0,initPivotPosY:0,scaleX:1,scaleY:1,flipX:1,flipY:1,angle:0,m11:1,m12:0,m21:0,m22:1},"use strict",meta.math.AdvAABB=function(t,e,i,n){this.minX=t,this.minY=e,this.maxX=i,this.maxY=n,this.initWidth=i-t,this.initHeight=n-e,this.initHalfWidth=.5*this.initWidth,this.initHalfHeight=.5*this.initHeight,this.width=this.initWidth,this.height=this.initHeight,this.halfWidth=this.initHalfWidth,this.halfHeight=this.initHalfHeight,this.x=t+this.halfWidth|0,this.y=e+this.halfHeight|0,this.scaleX=1,this.scaleY=1},meta.math.AdvAABB.prototype={move:function(t,e){this.x+=t,this.y+=e,this.minX+=t,this.minY+=e,this.maxX+=t,this.maxY+=e},set:function(t,e){this.x=t,this.y=e,this.minX=this.x-this.halfWidth,this.minY=this.y-this.halfHeight,this.maxX=this.x+this.halfWidth,this.maxY=this.y+this.halfHeight},resize:function(t,e){this.initWidth=t,this.initHeight=e,this.initHalfWidth=.5*t,this.initHalfHeight=.5*e,this.width=t*this.scaleX,this.height=e*this.scaleY,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},scale:function(t,e){this.scaleX=t,this.scaleY=e,this.width=this.initWidth*this.scaleX,this.height=this.initHeight*this.scaleY,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.minX=this.x-this.halfWidth,this.minY=this.y-this.halfHeight,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},scalePivoted:function(t,e,i,n){this.scaleX=t,this.scaleY=e,this.width=this.initWidth*this.scaleX,this.height=this.initHeight*this.scaleY,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.x=i,this.y=n,this.minX=this.x-this.halfWidth,this.minY=this.y-this.halfHeight,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},vsAABB:function(t){return this.maxX<t.minX||this.minX>t.maxX?!1:this.maxY<t.minY||this.minY>t.maxY?!1:!0},vsBorderAABB:function(t){return this.maxX<=t.minX||this.minX>=t.maxX?!1:this.maxY<=t.minY||this.minY>=t.maxY?!1:!0},vsAABBIntersection:function(t){return this.maxX<t.minX||this.minX>t.maxX?0:this.maxY<t.minY||this.minY>t.maxY?0:this.minX>t.minX||this.minY>t.minY?1:this.maxX<t.maxX||this.maxY<t.maxY?1:2},vsPoint:function(t,e){return this.minX>t||this.maxX<t?!1:this.minY>e||this.maxY<e?!1:!0},vsBorderPoint:function(t,e){return this.minX>=t||this.maxX<=t?!1:this.minY>=e||this.maxY<=e?!1:!0},getSqrDistance:function(t,e){var i,n=0;return t<this.minX&&(i=this.minX-t,n+=i*i),t>this.maxX&&(i=t-this.maxX,n+=i*i),e<this.minY&&(i=this.minY-e,n+=i*i),e>this.maxY&&(i=e-this.maxY,n+=i*i),n},getDistanceVsAABB:function(t){var e=this.minX+.5*(this.maxX-this.minX),i=this.minY+.5*(this.maxY-this.minY),n=t.minX+.5*(t.maxY-t.minY),s=t.minY+.5*(t.maxY-t.minY),o=n-e,h=s-i;return Math.sqrt(o*o+h*h)},isUndefined:function(){return void 0===this.maxY},draw:function(t){var e=meta.unitSize,i,n,s,o;i=0|this.minX,n=0|this.minY,s=this.maxX+.5|0,o=this.maxY+.5|0,t.beginPath(),t.moveTo(i,n),t.lineTo(s,n),t.lineTo(s,o),t.lineTo(i,o),t.lineTo(i,n),t.stroke()},drawTranslated:function(t){var e=meta.camera;this.translate(e._x,e._y),this.draw(t),this.translate(-e._x,-e._y)},genCircle:function(){var t;return t=this.initHalfWidth>this.initHalfHeight?this.initHalfWidth:this.initHalfHeight,new meta.math.Circle(this.x,this.y,t)},print:function(t){console.log(t?"(AABB) "+t+" minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY:"(AABB) minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY)}},"use strict",meta.math.Circle=function(t,e,i){this.x=t,this.y=e,this.radius=i},meta.math.Circle.prototype={vsPoint:function(t,e){return 2*(this.x-t)+2*(this.y-e)<=2*radius},vsCircle:function(t){var e=this.radius+t.radius;e*=e;var i=this.x+t.x;i*=i;var n=this.y+t.y;return n*=n,i+n>e},overlapCircle:function(t){var e=Math.sqrt((this.x-t.x)*(this.y-t.y));return e>this.radius+t.radius?0:e<=Math.abs(this.radius+t.radius)?1:2},genAABB:function(){return new meta.math.AABB(this.x-this.radius,this.y-this.radius,this.x+this.radius,this.y+this.radius)},print:function(t){t?console.log("["+t+"] x:",this.x,"y:",this.y,"raidus:",this.radius):console.log("x:",this.x,"y:",this.y,"raidus:",this.radius)}},"use strict",meta.math.Matrix4=function(){this.m=new Float32Array(16),this.m[0]=1,this.m[5]=1,this.m[10]=1,this.m[15]=1},meta.math.Matrix4.prototype={reset:function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=1,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=1,this.m[11]=0,this.m[12]=0,this.m[13]=0,this.m[14]=0,this.m[15]=1},scale:function(t,e,i){this.m[0]=t,this.m[5]=e,this.m[10]=i},ortho:function(t,e,i,n,s,o){this.m[0]=2/(e-t),this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=2/(n-i),this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=-2/(o-s),this.m[11]=0,this.m[12]=-(e+t)/(e-t),this.m[13]=-(n+i)/(n-i),this.m[14]=-(o+s)/(o-s),this.m[15]=1}},"use strict",meta.math.Random=function(){this.seed=0,this.a=0,this.m=0,this.q=0,this.r=0,this.oneOverM=0,this.init()},meta.math.Random.prototype={init:function(){this.setSeed(3456789012,!0)},generate:function(){var t=Math.floor(this.seed/this.q),e=this.seed%this.q,i=this.a*e-this.r*t;return this.seed=i>0?i:i+this.m,this.seed*this.oneOverM},number:function(t,e){var i=this.generate();return Math.round((e-t)*i+t)},numberF:function(t,e){var i=this.generate();return(e-t)*i+t},setSeed:function(t,e){if(void 0!==e&&(e=!0),e===!0){var i=new Date;this.seed=t+16777215*i.getSeconds()+65535*i.getMinutes()}else this.seed=t;this.a=48271,this.m=2147483647,this.q=Math.floor(this.m/this.a),this.r=this.m%this.a,this.oneOverM=1/this.m}},meta.random=new meta.math.Random,"use strict",meta.Tween=function(){this.cache=null,this.chain=[]},meta.Tween.prototype={play:function(){if(this.cache){var t=this.cache;if(!t.owner)return this;if(t.owner.isRemoved)return this;t.isPaused=!1,t.numRepeat=this.numRepeat,this.next(),this._play(),this.cache=null}else this.autoPlay=!0;return this},_play:function(){Renderer.ctrl._addToUpdating(this.cache)&&this._group&&this._group.activeUsers++},stop:function(t){return this.linkIndex=0,this._stop(t),this.cache&&(this.autoPlay=!1,this.cache=null),this},_stop:function(t){Renderer.ctrl._removeFromUpdating(this.cache)&&(t&&t(this.cache.owner),this.cache.currLink._onDone&&this.cache.currLink._onDone.call(this.cache.owner),this._group&&(this._group.activeUsers--,0===this._group.activeUsers&&this._group.callback&&this._group.callback()))},paused:function(t){return void 0===t&&(t=!0),this.cache.isPaused=t,this},resume:function(){return this.cache.isPaused=!1,this},clear:function(){return this.stop(),this._tStart=0,this.chain.length=0,this.linkIndex=0,this.currLink=null,this._group&&(this._group.users--,this._group=null),this},reset:function(){var t=this.cache;if(t.linkIndex=0,t.currLink=this.chain[0],!t.currLink)return this;for(var e in t.currLink.startValues)t.owner[e]=t.currLink.startValues[e];return this.stop(!1),this},next:function(){var t=!1,e=this.cache;if(e.linkIndex===this.chain.length){if(0===e.numRepeat)return this.stop(),this;if(e.linkIndex=0,-1!==e.numRepeat&&(e.numRepeat--,0===e.numRepeat))return this.stop(),this;t=!0}e._isLinkDone=!1;var i,n=this.chain[e.linkIndex++],s=e.owner;if(t)for(i in n.startValues)s[i]=n.startValues[i];else for(i in n.endValues)n.startValues[i]=s[i];return n._onStart&&n._onStart.call(this),e._tStart=meta.engine.tNow,e.currLink=n,this},repeat:function(t){return void 0===t&&(t=-1),this.numRepeat=t,this},set reverse(t){return void 0===t&&(t=!0),this.cache.isReverse=t,this},get reverse(){return this.cache.isReverse},update:function(t){var e=this.cache;if(!e.currLink)return this.stop(!1),void 0;var i=meta.engine.tNow,n=i-e._tFrame;if(!(n<e.currLink.tFrameDelay)){var s=(i-e._tStart)/e.currLink.duration;if(s>1&&(s=1),e._isLinkDone){if(n<e.currLink.tDelay)return}else e._tFrame=i,e.currLink.update(s),e.currLink._onTick&&e.currLink._onTick.call(this);if(1===s){if(!e._isLinkDone&&e.currLink.tDelay>0)return e._isLinkDone=!0,void 0;this.next()}}},to:function(t,e,i){var n=new meta.Tween.Link(this,t,e,i);return this.chain.push(n),n},wait:function(t){var e=this.to(null,0,null);return e.wait(t),e},group:function(t){return t?this._group?(console.warn("[meta.Tween.group]:","Tween already is part of a group."),this):("object"==typeof t&&(this._group=t),this._group.users++,this):(console.warn("[meta.Tween.group]:","No group name specified."),this)},autoPlay:!1,_group:null,_isReversing:!1,_removeFlag:0,numRepeat:0},meta.Tween.Cache=function(t){this.owner=t,this.tween=null,this.linkIndex=0,this.currLink=null,this.numRepeat=0,this._updateNodeID=-1,this._isLinkDone=!1,this._tStart=0,this._tFrame=0},meta.Tween.Cache.prototype={update:function(t){this.tween.cache=this,this.tween.update(t),this.tween.cache=null},isPaused:!1,isRemoved:!1,reverse:!1,_flags:0},meta.Tween.Group=function(t,e){"function"==typeof t&&(e=t,t=""),this.name=t,this.users=0,this.activeUsers=0,this.callback=e||null},"use strict",meta.Tween.Easing={linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintIntOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineIntOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)))},elasticOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/n)+1)},elasticInOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n):i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)*.5+1)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:function(t){return 1-meta.Tween.Easing.bounceOut(1-t)},bounceOut:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return.5>t?.5*meta.Tween.Easing.bounceIn(2*t):.5*meta.Tween.Easing.bounceOut(2*t-1)+.5}},"use strict",meta.Tween.Link=function(t,e,i,n){this.tween=t,this.startValues={},this.endValues=e,this.duration=i,this._onDone=n},meta.Tween.Link.prototype={play:function(){return this.tween.play(),this},stop:function(){return this.tween.stop(),this},paused:function(t){return this.tween.paused(t),this},resume:function(){return this.tween.resume(),this},clear:function(){return this.tween.clear(),this},reset:function(){return this.tween.reset(),this},update:function(t){var e=this._easing(t),i,n,s,o=this.tween.cache.owner;for(var h in this.endValues)i=this.startValues[h],n=this.endValues[h],"string"==typeof i&&(n=i+parseFloat(n,4)),s=i+(n-i)*e,this.isRounding&&(s=Math.round(s)),o[h]=s},next:function(){return this.tween.next(),this},wait:function(t){return this.tDelay=t,this},frameDelay:function(t){return this.tFrameDelay=t,this},round:function(t){return void 0===t&&(t=!0),this.isRounding=t,this},repeat:function(t){return this.tween.repeat(t),this},reverse:function(t){return this.tween.reverse(t),this},easing:function(t){return this._easing="function"==typeof t?t:meta.Tween.Easing[t],void 0===this._easing&&(this._easing=meta.Tween.Easing.linear),this
},onStart:function(t){return this._onStart=t,this},onDone:function(t){return this._onDone=t,this},onTick:function(t){return this._onTick=t,this},to:function(t,e,i){return this.tween.to(t,e,i)},group:function(t){return this.tween.group(t)},_easing:meta.Tween.Easing.linear,_onStart:null,_onDone:null,_onTick:null,tDelay:0,tFrameDelay:0,isRounding:!1},"use strict",window.Component={},"use strict";var Resource={};Resource.Controller=meta.Controller.extend({init:function(){this.resources={},this.resourcesInUse={},this._chn_added=meta.createChannel(Resource.Event.ADDED),this._chn_allLoaded=meta.createChannel(Resource.Event.ALL_LOADED);var t=document.createElement("canvas");Resource.Texture.prototype._tmpImg=t,Resource.Texture.prototype._tmpCtx=t.getContext("2d"),meta.subscribe(this,meta.Event.ADAPT,this.onAdapt);var e=Resource.Sound.prototype;meta.device.isAudioAPI?(e._context=new AudioContext,console.log("%cAudio: %cWebAudio ","font-weight: bold; padding: 2px 0 2px 0;","padding: 2px 0 2px 0;")):(e._loadFromUrl=e._loadFromUrl_legacy,e._clear=e._clear_legacy,e._createInstance=e._createInstance_legacy,e._syncLoading=!0,console.log("%cAudio: %c<audio> ","font-weight: bold; padding: 2px 0 1px 0; width: 500px;","padding: 2px 0 1px 0;"))},add:function(t){var e=this.resources[t.type];e||(e={},this.resources[t.type]=e);var i=t.path;if("unknown"===t.name&&i){var n=i.lastIndexOf("."),s=i.lastIndexOf("/");t.name=0>n||i.length-n>5?i.slice(s+1):i.slice(s+1,n)}return e[t.name]?(console.warn("[Resource.Manager.add]:","There is already a resource("+meta.enumToString(Resource.Type,t.type)+") added with a name: "+t.name),null):(e[t.name]=t,this._chn_added.emit(t,Resource.Event.ADDED),t)},remove:function(t){var e=this.resources[t.type];return e&&e[t.name]?(e[t.name]=null,void 0):(console.warn("[Resource.Manager.remove]:","Resource("+meta.enumToString(Resource.Type,t.type)+")("+t.name+") is not added to the manager."),void 0)},addToLoad:function(t){this.loading=!0,t.loading=!0,meta.engine.ready||this.numToLoad++},loadSuccess:function(t){var e=this.resourcesInUse[t.type];e||(e=[],this.resourcesInUse[t.type]=e),e.push(t),t.isLoading=!1,t.inUse=!0,meta.engine.ready||(this.numToLoad--,this.numLoaded++,0!==this.numToLoad||meta.engine.loading||(meta.engine.onReady(),this._chn_allLoaded.emit(this,Resource.Event.ALL_LOADED)))},loadFailed:function(t){t.loading=!1,meta.engine.ready||(this.numToLoad--,0!==this.numToLoad||meta.engine.loading||(meta.engine.onReady(),this._chn_allLoaded.emit(this,Resource.Event.ALL_LOADED)))},getTexture:function(t){if(!t)return console.warn("[Resource.Manager.getTexture]:","No name specified."),null;var e=this.resources[Resource.Type.TEXTURE];if(!e)return null;var i=e[t];return i?i:null},getSound:function(t){if(!t)return console.warn("[Resource.Manager.getSound]:","No name specified."),null;var e=this.resources[Resource.Type.SOUND];if(!e)return null;var i=e[t];return i?i:null},addToQueue:function(t){this._syncQueue||(this._syncQueue=[]),this._syncQueue.push(t)},loadNextFromQueue:function(){this.isSyncLoading=!1,this._syncQueue&&this._syncQueue.length&&(this._syncQueue[this._syncQueue.length-1].forceLoad(!0),this._syncQueue.pop())},onAdapt:function(t,e){var i=meta.unitRatio,n,s=this.resources[Resource.Type.TEXTURE];for(var o in s)n=s[o],n.unitRatio=i,n.load()},getUniqueID:function(){return++this._uniqueID},resources:null,resourcesInUse:null,rootPath:"",numLoaded:0,numToLoad:0,_syncQueue:null,isSyncLoading:!1,_chn_added:null,_chn_allLoaded:null,_uniqueID:0,loading:!1}),"use strict",Resource.Event={UNLOADED:"res-unloaded",LOADED:"res-loaded",RESIZE:"res-resize",CHANGED:"res-changed",ADDED:"res-added",ALL_LOADED:"res-all-loaded"},Resource.Type={BASIC:0,TEXTURE:1,SOUND:2,SPRITE_SHEET:3,FONT:4},Resource.TextureType={UNKNOWN:-1,CANVAS:0,WEBGL:1},Resource.AnimType={NONE:0,LINEAR_H:1,LINEAR_V:2,RADIAL:3,RADIAL_TOP_LEFT:4,RADIAL_TOP_RIGHT:5,RADIAL_BOTTOM_LEFT:6,RADIAL_BOTTOM_RIGHT:7},"use strict",Resource.Basic=meta.Class.extend({_init:function(){this.id=Resource.ctrl.getUniqueID()},subscribe:function(t,e){this.chn||(this.chn=meta.createChannel("__res"+this.id)),this.chn.subscribe(t,e)},unsubscribe:function(t){this.chn&&(this.chn.unsubscribe(t),0===this.chn.numSubs&&(this.chn.remove(),this.chn=null))},emit:function(t,e){this.chn&&this.chn.emit(t,e)},set loaded(t){t?this._loaded?(this._loaded=t,this.emit(this,Resource.Event.CHANGED)):(this._loaded=t,this.emit(this,Resource.Event.LOADED)):this._loaded&&(this._loaded=t,this.emit(this,Resource.Event.UNLOADED))},get loaded(){return this._loaded},id:0,type:Resource.Type.BASIC,name:"unknown",path:"",fullPath:"",chn:null,_loaded:!1,loading:!1,used:!1}),"use strict",Resource.Texture=Resource.Basic.extend({init:function(t){this.generate();var e=typeof t;if("string"===e)this.load(t);else if("object"===e){for(var i in t)this[i]=t[i];(this.framesX>1||this.framesY>1)&&(this.frames=this.framesX*this.framesY,this.animated=!0),this.path&&this.load(this.path)}},remove:function(){},generate:function(){this.loaded=!0,this.canvas=document.createElement("canvas"),this.canvas.width=this.trueFullWidth,this.canvas.height=this.trueFullHeight,this.ctx=this.canvas.getContext("2d")},load:function(t){if(!this.loading&&(this.loaded=!1,t)){this.path=t;var e=this.path.lastIndexOf(".");(-1===e||this.path.length-e>4)&&(this.path+=".png"),this.fullPath=meta.cache.currResolution?Resource.ctrl.rootPath+meta.cache.currResolution.path+this.path:Resource.ctrl.rootPath+this.path;var i=this,n=new Image;n.onload=function(){return n.complete?(i.createFromImg(n),Resource.ctrl.loadSuccess(i),void 0):(console.warn("(Resource.Texture.load) Could not load texture from - "+n.src),Resource.ctrl.loadFailed(i),void 0)},n.onerror=function(t){Resource.ctrl.loadFailed(i)},n.src=this.fullPath,Resource.ctrl.addToLoad(this)}},createFromImg:function(t){this._loaded&&this.clear(),this.resize(t.width,t.height),this.ctx.drawImage(t,0,0),this.unitRatio=meta.unitRatio,this._reloading=!1,this.loaded=!0},_createCachedImg:function(){this._cachedImg||(this._cachedImg=document.createElement("canvas"),this._cachedImg.width=this.trueFullWidth,this._cachedImg.height=this.trueFullHeight,this._cachedCtx=this._cachedImg.getContext("2d"))},resize:function(t,e){if(this.trueFullWidth!==t||this.trueFullHeight!==e){this.trueFullWidth=t,this.trueFullHeight=e,this.animated?(this.trueWidth=t/this.framesX,this.trueHeight=e/this.framesY):(this.trueWidth=t,this.trueHeight=e);var i=meta.engine.unitRatio;this.width=this.trueWidth*i+.5|0,this.height=this.trueHeight*i+.5|0,this.fullWidth=this.trueFullWidth*i+.5|0,this.fullHeight=this.trueFullHeight*i+.5|0,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this._loaded&&this.canvas.width>1&&this.canvas.height>1?(this._tmpImg.width=this.canvas.width,this._tmpImg.height=this.canvas.height,this._tmpCtx.drawImage(this.canvas,0,0),this.canvas.width=this.trueFullWidth,this.canvas.height=this.trueFullHeight,this.ctx.drawImage(this._tmpImg,0,0)):(this.canvas.width=this.trueFullWidth,this.canvas.height=this.trueFullHeight),this._loaded&&!this._realoading&&this.emit(this,Resource.Event.RESIZE)}},upResize:function(t,e){t<this.trueFullWidth&&(t=this.trueFullWidth),e<this.trueFullHeight&&(e=this.trueFullHeight),this.resize(t,e)},draw:function(t,e,i){this.fromAtlas?t.drawImage(this.ptr.canvas,this._x,this._y,this.trueWidth,this.trueHeight,e,i,this.trueWidth,this.trueHeight):t.drawImage(this.canvas,e,i)},drawFrame:function(t,e,i,n){t.drawImage(this.canvas,this.trueWidth*(n%this.framesX),this.trueHeight*Math.floor(n/this.framesX),this.trueWidth,this.trueHeight,e,i,this.trueWidth,this.trueHeight)},clear:function(){this.ctx.clearRect(0,0,this.trueFullWidth,this.trueFullHeight)},drawOver:function(t,e,i){if(!t)return console.warn("(Resource.Texture.drawOver) No texture specified."),void 0;if(e=e||0,i=i||0,"string"==typeof t){var n=meta.getTexture(t);if(!n)return console.warn("(Resource.Texture.drawOver) No such texture with name - "+t),void 0;t=n}if(t.textureType===Resource.TextureType.WEBGL){if(!t._canvasCache)return t._canvasCache=new Resource.Texture(Resource.TextureType.CANVAS,t.path),t._canvasCache.load(),t=t._canvasCache,this._loadCache={name:"drawOver",texture:t,x:e,y:i},this.isLoaded=!1,t.subscribe(this,this.onTextureCacheEvent),void 0;t=t._canvasCache}var s=this.ctx;if(this.textureType&&(this._createCachedImg(),s=this._cachedCtx),s.drawImage(t.image,e,i),this.textureType){var o=meta.ctx;o.bindTexture(o.TEXTURE_2D,this.image),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,this._cachedImg)}this.isLoaded=!0},generateAlphaMask:function(){if(!this._isLoaded)return console.warn("[Resource.Texture.generateMask]:","Texture is not loaded yet."),void 0;if(0!==this.textureType)return console.warn("[Resource.Texture.generateMask]:","Only canvas textures are supported currently."),void 0;var t=new Resource.Texture(Resource.TextureType.CANVAS);t.resize(this.trueFullWidth,this.trueFullHeight);for(var e=this.ctx.getImageData(0,0,this.trueFullWidth,this.trueFullHeight),i=e.data,n=i.length,s=0;n>s;s+=4)i[s]=255,i[s+1]=255,i[s+2]=255;return t.ctx.putImageData(e,0,0),t.isLoaded=!0,t},onTextureCacheEvent:function(t,e){e===Resource.Event.LOADED&&(t.unsubscribe(this),"drawOver"===this._loadCache.name?this.drawOver(this._loadCache.texture,this._loadCache.x,this._loadCache.y):this[this._loadCache.name](this._loadCache.data),this._loadCache=null)},set offsetX(t){this._offsetX=t,this._loaded&&this.emit(this,Resource.Event.CHANGED)},set offsetY(t){this._offsetY=t,this._loaded&&this.emit(this,Resource.Event.CHANGED)},get offsetX(){return this._offsetX},get offsetY(){return this._offsetY},getData:function(){return this.ctx.getImageData(0,0,this.trueWidth,this.trueHeight).data},getPixelAt:function(t,e){return this.ctx.getImageData(t,e,1,1).data},applyCanvas:function(t){this.canvas=t,this.ctx=t.getContext("2d"),this.resize(t.width,t.height)},type:Resource.Type.TEXTURE,ptr:null,canvas:null,ctx:null,_x:0,_y:0,_width:0,_height:0,fullWidth:0,fullHeight:0,_widthRatio:0,_heightRatio:0,_offsetX:0,_offsetY:0,unitRatio:1,fps:9,frames:1,framesX:1,framesY:1,fromAtlas:!1,reloading:!1,_tmpImg:null,_tmpCtx:null,_cachedImg:null,_cachedCtx:null,_anim:null,_frames:null,_loadCache:null,_canvasCache:null}),"use strict",Resource.Sound=Resource.Basic.extend({init:function(t,e){if("string"==typeof t&&(e=t,t=void 0),e){var i=e.lastIndexOf(".");-1!==i&&e.length-i<=5&&(this.format=e.substr(i+1,e.length-i-1),e=e.substr(0,i)),this.path=Resource.ctrl.rootPath+e}this._instances=[];var n=this;meta.device.isAudioAPI?(this._request=new XMLHttpRequest,this._request.responseType="arraybuffer",this._request.onreadystatechange=function(){n._onStateChange()}):(this._context=this._getInstance(),this._context.audio.addEventListener("error",function(){n.format?n._onLoadFailed():n._loadNextExtension()}),this._numInstancesUsed=0)},load:function(){if(!this.isLoading){this.isLoading=!0,this.isLoaded=!1,Resource.ctrl.addToLoad(this);var t=Resource.ctrl;t.isSyncLoading?t.addToQueue(this):(this.syncLoading||(t.isSyncLoading=!0),this._loadNextExtension())}},forceLoad:function(){this._loadNextExtension()},_loadNextExtension:function(){var t;if(this.format)t=this.path;else{var e=meta.device.audioFormats;if(this._requestFormat++,this._requestFormat>e.length)return this._onLoadFailed(),void 0;t=this.path+"."+meta.device.audioFormats[this._requestFormat-1]}this._loadFromUrl(t)},_loadFromUrl:function(t){this._request.open("GET",t,!0),this._request.send()},_loadFromUrl_legacy:function(t){this._context.audio.src=t,this._context.audio.load()},_clear:function(){this._request.onreadystatechange=null,this._request=null},_clear_legacy:function(){},_onStateChange:function(){if(4===this._request.readyState)if(200===this._request.status){var t=this;this._context.decodeAudioData(this._request.response,function(e){t._onDecodeSuccess(e)},function(){t._onDecodeError()}),this._request=null}else this.format?this._onLoadFailed():this._loadNextExtension()},_onDecodeSuccess:function(t){this.format||(this.path+="."+meta.device.audioFormats[this._requestFormat-1]),this._buffer=t,this._isLoading=!1,this._clear(),this.isLoaded=!0,Resource.ctrl.loadSuccess(this);for(var e=this._instances.length,i=0;e>i;i++)this._createSource(this._instances[i])},_onDecodeError:function(){this.format||(this.path+="."+meta.device.audioFormats[this._requestFormat-1]),console.warn("[Resource.Sound.load]:","Error decoding file: "+this.path),this._isLoading=!1,this._clear(),Resource.ctrl.loadFailed(this)},_onLoadFailed:function(){if(!this.format){var t=meta.device.audioFormats[this._requestFormat-1];t&&(this.path+="."+t)}console.warn("[Resource.Sound.load]:","Error loading file: "+this.path),this._isLoading=!1,this._clear(),Resource.ctrl.loadFailed(this)},play:function(t,e){var i=this._getInstance();i.isLoop=t||!1,i.play(e)},stop:function(){for(var t=0;t<this._numInstancesUsed;t++)this._instances[t]._stop();this._numInstancesUsed=0},pause:function(){for(var t=0;t<this._numInstancesUsed;t++)this._instances[t].pause()},resume:function(){for(var t=0;t<this._numInstancesUsed;t++)this._instances[t].resume()},_createSource:function(t){var e=this._context.createGain();e.connect(this._context.destination);var i=this._context.createBufferSource();i.buffer=this._buffer,i.loop=t._isLoop,i.connect(e),i.start||(i.start=i.noteOn),i.stop||(i.stop=i.noteOff);var n=this;return i.onended=function(){n._clearInstance(t)},t.source=i,t.gainNode=e,i},_createInstance:function(){return new Resource.AudioInstance},_createInstance_legacy:function(){return new Resource.AudioInstance_legacy(this)},_getInstance:function(){this._instances.length===this._numInstancesUsed&&(this._instances.length+=1,this._instances[this._numInstancesUsed]=this._createInstance());var t=this._instances[this._numInstancesUsed];return t.id=this._numInstancesUsed,this._numInstancesUsed++,t},_clearInstance:function(t){this._numInstancesUsed--;var e=this._instances[this._numInstancesUsed];e.id=t.id,this._instances[t.id]=e},set volume(t){if(this._volume!==t){this._volume=t;for(var e=this._instances.length,i=0;e>i;i++)this._instances[i].volume=t}},get volume(){return this._volume},get isPlaying(){return this._numInstancesUsed>0?!0:!1},type:Resource.Type.SOUND,format:"",_instances:null,_numInstancesUsed:0,_autoIsLoop:!1,_autoTime:0,_context:null,_buffer:null,_request:null,_requestFormat:0,_volume:1,_isInQueue:!1,_syncLoading:!1}),Resource.AudioInstance=function(){this.id=-1,this.source=null,this.gainNode=null,this.auto,this._volume=1,this._mixedVolume=1},Resource.AudioInstance.prototype={set volume(t){this._mixedVolume=this._volume*t,this.gainNode.gain.value=this._mixedVolume},get volume(){return this._volume},get mixedVolume(){return this._mixedVolume}},Resource.AudioInstance_legacy=function(t){this.id=-1,this.parent=t,this.isPlaying=!1,this.isLoop=!1,this._canPlay=!1,this._metaLoaded=!1,this._isLoaded=!1,this._volume=1,this._mixedVolume=1,this.audio=new Audio,this.audio.preload="auto",this._addEvents(t)},Resource.AudioInstance_legacy.prototype={play:function(t){this.isPlaying=!0,this._isLoaded?(this.audio.currentTime=t||0,this.audio.play()):this._autoPlay=!0},stop:function(){this.isPlaying=!1,this.isLoop=!1,this.audio.pause(),this.parent._clearInstance(this)},_stop:function(){this.isPlaying=!1,this.isLoop=!1,this.audio.pause()},pause:function(){this.isPlaying=!1,this.audio.pause()},resume:function(){this.isPlaying=!0,this.audio.play()},_addEvents:function(){var t=this,e=function(){t.audio.removeEventListener("canplaythrough",e),t._canPlay=!0,meta.device.support.onloadedmetadata&&t._metaLoaded&&t._onLoaded()};if(this.audio.addEventListener("canplaythrough",e,!1),meta.device.support.onloadedmetadata){var i=function(){t.audio.removeEventListener("loadedmetadata",i),t._metaLoaded=!0,t._canPlay&&t._onLoaded()};this.audio.addEventListener("loadedmetadata",i,!1)}this.audio.addEventListener("ended",function(){t._onEnd()},!1),this.parent._isLoaded&&(this.audio.src=this.parent.path,this.audio.load())},_onLoaded:function(){if(!this.parent._isLoaded){this.parent.format||(this.parent.path+="."+meta.device.audioFormats[this.parent._requestFormat-1]),this.parent._isLoading=!1,this.parent.isLoaded=!0;for(var t,e=this.parent._instances,i=this.parent._instances.length,n=1;i>n;n++)t=e[n],t.audio.src=this.parent.path,t.audio.load();Resource.ctrl.loadSuccess(parent),Resource.ctrl.loadNextFromQueue()}this._isLoaded=!0,this._autoPlay&&this.audio.play()},_onEnd:function(){this.isLoop?(this.audio.play(),this.audio.currentTime=0):this.isPlaying&&(this.isPlaying=!1,this.parent._clearInstance(this))},set currentTime(t){this.isPlaying?this.audio.currentTime=t||0:(this.audio.play(),this.audio.currentTime=t||0,this.audio.pause())},get currentTime(){return this.audio.currentTime},set volume(t){t>1?t=1:0>t&&(t=0),this._mixedVolume=this._volume*t,this.audio.volume=this._mixedVolume},get volume(){return this._volume},get mixedVolume(){return this._mixedVolume},_autoPlay:!1},"use strict",Resource.SpriteSheet=Resource.Basic.extend({init:function(t,e){if("string"==typeof t)e=t,t=void 0;else for(var i in t)this[i]=t[i];if(e){var n=e.lastIndexOf(".");-1!==n&&e.length-n<=5&&(this.format=e.substr(n+1,e.length-n-1),e=e.substr(0,n)),this.path=Resource.ctrl.rootPath+e,this.format||(this.format="xml")}},load:function(){if(!this.isLoading){this.isLoading=!0,this.isLoaded=!1,this._isAtlasLoaded=!1,this.texture?"string"==typeof this.texture&&(this.texture=new Resource.Texture(this.texture)):this.texture=new Resource.Texture(this.path),this.texture._isLoaded||(this.texture.subscribe(this,this._onTextureEvent),this.texture._isLoading||this.texture.load());var t=this,e=this.path+"."+this.format;this._request=new XMLHttpRequest,this._request.open("GET",e,!0),this._request.onreadystatechange=function(){t._onStateChange()},this._request.send(),Resource.ctrl.addToLoad(this)}},loadData:function(t,e){if(e=e||this.format,e||(e="xml"),this.format=e,this.isLoaded=!0,"xml"===e){var i=new DOMParser,n=i.parseFromString(t,"text/xml");return this.loadXML(n)}if("json"===e){var s=JSON.parse(t);return this.loadJSON(s)}if("plist"===e){var i=new DOMParser,o=i.parseFromString(t,"text/xml");return this.loadPlist(o)}return console.warn("[Resource.SpriteSheet.loadData]:","Trying to load an unsupported format - "+this.format),!1},loadXML:function(t){if(!t)return console.warn("[Resource.SpriteSheet.loadXML]:","Invalid XML file."),!1;for(var e=t.documentElement.childNodes,i=e.length,n,s=0;i>s;s++)if(n=e[s],"SubTexture"===n.nodeName)this._loadXML_Starling(n);else if("sprite"===n.nodeName)this._loadXML_genericXML(n);else if("dict"===n.nodeName)return this.loadPlist(t);return!0},_loadXML_Starling:function(t){var e=new Resource.Texture;e.fromAtlas=!0,e.ptr=this.texture,e.name=t.getAttribute("name"),e.x=t.getAttribute("x"),e.y=t.getAttribute("y"),e.resize(t.getAttribute("width"),t.getAttribute("height")),e.isLoaded=!0,Resource.ctrl.add(e)},_loadXML_genericXML:function(t){var e=new Resource.Texture;e.fromAtlas=!0,e.ptr=this.texture,e.name=t.getAttribute("n"),e.x=t.getAttribute("x"),e.y=t.getAttribute("y"),e.resize(t.getAttribute("w"),t.getAttribute("h")),e.isLoaded=!0,Resource.ctrl.add(e)},loadPlist:function(t){if(!t)return console.warn("[Resource.SpriteSheet.loadPlist]:","Invalid Plist file."),!1;for(var e=t.documentElement.childNodes,i=e.length,n,s=0;i>s;s++)if(n=e[s],"dict"===n.nodeName)return this._loadPlist_dict(n)},_loadPlist_dict:function(t){for(var e=t.childNodes,i=e.length,n="",s=0;i>s;s++)if(t=e[s],"key"===t.nodeName)n=t.textContent;else if("dict"===t.nodeName){if(!n)continue;"frames"===n&&this._loadPlist_frames(t)}},_loadPlist_frames:function(t){for(var e=t.childNodes,i=e.length,n="",s=0;i>s;s++)t=e[s],"key"===t.nodeName?n=t.textContent:"dict"===t.nodeName&&this._loadPlist_frame(t,n)},_loadPlist_frame:function(t,e){var i=new Resource.Texture;i.fromAtlas=!0,i.ptr=this.texture,i.name=e;for(var n=t.childNodes,s=n.length,o="",h,r=0;s>r;r++)if(t=n[r],"key"===t.nodeName)o=t.textContent;else if("string"===t.nodeName&&"frame"===o)return h=t.textContent.match(/[0-9]+/g),i.x=parseInt(h[0]),i.y=parseInt(h[1]),i.resize(parseInt(h[2]),parseInt(h[3])),i.isLoaded=!0,Resource.ctrl.add(i),void 0},loadJSON:function(t){return t?(t.frames instanceof Array?this._loadJSON_array(t):this._loadJSON_hash(t),!0):(console.warn("[Resource.SpriteSheet.loadFromJSON]:","Invalid JSON file."),!1)},_loadJSON_array:function(t){for(var e,i,n=t.frames,s=n.length,o=0;s>o;o++)e=n[o],i=new Resource.Texture,i.fromAtlas=!0,i.ptr=this.texture,i.name=e.filename,e=e.frame,i.x=e.x,i.y=e.y,i.resize(e.w,e.h),i.isLoaded=!0,Resource.ctrl.add(i)},_loadJSON_hash:function(t){var e,i,n=t.frames;for(var s in n)e=n[s].frame,i=new Resource.Texture,i.fromAtlas=!0,i.ptr=this.texture,i.name=s,i.x=e.x,i.y=e.y,i.resize(e.w,e.h),i.isLoaded=!0,Resource.ctrl.add(i)},loadAtlas:function(){if("object"!=typeof this.atlas)return console.warn("[Resource.SpriteSheet.loadFromAtlas]:","Incorrect atlas object, expected to be an Array."),!1;for(var t=[],e,i,n,s=this.atlas.length,o=0;s>o;o++)e=this.atlas[o],n=e.name||this.params,n?(e.x=e.x||this.params.x||0,e.y=e.y||this.params.y||0,e.width=e.width||this.params.width||1,e.height=e.height||this.params.height||1,t.push(e),i=new Resource.Texture,i.fromAtlas=!0,i.ptr=this.texture,i.name=n,i.x=e.x,i.y=e.y,i.resize(e.width,e.height),i.numFrames=e.numFrames||this.params.numFrames||1,i.isLoaded=!0,Resource.ctrl.add(i)):console.warn("[Resource.SpriteSheet.loadFromAtlas]:","No name defined for atlas item in "+this.name+" spritesheet.");return this.texture._frames=t,this.atlas=null,this.isLoaded=!0,!0},_onTextureEvent:function(t,e){e===Resource.Event.LOADED&&(this.texture.unsubscribe(this),this._isAtlasLoaded&&(this.loadData(this._response,this.format),Resource.ctrl.loadSuccess(this),this._response=null))},_onStateChange:function(){4===this._request.readyState&&(200===this._request.status?(this._isAtlasLoaded=!0,this._response=this._request.response,this._request=null,this.texture._isLoaded&&(this.loadData(this._response,this.format),Resource.ctrl.loadSuccess(this),this._response=null)):(this._isLoading=!1,this._request.onreadystatechange=null,this._request=null,Resource.ctrl.loadFailed(this)))},type:Resource.Type.SPRITE_SHEET,format:"",atlas:null,params:null,texture:null,_request:null,_response:null,_isAtlasLoaded:!1}),"use strict",Resource.Font=Resource.Basic.extend({init:function(t,e){if("string"==typeof t)e=t,t=void 0;else for(var i in t)this[i]=t[i];if(e){var n=e.lastIndexOf(".");-1!==n&&e.length-n<=5&&(this.format=e.substr(n+1,e.length-n-1),e=e.substr(0,n)),this.path=Resource.ctrl.rootPath+e,this.format||(this.format="fnt")}},load:function(){console.log("load")},type:Resource.Type.FONT,format:""}),"use strict",window.Entity={},Entity.Controller=meta.Controller.extend({init:function(){var t=Entity.Geometry.prototype;t._entityCtrl=this,t._parent=this,this.InputFlag=t.InputFlag,this.entities=[],this.entitiesToUpdate=[],this.entitiesToRemove=[],this.entitiesRemoveUpdate=[],this.detachBuffer=[],this._centerTex=new Resource.Texture,this._centerTex.fillRect({color:"#ff0000",width:6,height:6});var e=meta;this._chnOnDown=e.createChannel(Entity.Event.INPUT_DOWN),this._chnOnUp=e.createChannel(Entity.Event.INPUT_UP),this._chnOnClick=e.createChannel(Entity.Event.CLICK),this._chnOnDbClick=e.createChannel(Entity.Event.DBCLICK),this._chnOnDrag=e.createChannel(Entity.Event.DRAG),this._chnOnDragStart=e.createChannel(Entity.Event.DRAG_START),this._chnOnDragEnd=e.createChannel(Entity.Event.DRAG_END),this._chnOnHover=e.createChannel(Entity.Event.HOVER),this._chnOnHoverEnter=e.createChannel(Entity.Event.HOVER_ENTER),this._chnOnHoverExit=e.createChannel(Entity.Event.HOVER_EXIT),e.subscribe(this,e.Event.RESIZE,this.onResize),e.subscribe(this,e.Event.CAMERA_MOVE,this.onMove),e.subscribe(this,e.Event.ADAPT,this.onAdapt),this.volume=e.camera.volume,this.onMove(e.camera,null)},load:function(){meta.subscribe(this,[Input.Event.DOWN,Input.Event.UP],this.onInput,meta.Priority.HIGH),meta.subscribe(this,Input.Event.DBCLICK,this.onInputDbCLick,meta.Priority.HIGH),meta.subscribe(this,Input.Event.MOVE,this.onInputMove,meta.Priority.HIGH)},update:function(t){this.updateFlag|=0;var e,i,n,s,o;for(this._flags&this.Flag.UPDATE_HOVER&&(this._checkHover(Input.ctrl.getEvent()),this._flags&=~this.Flag.UPDATE_HOVER),e=0;e<this.numEntitiesToUpdate;e++)n=this.entitiesToUpdate[e],n.isPaused||n.isRemoved||(n.update&&n.update(t),n.components&&n._updateComponents(t));if(this.numDetachItems){for(e=0;e<this.numDetachItems;e++)if(n=this.detachBuffer[e],s=n._parent.children,o=s.length,0!==o)for(i=0;o>i;i++)if(s[i]===n){s[i]=s[o-1],s.pop();break}this.detachBuffer.length=0,this.numDetachItems=0}if(this.entitiesToRemove.length&&(this._removeEntities(this.entitiesToRemove),this.entitiesToRemove.length=0),this.numEntitiesRemoveUpdate){var h;for(e=0;e<this.numEntitiesRemoveUpdate;e++)n=this.entitiesRemoveUpdate[e],this.entitiesRemoveUpdate[e]=null,4===(4&n._removeFlag)&&(this.numEntitiesToUpdate--,h=this.entitiesToUpdate[this.numEntitiesToUpdate],h._updateNodeID=n._updateNodeID,this.entitiesToUpdate[n._updateNodeID]=h,this.entitiesToUpdate[this.numEntitiesToUpdate]=null,n._removeFlag&=-5,n._updateNodeID=-1);this.numEntitiesRemoveUpdate=0}this.needDepthSort&&(this.entities.sort(this._sortEntities),this.needDepthSort=!1),this.updateFlag&=-2},_addToDrawBounds:function(){this.numShowBounds++,this.isNeedRender=!0},_removeToDrawBounds:function(){this.numShowBounds--,this.isNeedRender=!0},addEntities:function(t){if(t instanceof Array){var e=t.length;this.entities.length+=e;for(var i=0;e>i;i++)this._addEntity(t[i])}else{if(!(t instanceof Entity.Geometry))return console.warn("(Entity.Controller.addEntities) Invalid type for entities"),void 0;this.entities.length++,this._addEntity(t)}this._flags|=this.Flag.UPDATE_HOVER,this.isNeedRender=!0},_addEntity:function(t){if(!t.isRemoved&&!(t._flags&t.Flag.ADDED)&&(this.entities[this.numEntities++]=t,t._flags|=t.Flag.ADDED,t.texture||(t.isLoaded=!0),t.update&&(t.isUpdating=!0),t.isNeedStyle&&t._style.update(t),0!==t.totalZ&&(this.needDepthSort=!0),t.isLoaded&&t._onResize(this),t.children))for(var e=t.children.length,i=0;e>i;i++)this._addEntity(t.children[i])},removeEntities:function(t){if(t instanceof Array)if(this.updateFlag){var e=t.length;this.entitiesToRemove.length+=e;for(var i=0;e>i;i++)this.entitiesToRemove.push(t[i])}else this._removeEntities(t);else{if(!(t instanceof Entity.Geometry))return console.warn("(Entity.Controller.removeEntities) Invalid type for entities"),void 0;if(this.updateFlag)this.entitiesToRemove.push(t);else for(var n=0;n<this.numEntities;n++)if(this.entities[n]===t){this.numEntities--,this.entities[n]=this.entities[this.numEntities],this.entities.pop(),t.children&&this._removeEntities(t.children);break}}this._flags|=this.Flag.UPDATE_HOVER,this.isNeedRender=!0,this.needDepthSort=!0},_removeEntities:function(t){for(var e,i,n=t.length,s=0;n>s;s++)for(e=t[s],i=0;i<this.numEntities;i++)if(e._flags&e.Flag.ADDED&&this.entities[i]===e){this.numEntities--,this.entities[i]=this.entities[this.numEntities],this.entities.pop(),e&=~e.Flag.ADDED,e.children&&this._removeEntities(e.children);break}},_addToUpdating:function(t){return t?4===(4&t._removeFlag)?(t._removeFlag&=-5,!0):-1!==t._updateNodeID?!1:(t._updateNodeID=this.numEntitiesToUpdate,this.entitiesToUpdate.length===this.numEntitiesToUpdate&&(this.entitiesToUpdate.length+=8),this.entitiesToUpdate[this.numEntitiesToUpdate]=t,this.numEntitiesToUpdate++,!0):(console.warn("(Entity.Controller._addToUpdating) Invalid or object is null."),void 0)},_removeFromUpdating:function(t){return t?-1===t._updateNodeID||4===(4&t._removeFlag)?!1:(this.entitiesRemoveUpdate.length===this.numEntitiesRemoveUpdate&&(this.entitiesRemoveUpdate.length+=4),t._removeFlag|=4,this.entitiesRemoveUpdate[this.numEntitiesRemoveUpdate]=t,this.numEntitiesRemoveUpdate++,!0):(console.warn("[Entity.Controller._addToUpdating]:","Invalid or object is null."),void 0)},_sortEntities:function(t,e){return t.totalZ-e.totalZ},getFromVolume:function(t){for(var e,i=this.entities.last.prev,n=this.entities.first;i!==n;i=i.prev)if(e=i.entity,e.pickable&&e.volume!==t&&e.volume.vsAABB(t))return e;return null},getFromPoint:function(t,e,i){for(var n,s=this.entities.last.prev,o=this.entities.first;s!==o;s=s.prev)if(n=s.entity,n.pickable&&n!==i&&n.volume.vsPoint(t,e))return n;return null},getFromEntity:function(t){return this.getFromVolume(t.volume)},cacheEntity:meta.emptyFuncParam,uncacheEntity:meta.emptyFuncParam,onResize:function(t,e){for(var i=0;i<this.numEntities;i++)this.entities[i]._onResize(this);this.isNeedRender=!0},onMove:function(t,e){var i=t.volume;this.prevStartCellX=this.startCellX,this.prevStartCellY=this.startCellY,this.prevEndCellX=this.endCellX,this.prevEndCellY=this.endCellY,this.startCellX=Math.floor(i.minX/this._cellSizeX),this.startCellY=Math.floor(i.minY/this._cellSizeY),this.endCellX=Math.floor(i.maxX/this._cellSizeX),this.endCellY=Math.floor(i.maxY/this._cellSizeY);for(var n=Math.min(this.prevStartCellX,this.startCellX),s=Math.min(this.prevStartCellY,this.startCellY),o=Math.max(this.prevEndCellX,this.endCellX),h=Math.max(this.prevEndCellY,this.endCellY),r,a,c=s;h>c;c++)for(var u=n;o>u;u++)r=u|c<<16;this.x=0|t._x,this.y=0|t._y,this.isNeedRender=!0},onAdapt:function(t,e){for(var i=0;i<this.numEntities;i++)this.entities[i].adapt()},onInput:function(t,e){if(this.enablePicking){this._checkHover(t);var i=Input.Event;if(i.DOWN===e){if(!this.hoverEntity||!this.hoverEntity.clickable)return;t.entity=this.hoverEntity,this.pressedEntity=this.hoverEntity,this.pressedEntity._inputFlags|=this.InputFlag.PRESSED,this.pressedEntity._style&&this.pressedEntity._onDown.call(this.pressedEntity,t),this.pressedEntity.onDown.call(this.pressedEntity,t),this._chnOnDown.emit(t,Entity.Event.INPUT_DOWN)}else i.UP===e&&this.pressedEntity&&this.pressedEntity.clickable&&(t.entity=this.hoverEntity,this.pressedEntity._inputFlags&=~this.InputFlag.PRESSED,this.pressedEntity._style&&this.pressedEntity._onUp.call(this.pressedEntity,e),this.pressedEntity.onUp.call(this.pressedEntity,e),this._chnOnUp.emit(this.pressedEntity,Entity.Event.INPUT_UP),this.pressedEntity===this.hoverEntity&&(this.pressedEntity._onClick.call(this.pressedEntity,t),this.pressedEntity.onClick.call(this.pressedEntity,t),this._chnOnClick.emit(t,Entity.Event.CLICK)),this.pressedEntity._inputFlags&this.InputFlag.DRAGGED&&(t.entity=this.pressedEntity,this.pressedEntity._inputFlags&=~this.InputFlag.DRAGGED,this.pressedEntity._style&&this.pressedEntity._onDragEnd.call(this.pressedEntity,t),this.pressedEntity.onDragEnd.call(this.pressedEntity,t),this._chnOnDragEnd.emit(t,Entity.Event.DRAG_END),t.entity=this.hoverEntity),this.pressedEntity=null)}},onInputDbCLick:function(t,e){this.enablePicking&&(this._checkHover(t),this.hoverEntity?(this.hoverEntity._onDbClick.call(this.hoverEntity,t),this.hoverEntity.onDbClick.call(this.hoverEntity,t),this._chnOnDbClick.emit(t,Entity.Event.DBCLICK),t.entity=this.hoverEntity):t.entity=null)},_checkHover:function(t){for(var e,i=this.numEntities-1;i>=0;i--)if(e=this.entities[i],e.pickable&&e.isInside(t.x,t.y))return this.hoverEntity!==e?(this.hoverEntity&&(t.entity=this.hoverEntity,this.hoverEntity._inputFlags&=~this.InputFlag.HOVER,this.hoverEntity._style&&this.hoverEntity._onHoverExit.call(this.hoverEntity,t),this.hoverEntity.onHoverExit.call(this.hoverEntity,t),this._chnOnHoverExit.emit(t,Entity.Event.HOVER_EXIT)),t.entity=e,e._inputFlags|=this.InputFlag.HOVER,e._style&&e._onHoverEnter.call(e,t),e.onHoverEnter.call(e,t),this._chnOnHoverEnter.emit(t,Entity.Event.HOVER_ENTER),this.hoverEntity=e):(t.entity=e,e.onHover.call(e,t),this._chnOnHover.emit(t,Entity.Event.HOVER)),t.entity=null,void 0;this.hoverEntity&&(t.entity=this.hoverEntity,this.hoverEntity._inputFlags&=~this.InputFlag.HOVER,this.hoverEntity._style&&this.hoverEntity._onHoverExit.call(this.hoverEntity,t),this.hoverEntity.onHoverExit.call(this.hoverEntity,t),this._chnOnHoverExit.emit(t,Entity.Event.HOVER_EXIT)),this.hoverEntity=null
},_checkDrag:function(t){return this.pressedEntity&&this.pressedEntity.clickable?(t.entity=this.pressedEntity,this.pressedEntity._inputFlags&this.InputFlag.DRAGGED?(this.pressedEntity.onDrag.call(this.pressedEntity,t),this._chnOnDrag.emit(t,Entity.Event.DRAG),!1):(this.pressedEntity._inputFlags|=this.InputFlag.DRAGGED,this.pressedEntity._style&&this.pressedEntity._onDragStart.call(this.pressedEntity,t),this.pressedEntity.onDragStart.call(this.pressedEntity,t),this._chnOnDragStart.emit(t,Entity.Event.DRAG_START),!1)):!0},onInputMove:function(t,e){return this.enablePicking?(this._checkHover(t),this._checkDrag(t)?(t.entity=this.hoverEntity,void 0):(t.entity=this.hoverEntity,void 0)):void 0},getByID:function(t){for(var e=this.entities.buffer,i=this.entities.length,n=0;i>n;n++)if(t===e[n].id)return e[n]},getByName:function(t){for(var e=this.entities.buffer,i=this.entities.length,n=0;i>n;n++)if(t===e[n].name)return e[n]},getUniqueID:function(){return++this._uniqueID},set cellMagnitue(t){this._cellMagnitue!==t&&(this._cellMagnitue=t,this._cellSizeX=128*t,this._cellSizeY=128*t,this.isNeedRender=!0)},get cellMagnitue(){return this._cellMagnitue},Flag:{UPDATE_HOVER:128},InputFlag:null,_x:0,_y:0,totalZ:0,_depthNode:null,totalAngleRad:0,totalAlpha:1,totalScaleX:1,totalScaleY:1,volume:null,pivotX:0,pivotY:0,_flags:0,cells:null,_cellSizeX:128,_cellSizeY:128,_cellMagnitue:1,startCellX:0,startCellY:0,endCellX:0,endCellY:0,prevStartCellX:0,prevStartCellY:0,prevEndCellX:0,prevEndCellY:0,_numCellX:0,_numCellY:0,entities:null,numEntities:0,updateFlag:0,entitiesToCheck:null,entitiesToRemove:null,entitiesToUpdate:null,entitiesRemoveUpdate:null,detachBuffer:null,dynamicEntities:null,numEntitiesToCheck:0,numEntitiesToUpdate:0,numEntitiesRemoveUpdate:0,numShowBounds:0,numDetachItems:0,isLoaded:!0,_parent:null,childOffsetX:0,childOffsetY:0,hoverEntity:null,pressedEntity:null,isNeedRender:!0,needDepthSort:!1,enablePicking:!0,showBounds:!1,showCells:!1,_uniqueID:0,_centerTex:null,_chnOnDown:null,_chnOnUp:null,_chnOnClick:null,_chnOnDbClick:null,_chnOnDrag:null,_chnOnDragStart:null,_chnOnDragEnd:null,_chnOnHover:null,_chnOnHoverEnter:null,_chnOnHoverExit:null}),"use strict",Entity.Event={INPUT_UP:"entityUp",INPUT_DOWN:"entityDown",CLICK:"entityClick",DBCLICK:"entityDbClick",DRAG:"drag",DRAG_START:"dragStart",DRAG_END:"dragEnd",HOVER:"hover",HOVER_ENTER:"hoverEnter",HOVER_EXIT:"hoverExit",STATE_CHANGE:"stateChange"},Entity.PositionType={CENTER:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_LEFT:3,BOTTOM_RIGHT:4,TOP:5,BOTTOM:6,LEFT:7,RIGHT:8},"use strict",meta.Renderer=meta.Class.extend({init:function(){this.holder=new Entity.Geometry,Entity.Geometry.prototype.renderer=this,Entity.Geometry.prototype.parent=this.holder},load:function(){this.engine=meta.engine,this.camera=meta.camera,this.chn={onDown:meta.createChannel(Entity.Event.INPUT_DOWN),onUp:meta.createChannel(Entity.Event.INPUT_UP),onClick:meta.createChannel(Entity.Event.CLICK),onDbClick:meta.createChannel(Entity.Event.DBCLICK),onDrag:meta.createChannel(Entity.Event.DRAG),onDragStart:meta.createChannel(Entity.Event.DRAG_START),onDragEnd:meta.createChannel(Entity.Event.DRAG_END),onHover:meta.createChannel(Entity.Event.HOVER),onHoverEnter:meta.createChannel(Entity.Event.HOVER_ENTER),onHoverExit:meta.createChannel(Entity.Event.HOVER_EXIT)},meta.subscribe(this,[Input.Event.DOWN,Input.Event.UP],this.onInput,meta.Priority.HIGH),meta.subscribe(this,Input.Event.MOVE,this.onInputMove,meta.Priority.HIGH),meta.subscribe(this,Input.Event.DBCLICK,this.onInputDbClick,meta.Priority.HIGH),meta.subscribe(this,meta.Event.RESIZE,this.onResize),meta.subscribe(this,meta.Event.ADAPT,this.onAdapt),meta.subscribe(this,meta.Event.CAMERA_MOVE,this.onCameraMove),this.holder.resize(this.camera.volume.width,this.camera.volume.height)},update:function(t){this.__updating=!0;for(var e=this.entitiesToUpdate.length,i=0;e>i;i++)this.entitiesToUpdate[i].update(t);if(this.__updating=!1,this.removeUpdating.length>0){var n,s;for(e=this.removeUpdating.length,i=0;e>i;i++)n=this.removeUpdating[i],s=this.entitiesToUpdate[this.entitiesToUpdate.length-1],s.__updateIndex=n,this.entitiesToUpdate[n]=s,this.entitiesToUpdate.pop();this.removeUpdating.length=0}this.needSortDepth&&(this.entities.sort(this._sortEntities),this.entitiesPicking.sort(this._sortEntities),this.needSortDepth=!1,this.needRender=!0)},_sortEntities:function(t,e){return t.totalZ-e.totalZ},addEntity:function(t){this.entities.push(t),t.__added=!0,t.update&&this.addEntityToUpdate(t),0!==t._z&&(this.needSortDepth=!0),t._pickable&&this.addPicking(t),t.__debug&&this.numDebug++,t.children&&this.addEntities(t.children),this.needRender=!0},addEntities:function(t){for(var e=t.length,i=0;e>i;i++)this.addEntity(t[i])},addEntityToUpdate:function(t){-1===t.__updateIndex&&(t.__updateIndex=this.entitiesToUpdate.length,this.entitiesToUpdate.push(t))},removeEntityFromUpdate:function(t){if(-1!==t.__updateIndex){if(this.__updating)this.removeUpdating.push(t.__updateIndex);else{var e=this.entitiesToUpdate[this.entitiesToUpdate.length-1];e.__updateIndex=t.__updateIndex,this.entitiesToUpdate[t.__updateIndex]=e,this.entitiesToUpdate.pop()}t.__updateIndex=-1}},addAnim:function(t){-1===t.__index&&(t.__index=this.entitiesAnim.length,this.entitiesAnim.push(t))},removeAnim:function(t){-1!==t.__index&&(this.entitiesAnimRemove.push(t.__index),t.__index=-1)},addPicking:function(t){t.__added&&this.entitiesPicking.push(t)},removePicking:function(t){},onInput:function(t,e){if(this.enablePicking){this._checkHover(t);var i=Input.Event;if(i.DOWN===e){if(!this.hoverEntity)return;t.entity=this.hoverEntity,this.pressedEntity=this.hoverEntity,this.pressedEntity.pressed=!0,this.pressedEntity._style&&this.pressedEntity._onDown.call(this.pressedEntity,t),this.pressedEntity.onDown&&this.pressedEntity.onDown.call(this.pressedEntity,t),this.chn.onDown.emit(t,Entity.Event.INPUT_DOWN)}else i.UP===e&&this.pressedEntity&&(t.entity=this.hoverEntity,this.pressedEntity.pressed=!1,this.pressedEntity._style&&this.pressedEntity._onUp.call(this.pressedEntity,e),this.pressedEntity.onUp&&this.pressedEntity.onUp.call(this.pressedEntity,e),this.chn.onUp.emit(this.pressedEntity,Entity.Event.INPUT_UP),this.pressedEntity===this.hoverEntity&&(this.pressedEntity._style&&this.pressedEntity._onClick.call(this.pressedEntity,t),this.pressedEntity.onClick&&this.pressedEntity.onClick.call(this.pressedEntity,t),this.chn.onClick.emit(t,Entity.Event.CLICK)),this.pressedEntity.dragged&&(t.entity=this.pressedEntity,this.pressedEntity.dragged=!1,this.pressedEntity._style&&this.pressedEntity._onDragEnd.call(this.pressedEntity,t),this.pressedEntity.onDragEnd&&this.pressedEntity.onDragEnd.call(this.pressedEntity,t),this.chn.onDragEnd.emit(t,Entity.Event.DRAG_END),t.entity=this.hoverEntity),this.pressedEntity=null)}},onInputMove:function(t,e){return this.enablePicking?(this._checkHover(t),this._checkDrag(t)?(t.entity=this.hoverEntity,void 0):(t.entity=this.hoverEntity,void 0)):void 0},onInputDbClick:function(t,e){this.enablePicking&&(this._checkHover(t),this.hoverEntity?(t.entity=this.hoverEntity,this.hoverEntity._style&&this.hoverEntity._onDbClick.call(this.hoverEntity,t),this.hoverEntity.onDbClick&&this.hoverEntity.onDbClick.call(this.hoverEntity,t),this.chn.onDbClick.emit(t,Entity.Event.DBCLICK)):t.entity=null)},_checkHover:function(t){for(var e,i=this.entitiesPicking.length,n=i-1;n>=0;n--){if(e=this.entitiesPicking[n],this.enablePixelPicking){if(!e.isPointInsidePx(t.x,t.y))continue}else if(!e.isPointInside(t.x,t.y))continue;return this.hoverEntity!==e?(this.hoverEntity&&(t.entity=this.hoverEntity,this.hoverEntity.hover=!1,this.hoverEntity._style&&this.hoverEntity._onHoverExit.call(this.hoverEntity,t),this.hoverEntity.onHoverExit&&this.hoverEntity.onHoverExit.call(this.hoverEntity,t),this.chn.onHoverExit.emit(t,Entity.Event.HOVER_EXIT)),t.entity=e,e.hover=!0,e._style&&e._onHoverEnter.call(e,t),e.onHoverEnter&&e.onHoverEnter.call(e,t),this.chn.onHoverEnter.emit(t,Entity.Event.HOVER_ENTER),this.hoverEntity=e):(t.entity=e,e.onHover&&e.onHover.call(e,t),this.chn.onHover.emit(t,Entity.Event.HOVER)),t.entity=null,void 0}this.hoverEntity&&(t.entity=this.hoverEntity,this.hoverEntity.hover=!1,this.hoverEntity._style&&this.hoverEntity._onHoverExit.call(this.hoverEntity,t),this.hoverEntity.onHoverExit&&this.hoverEntity.onHoverExit.call(this.hoverEntity,t),this.chn.onHoverExit.emit(t,Entity.Event.HOVER_EXIT)),this.hoverEntity=null},_checkDrag:function(t){return this.pressedEntity?(t.entity=this.pressedEntity,this.pressedEntity.dragged?(this.pressedEntity.onDrag&&this.pressedEntity.onDrag.call(this.pressedEntity,t),this.chn.onDrag.emit(t,Entity.Event.DRAG)):(this.pressedEntity.dragged=!0,this.pressedEntity._style&&this.pressedEntity._onDragStart.call(this.pressedEntity,t),this.pressedEntity.onDragStart&&this.pressedEntity.onDragStart.call(this.pressedEntity,t),this.chn.onDragStart.emit(t,Entity.Event.DRAG_START)),!1):!0},onResize:function(t,e){this.holder.resize(t.width,t.height);for(var i=this.entities.length,n=0;i>n;n++)this.entities[n].updateAnchor()},onAdapt:function(t,e){},onCameraMove:function(t,e){this.needRender=!0},getUniqueID:function(){return this.__uniqueID++},set bgColor(t){this._bgColor=t,this.updateBgColor(),this.needRender=!0},get bgColor(){return this._bgColor},set transparent(t){this._transparent=t,this.updateBgColor(),this.needRender=!0},get transparent(){return this._transparent},meta:meta,engine:null,camera:null,chn:null,holder:null,entities:[],entitiesToUpdate:[],removeUpdating:[],entitiesAnim:[],entitiesAnimRemove:[],entitiesPicking:[],entitiesPickingRemove:[],hoverEntity:null,pressedEntity:null,enablePicking:!0,enablePixelPicking:!1,needRender:!0,needSortDepth:!1,numDebug:0,_bgColor:"#ddd",_transparent:!1,__uniqueID:0,__updating:!1}),"use strict",meta.CanvasRenderer=meta.Renderer.extend({init:function(){this._super(),this.ctx=meta.engine.canvas.getContext("2d"),meta.engine.ctx=this.ctx},render:function(t){for(var e=this.entitiesAnim.length,i=0;e>i;i++)this.entitiesAnim[i].anim(t);var n=this.entitiesAnimRemove.length;if(n>0){for(i=0;e>i;i++)this.entitiesAnim[this.entitiesAnimRemove[i]]=this.entitiesAnim[e-1],this.entitiesAnim.pop();this.entitiesAnimRemove.length=0}for(this.clear(),this.ctx.save(),this.ctx.setTransform(this.camera._zoom,0,0,this.camera._zoom,0|this.camera._x,0|this.camera._y),e=this.entities.length,i=0;e>i;i++)this.drawEntity(this.entities[i]);if(this.meta.cache.debug){for(this.ctx.save(),this.ctx.lineWidth=2,this.ctx.strokeStyle="red",this.ctx.fillStyle="red",i=0;e>i;i++)this.drawVolume(this.entities[i]);this.ctx.restore()}else if(this.numDebug>0){this.ctx.save(),this.ctx.lineWidth=2,this.ctx.strokeStyle="red",this.ctx.fillStyle="red";var s;for(i=0;e>i;i++)s=this.entities[i],s.__debug&&this.drawVolume(s);this.ctx.restore()}this.needRender=!1,this.ctx.restore()},clear:function(){this._transparent?this.ctx.clearRect(0,0,this.engine.width,this.engine.height):(this.ctx.fillStyle=this._bgColor,this.ctx.fillRect(0,0,this.engine.width,this.engine.height))},drawEntity:function(t){var e=t._texture;if(e){var i=t.volume,n=t.anim;0===i.__type?e.frames>0?e.drawFrame(this.ctx,0|i.minX,0|i.minY,n._frame):this.ctx.drawImage(e.canvas,0|i.minX,0|i.minY):1===i.__type?(this.ctx.globalAlpha=t._alpha,this.ctx.transform(i.m11,i.m12,i.m21,i.m22,0|i.absX,0|i.absY),e.frames>0?e.drawFrame(this.ctx,-i.initPivotPosX,-i.initPivotPosY,n._frame):this.ctx.drawImage(e.canvas,-i.initPivotPosX,-i.initPivotPosY),this.ctx.globalAlpha=1,this.ctx.setTransform(this.camera._zoom,0,0,this.camera._zoom,0|this.camera._x,0|this.camera._y)):2===i.__type}},drawVolume:function(t){var e=t.volume;0===e.__type?this._drawVolume(e):1===e.__type&&(this.ctx.save(),this.ctx.translate(e.absX,e.absY),this.ctx.rotate(t.volume.angle),this.ctx.translate(-e.absX,-e.absY),this._drawVolume(e),this.ctx.restore())},_drawVolume:function(t){var e=Math.floor(t.minX),i=Math.floor(t.minY),n=Math.floor(t.maxX),s=Math.floor(t.maxY-1);this.ctx.beginPath(),this.ctx.moveTo(e,i),this.ctx.lineTo(n,i),this.ctx.lineTo(n,s),this.ctx.lineTo(e,s),this.ctx.lineTo(e,i-1),this.ctx.stroke(),this.ctx.fillRect(t.absX-3,t.absY-3,6,6)},updateBgColor:function(){}}),"use strict",meta.Anim=function(){this.texture=null},meta.Anim.prototype={set:function(t){return t?(this.texture=t,t.frames>0&&(this.fps=t.fps,this._frame=this.reverse?t.frames-1:0,this.autoPlay&&-1===this.__index&&meta.renderer.addAnim(this)),void 0):(-1!==this.__index&&meta.renderer.removeAnim(this),this.texture=null,void 0)},play:function(t){this.loop=t||!1,meta.renderer.addAnim(this)},pause:function(){meta.renderer.removeAnim(this)},resume:function(){meta.renderer.addAnim(this)},stop:function(){this._frame=this.reverse?texture.frames-1:0,meta.renderer.removeAnim(this)},onEnd:null,anim:function(t){if(this.__tAnim+=t,!(this.__tAnim<this.__delay)){var e=this.__tAnim/this.__delay|0;this.__tAnim-=e*this.__delay,meta.renderer.needRender=!0,this.reverse?(this._frame-=e,this._frame<0&&(this.pauseLastFrame?(meta.renderer.removeAnim(this),this._frame=0):this.loop?this._frame=(this.texture.frames+this._frame)%this.texture.frames:(meta.renderer.removeAnim(this),this._frame=this.texture.frames-1),this.onEnd&&this.onEnd())):(this._frame+=e,this._frame>=this.texture.frames&&(this.pauseLastFrame?(meta.renderer.removeAnim(this),this._frame=this.textures.frames-1):this.loop?this._frame=this._frame%this.texture.frames:(meta.renderer.removeAnim(this),this._frame=0),this.onEnd&&this.onEnd()))}},set frame(t){this._frame=t,meta.renderer.needRender=!0},get frame(){return this._frame},set fps(t){this._fps=t,this.__delay=1/(t*this._speed)},get fps(){this._fps},set speed(t){this._speed=t,this.__delay=1/(fps*this._speed)},get speed(){return this._speed},set paused(t){t?this.pause():this.resume()},get paused(){return!0},loop:!0,reverse:!1,autoPlay:!0,pauseLastFrame:!1,_fps:0,_speed:1,_frame:0,__index:-1,__delay:0,__tAnim:0},"use strict",meta.Volume=function(){this.x=0,this.y=0,this.absX=0,this.absY=0,this.width=0,this.height=0,this.initWidth=0,this.initHeight=0,this.minX=0,this.minY=0,this.maxX=0,this.maxY=0},meta.Volume.prototype={set:function(t,e){this.x=t,this.y=e,this.absX=t+this.parentX+this.anchorPosX,this.absY=e+this.parentY+this.anchorPosY,this.minX=this.absX-this.pivotPosX,this.minY=this.absY-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},move:function(t,e){this.x+=t,this.y+=e,this.absX+=t,this.absY+=e,this.minX+=t,this.minY+=e,this.maxX+=t,this.maxY+=e},updatePos:function(){this.absX=this.x+this.parentX+this.anchorPosX,this.absY=this.y+this.parentY+this.anchorPosY,this.minX=this.absX-this.pivotPosX,this.minY=this.absY-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},updatePivotPos:function(){this.pivotPosX=this.scaleX>0?this.pivotX*this.width:(1-this.pivotX)*this.width,this.pivotPosY=this.scaleY>0?this.pivotY*this.height:(1-this.pivotY)*this.height,this.minX=this.absX-this.pivotPosX,this.minY=this.absY-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height},updatePosTransform:function(){this.pivotPosX=this.scaleX>0?this.pivotX*this.width:(1-this.pivotX)*this.width,this.pivotPosY=this.scaleY>0?this.pivotY*this.height:(1-this.pivotY)*this.height,this.minX=this.absX-this.pivotPosX,this.minY=this.absY-this.pivotPosY,this.maxX=this.minX+this.width,this.maxY=this.minY+this.height,this.m11=this.cos*this.scaleX,this.m12=this.sin*this.scaleX,this.m21=-this.sin*this.scaleY,this.m22=this.cos*this.scaleY,this.__type=1},resize:function(t,e){this.initWidth=t,this.initHeight=e,this.initPivotPosX=t*this.pivotX|0,this.initPivotPosY=e*this.pivotY|0,this.width=t*this.scaleX|0,this.height=e*this.scaleY|0,this.updatePivotPos()},pivot:function(t,e){(this.pivotX!==t||this.pivotY!==e)&&(this.pivotX=t,this.pivotY=e,this.initPivotPosX=this.initWidth*this.pivotX|0,this.initPivotPosY=this.initHeight*this.pivotY|0,this.updatePivotPos())},rotate:function(t){this.angle=t,this.sin=Math.sin(t),this.cos=Math.cos(t),this.m11=this.cos*this.scaleX,this.m12=this.sin*this.scaleX,this.m21=-this.sin*this.scaleY,this.m22=this.cos*this.scaleY,this.__type=1},scale:function(t,e){this.scaleX=t*this.flipX,this.scaleY=e*this.flipY,this.width=Math.floor(this.initWidth*t),this.height=Math.floor(this.initHeight*e),this.updatePosTransform()},flip:function(t,e){void 0===t?(this.flipX=-this.flipX,this.scaleX*=-1):this.flipX!==t&&(this.flipX=t,this.scaleX*=-1),void 0===e||this.flipY!==e&&(this.flipY=e,this.scaleY*=-1),this.updatePosTransform()},vsAABB:function(t){return this.maxX<=t.minX||this.minX>=t.maxX?!1:this.maxY<=t.minY||this.minY>=t.maxY?!1:!0},vsAABBIntersection:function(t){return this.maxX<t.minX||this.minX>t.maxX?0:this.maxY<t.minY||this.minY>t.maxY?0:this.minX>=t.minX||this.minY>=t.minY?1:this.maxX<=t.maxX||this.maxY<=t.maxY?1:2},vsPoint:function(t,e){return this.minX>=t||this.maxX<=t?!1:this.minY>=e||this.maxY<=e?!1:!0},getSqrDistance:function(t,e){var i,n=0;return t<this.minX&&(i=this.minX-t,n+=i*i),t>this.maxX&&(i=t-this.maxX,n+=i*i),e<this.minY&&(i=this.minY-e,n+=i*i),e>this.maxY&&(i=e-this.maxY,n+=i*i),n},getDistanceVsAABB:function(t){var e=this.minX+(this.maxX-this.minX)/2,i=this.minY+(this.maxY-this.minY)/2,n=t.minX+(t.maxY-t.minY)/2,s=t.minY+(t.maxY-t.minY)/2,o=n-e,h=s-i;return Math.sqrt(o*o+h*h)},genCircle:function(){var t=this.maxX-this.minX,e=this.maxY-this.minY,i;return i=t>e?t/2:e/2,new meta.math.Circle(this.x,this.y,i)},print:function(t){console.log(t?"(Volume) "+t+" minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY:"(Volume) minX: "+this.minX+" minY: "+this.minY+" maxX: "+this.maxX+" maxY: "+this.maxY)},pivotX:0,pivotY:0,pivotPosX:0,pivotPosY:0,initPivotPosX:0,initPivotPosY:0,anchorPosX:0,anchorPosY:0,scaleX:1,scaleY:1,flipX:1,flipY:1,angle:0,parentX:0,parentY:0,parentAngle:0,absAngle:0,absScaleX:0,absScaleY:0,sin:0,cos:1,m11:1,m12:0,m21:0,m22:1,__type:0},"use strict",Entity.Geometry=meta.Class.extend({_init:function(t){this.volume=new meta.Volume,this.anim=new meta.Anim,this.initFromParam(t)},initFromParam:function(t){if("string"==typeof t){var e=Resource.ctrl.getTexture(t);e?this.texture=e:console.warn("(Entity.Geometry) Unavailable texture - "+t)}else this.texture=t},update:null,updatePos:function(){if(this.children)for(var t,e,i=this.children.length,n=0;i>n;n++)t=this.children[n],t.ignoreParentPos||(e=t.volume,e.parentX=this.volume.minX,e.parentY=this.volume.minY,e.updatePos(),t.updatePos());this.renderer.needRender=!0},position:function(t,e){this.volume.set(t,e),this.updatePos()},move:function(t,e){this.volume.set(this.volume.x+t,this.volume.y+e),this.updatePos()},set x(t){this.volume.set(t,this.volume.y),this.updatePos()},set y(t){this.volume.set(this.volume.x,t),this.updatePos()},get x(){return this.volume.x},get y(){return this.volume.y},get left(){return this.volume.minX},get right(){return this.volume.maxY},get top(){return this.volume.minY},get bottom(){return this.volume.maxY},set z(t){if(this._z=t,this.totalZ=t+this.parentZ,this.children)for(var e=this.totalZ+1,i=this.children.length,n=0;i>n;n++)this.children[n].totalZ=e+this.children[n]._z;meta.renderer.needSortDepth=!0},get z(){return this._z},pivot:function(t,e){void 0===e&&(e=t),this.volume.pivot(t,e),meta.renderer.needRender=!0},set pivotX(t){this.volume.pivot(t,this._pivotY),meta.renderer.needRender=!0},set pivotY(t){this.volume.pivot(this._pivotX,t),meta.renderer.needRender=!0},get pivotX(){return this.volume.pivotX},get pivotY(){return this.volume.pivotY},anchor:function(t,e){void 0===e&&(e=t),this._anchorX=t,this._anchorY=e,this.updateAnchor()},updateAnchor:function(){this.volume.anchorPosX=this.parent.volume.width*this._anchorX,this.volume.anchorPosY=this.parent.volume.height*this._anchorY,this.volume.updatePos(),this.updatePos()},set anchorX(t){this._anchorX=t,this.updateAnchor()},set anchorY(t){this._anchorY=t,this.updateAnchor()},get anchorX(){return this._anchorX},get anchroY(){return this._anchorY},set angle(t){t=t*Math.PI/180,this.volume.angle!==t&&(this.volume.rotate(t),meta.renderer.needRender=!0)},set angleRad(t){this.volume.angle!==t&&(this.volume.rotate(t),meta.renderer.needRender=!0)},get angle(){return 180*this.volume.angle/Math.PI},get angleRad(){return this.volume.angle},scale:function(t,e){if(void 0===e&&(e=t),this.volume.scale(t,e),this.children)for(var i=this.children.length,n=0;i>n;n++)this.children[n].updateAnchor();this.updatePos()},set scaleX(t){this.volume.scale(t,this.volume.scaleY),this.updatePos()},set scaleY(t){this.volume.scale(this.volume.scaleX,t),this.updatePos()},get scaleX(){return this.volume.scaleX},get scaleY(){return this.volume.scaleY},flip:function(t,e){this.volume.flip(t,e),meta.renderer.needRender=!0},set flipX(t){this.flip(t,this.volume.scaleY)},set flipY(t){this.flip(this.volume.scaleX,t)},get flipX(){return this.volume.flipX},get flipY(){return this.volume.flipY},set alpha(t){this._alpha=t,this.volume.__type=1,this.renderer.needRender=!0},get alpha(){return this._alpha},resize:function(t,e){if(this.volume.resize(t,e),this.updatePos(),this.children)for(var i=this.children.length,n=0;i>n;n++)this.children[n].updateAnchor();this.renderer.needRender=!0},onTextureEvent:function(t,e){var i=Resource.Event;e===i.LOADED?this.loaded=!0:e===i.UNLOADED&&(this.loaded=!1),this.updateFromTexture()},updateFromTexture:function(){this._texture?this.volume.resize(this._texture.width,this._texture.height):this.volume.resize(0,0),meta.renderer.needRender=!0},set texture(t){this._texture&&this._texture.unsubscribe(this),this._texture=t,t?(t.subscribe(this,this.onTextureEvent),t._loaded&&(this.updateFromTexture(),this.loaded=!0)):this.loaded=!1,this.anim.set(t)},get texture(){return this._texture},set needRender(t){this._needRender=t,t&&(meta.renderer.needRender=!0)},get needRender(){return this._needRender},attach:function(t){return t?(this.children?this.children.push(t):this.children=[t],t.totalZ=this.totalZ+1,t.parent=this,t.updateAnchor(),this.updatePos(),this._view&&this._view._active&&this.renderer.addEntity(t),void 0):(console.warn("(Entity.Geometry.attach) Invalid entity passed"),void 0)},detach:function(t){this.renderer.needRender=!0},detachAll:function(){if(this.children){for(var t=this.children.length,e=0;t>e;e++)this.detach(this.children[e]);this.children=null,this.renderer.needRender=!0}},set state(t){this._state!==t&&(this._state=t)},get state(){return this._state},set pickable(t){this._pickable!==t&&(this._pickable=t,t?meta.renderer.addPicking(this):meta.renderer.removePicking(this))},get pickable(){return this._pickable},isPointInside:function(t,e){if(1==this.__type){var i=this.volume,n=t-i.x,s=e-i.y;t=n*i.cos+s*i.sin+i.x,e=s*i.cos-n*i.sin+i.y}return this.volume.vsPoint(t,e)},isPointInsidePx:function(t,e){var i=this.volume;if(1==i.__type){var n=t-i.x,s=e-i.y;t=n*i.cos+s*i.sin+i.x,e=s*i.cos-n*i.sin+i.y}if(!this.volume.vsPoint(t,e))return!1;var n=(t-i.minX)/i.scaleX|0,s=(e-i.minY)/i.scaleY|0,o=this._texture.getPixelAt(n,s);return o[3]>50?!0:!1},onDown:null,onUp:null,onClick:null,onDbClick:null,onDrag:null,onDragStart:null,onDragEnd:null,onHover:null,onHoverEnter:null,onHoverExit:null,set debug(t){this.__debug!==t&&(this.__debug=t,t?meta.renderer.numDebug++:meta.renderer.numDebug--,meta.renderer.needRender=!0)},get debug(){return this.__debug},renderer:null,parent:null,_view:null,_texture:null,_z:0,parentZ:0,totalZ:0,_alpha:1,parentAlpha:0,totalAlpha:0,_anchorX:0,_anchorY:0,loaded:!0,_body:null,children:null,anim:null,_state:"*",_style:null,_pickable:!1,hover:!1,pressed:!1,dragged:!1,ignoreParentPos:!1,ignoreParentZ:!1,ignoreParentAngle:!1,ignoreParentAlpha:!1,__added:!1,__debug:!1,__updateIndex:-1}),"use strict",Entity.Text=Entity.Geometry.extend({init:function(t){this.texture=new Resource.Texture,this._texture.resize(this._fontSize,this._fontSize);var e=typeof t;this.setText("string"===e||"number"===e?t:"")},initFromParam:function(){},setText:function(t){this._text=t;var e=this._texture.ctx;e.font=this._style+" "+this._fontSizePx+" "+this._font;var i=e.measureText(this._text),n=i.width+2*this.outlineWidth;this.resize(n,1.2*this._fontSize),e.clearRect(0,0,this.volume.width,this.volume.height),e.font=this._style+" "+this._fontSizePx+" "+this._font,e.fillStyle=this._color,e.textBaseline="top",e.fillText(t,this.outlineWidth,0),this.isOutline&&(e.lineWidth=this._outlineWidth,e.strokeStyle=this._outlineColor,e.strokeText(t,this.outlineWidth,0)),this._texture._isLoaded||(this._texture.isLoaded=!0),this.isNeedDraw=!0},resize:function(t,e){t=t||1,e=e||this.volume.height,this._texture.resize(t,e)},setFont:function(t){this._font=t,this.setText(this._text)},setSize:function(t){this._fontSize=t,this._fontSizePx=t+"px",this.setText(this._text)},setColor:function(t){this._color=t,this.setText(this._text)},setOutlineColor:function(t){this._outlineColor=t,this.isOutline=!0},setOutlineWidth:function(t){this._outlineWidth=t,this._isOutline&&this.setText(this._text)},setStyle:function(t){this._style=t,this.setText(this._text)},set text(t){this.setText(t)},get text(){return this._text},set font(t){this.setFont(t)},get font(){return this._font},set size(t){this.setSize(t)},get size(){return this._fontSize},set color(t){this.setColor(t)},get color(){return this._color},set outlineColor(t){this.setOutlineColor(t)},get outlineColor(){return this._outlineColor},set outlineWidth(t){this.setOutlineWidth(t)},get outlineWidth(){return this._outlineWidth},set style(t){this.setStyle(t)},get style(){return this._style},set isOutline(t){this._isOutline!==t&&(this._isOutline=t,this.setText(this._text))},get isOutline(){return this._isOutline},_text:"",_font:"Verdana",_fontSize:14,_fontSizePx:"14px",_color:"#000000",_outlineColor:"#ffffff",_outlineWidth:1,_style:"",_isOutline:!1}),"use strict",window.Input={},Input.Controller=meta.Controller.extend({init:function(){this.engine=meta.engine,this.keys=new Array(this.numKeys),this.inputs=new Array(this.numInputs),this.touches=[],this._event={event:null,x:0,y:0,prevScreenX:0,prevScreenY:0,screenX:0,screenY:0,keyCode:0,entity:null},this.addEventListeners(),this._loadIgnoreKeys(),meta.subscribe(this,meta.Event.FOCUS,this.onFocus)},release:function(){this.removeEventListeners(),meta.unsubscribe(this,meta.Event.FOCUS,this.onFocus)},onKeyDown:function(t){if(window.top&&this._iFrameKeys[t.keyCode]&&t.preventDefault(),void 0!==this._cmdKeys[t.keyCode]&&this._numCmdKeys++,void 0!==this._ignoreKeys[t.keyCode]&&this._numCmdKeys<=0&&t.preventDefault(),!(this.blockInput||this.isStickyKeys&&this.keys[t.keyCode])){if(this.keys[t.keyCode]=!0,this._event.event=t,this._event.prevScreenX=0,this._event.prevScreenY=0,this._event.screenX=0,this._event.screenY=0,this._event.x=0,this._event.y=0,this._event.keyCode=t.keyCode,this.chn.keyDown.emit(this._event,Input.Event.KEY_DOWN),this._callbacks&&this._callbacks[t.keyCode])for(var e=this._callbacks[t.keyCode],i=e.length,n=0;i>n;n++)e[n]();if(this.keyRepeat){if(!this._inputTimer){var s=this;this._inputTimer=meta.addTimer(this,function(){s._event.keyCode=s._repeatKey,s.chn.keyDown.emit(s._event,Input.Event.KEY_DOWN)},this.keyRepeat)}this._repeatKey=t.keyCode,this._inputTimer.resume(),this._inputTimer.tAccumulator=0}}},onKeyUp:function(t){window.top&&this._iFrameKeys[t.keyCode]&&t.preventDefault(),void 0!==this._cmdKeys[t.keyCode]&&this.keys[t.keyCode]&&this._numCmdKeys--,void 0===this._ignoreKeys[t.keyCode]&&this._numCmdKeys<=0&&t.preventDefault(),this.blockInput||(this.keys[t.keyCode]=!1,this._event.event=t,this._event.prevScreenX=0,this._event.prevScreenY=0,this._event.prevX=0,this._event.prevY=0,this._event.x=0,this._event.y=0,this._event.keyCode=t.keyCode,this.chn.keyUp.emit(this._event,Input.Event.KEY_UP),this.keyRepeat&&this._inputTimer&&this._inputTimer.pause())},onMouseDown:function(t){if(!this.blockInput){this.inputs[t.button]=!0;var e=meta,i=e.camera,n=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,s=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,o=n*i.zoomRatio-i._x|0,h=s*i.zoomRatio-i._y|0;this._event.event=t,this._event.prevScreenX=n,this._event.prevScreenY=s,this._event.screenX=n,this._event.screenY=s,this._event.x=o,this._event.y=h,this._event.keyCode=t.button,this.chn.inputDown.emit(this._event,Input.Event.DOWN),this._event.entity=null}},onMouseUp:function(t){if(!this.blockInput){this.inputs[t.button]=!1;var e=meta,i=e.camera,n=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,s=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,o=n*i.zoomRatio-i._x|0,h=s*i.zoomRatio-i._y|0;this._event.event=t,this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this._event.screenX=n,this._event.screenY=s,this._event.x=o,this._event.y=h,this._event.keyCode=t.button,this.chn.inputUp.emit(this._event,Input.Event.UP),this.chn.inputClick.emit(this._event,Input.Event.CLICK),this._event.entity=null}},onMouseMove:function(t){if(t.preventDefault(),!this.blockInput){var e=meta,i=e.camera,n=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,s=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,o=(n-i._x)*i.zoomRatio|0,h=(s-i._y)*i.zoomRatio|0;this._event.event=t,this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this._event.screenX=n,this._event.screenY=s,this._event.x=o,this._event.y=h,this._event.keyCode=-1,this.inputX=o,this.inputY=h,this.chn.inputMove.emit(this._event,Input.Event.MOVE),this._event.entity=null}},onMouseDbClick:function(t){if(!this.blockInput){this.inputs[t.button]=!1;var e=meta,i=e.camera,n=(t.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,s=(t.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,o=n*i.zoomRatio-i._x|0,h=s*i.zoomRatio-i._y|0;this._event.event=t,this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this._event.screenX=n,this._event.screenY=s,this._event.x=o,this._event.y=h,this._event.keyCode=t.button,this.chn.inputDbClick.emit(this._event,Input.Event.DBCLICK),this._event.entity=null}},onTouchDown:function(t){t.preventDefault();for(var e=meta,i=e.camera,n,s,o,h,r,a=t.changedTouches,c=a.length,u=0;c>u;u++)n=t.changedTouches[u],this.touches.push(n.identifier),this.numTouches++,s=(n.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,o=(n.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,h=s*i.zoomRatio-i._x|0,r=o*i.zoomRatio-i._y|0,this._event.event=t,this._event.prevScreenX=s,this._event.prevScreenY=o,this._event.screenX=s,this._event.screenY=o,this._event.x=h,this._event.y=r,this._event.keyCode=this.numTouches-1,this.chn.inputDown.emit(this._event,Input.Event.DOWN),this._event.entity=null},onTouchUp:function(t){t.preventDefault();for(var e=meta,i=e.camera,n,s,o,h,r,a,c=t.changedTouches,u=c.length,l=0;u>l;l++)n=t.changedTouches[l],s=this._getTouchID(n.identifier),-1!==s&&(this.touches.splice(s,1),this.numTouches--,o=(n.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,h=(n.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,r=o*i.zoomRatio-i._x|0,a=h*i.zoomRatio-i._y|0,this._event.event=t,0===s?(this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY):(this._event.prevScreenX=o,this._event.prevScreenY=h),this._event.screenX=o,this._event.screenY=h,this._event.x=r,this._event.y=a,this._event.keyCode=s,this.chn.inputDown.emit(this._event,Input.Event.UP),this.chn.inputClick.emit(this._event,Input.Event.CLICK),this._event.entity=null)},onTouchMove:function(t){t.preventDefault();for(var e=meta,i=e.camera,n,s,o,h,r,a,c=t.changedTouches,u=c.length,l=0;u>l;l++)n=t.changedTouches[l],s=this._getTouchID(n.identifier),-1!==s&&(o=(n.pageX-this.engine.offsetLeft)*this.engine.scaleX*window.devicePixelRatio,h=(n.pageY-this.engine.offsetTop)*this.engine.scaleY*window.devicePixelRatio,r=o*i.zoomRatio-i._x|0,a=h*i.zoomRatio-i._y|0,this._event.event=t,0===s?(this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this.inputX=r,this.inputY=a):(this._event.prevScreenX=o,this._event.prevScreenY=h),this._event.screenX=o,this._event.screenY=h,this._event.x=r,this._event.y=a,this._event.keyCode=s,this.chn.inputMove.emit(this._event,Input.Event.MOVE),this._event.entity=null)
},onFocus:function(t,e){e===!1&&this.resetInput()},isDown:function(t){return this.keys[t]},isInputDown:function(t){return this.inputs[t]||this.numTouches-1===t},addEventListeners:function(){var t=this;this.chn={keyDown:meta.createChannel(Input.Event.KEY_DOWN),keyUp:meta.createChannel(Input.Event.KEY_UP),inputDown:meta.createChannel(Input.Event.DOWN),inputUp:meta.createChannel(Input.Event.UP),inputMove:meta.createChannel(Input.Event.MOVE),inputClick:meta.createChannel(Input.Event.CLICK),inputDbClick:meta.createChannel(Input.Event.DBCLICK)},this.func={keyDown:function(e){t.onKeyDown(e)},keyUp:function(e){t.onKeyUp(e)},mouseDown:function(e){t.onMouseDown(e)},mouseUp:function(e){t.onMouseUp(e)},mouseDbClick:function(e){t.onMouseDbClick(e)},mouseMove:function(e){t.onMouseMove(e)},touchDown:function(e){t.onTouchDown(e)},touchUp:function(e){t.onTouchUp(e)},touchMove:function(e){t.onTouchMove(e)},touchCancel:function(e){t.onTouchCancel(e)}},window.addEventListener("mousedown",this.func.mouseDown),window.addEventListener("mouseup",this.func.mouseUp),window.addEventListener("mousemove",this.func.mouseMove),window.addEventListener("dblclick",this.func.mouseDbClick),window.addEventListener("touchstart",this.func.touchDown),window.addEventListener("touchend",this.func.touchUp),window.addEventListener("touchmove",this.func.touchMove),window.addEventListener("touchcancel",this.func.touchUp),window.addEventListener("touchleave",this.func.touchUp),meta.device.support.onkeydown&&window.addEventListener("keydown",this.func.keyDown),meta.device.support.onkeyup&&window.addEventListener("keyup",this.func.keyUp)},removeEventListeners:function(){window.removeEventListener("mousedown",this.func.mouseDown),window.removeEventListener("mouseup",this.func.mouseUp),window.removeEventListener("mousemove",this.on.mouseMove),window.removeEventListener("dblclick",this.on.mouseDbClick),window.removeEventListener("touchstart",this.on.touchDown),window.removeEventListener("touchend",this.on.touchUp),window.removeEventListener("touchmove",this.on.touchMove),window.removeEventListener("touchcancel",this.on.touchUp),window.removeEventListener("touchleave",this.on.touchUp),meta.device.support.onkeydown&&window.removeEventListener("keydown",this.on.keyDown),meta.device.support.onkeyup&&window.removeEventListener("keyup",this.on.keyUp)},resetInput:function(){var t;for(this._event.event=null,this._event.prevX=0,this._event.prevY=0,this._event.x=0,this._event.y=0,this._event.keyCode=0,t=0;t<this.numKeys;t++)this.keys[t]&&(this.keys[t]=!1,this._event.keyCode=t,this.chn.keyUp.emit(this._event,Input.Event.KEYUP));for(t=0;t<this.numInputs;t++)this.inputs[t]&&(this.inputs[t]=!1,this._event.keyCode=t,this.chn.inputUp.emit(this._event,Input.Event.UP));if(this._numCmdKeys=0,this.numTouches){for(t=0;t<this.numTouches;t++)this._event.keyCode=t,this.chn.inputUp.emit(this._event,Input.Event.UP);this.touches.length=0,this.numTouches=0}},onKey:function(t,e){this._callbacks?this._callbacks[t]?this._callbacks[t].push(e):this._callbacks[t]=[e]:(this._callbacks={},this._callbacks[t]=[e])},getEvent:function(){return this._event.event=null,this._event.prevScreenX=this._event.screenX,this._event.prevScreenY=this._event.screenY,this._event.screenX=this.screenX,this._event.screenY=this.screenY,this._event.x=this.inputX,this._event.y=this.inputY,this._event.keyCode=-1,this._event},_loadIgnoreKeys:function(){this._ignoreKeys=[],this._ignoreKeys[8]=1,this._ignoreKeys[9]=1,this._ignoreKeys[13]=1,this._ignoreKeys[17]=1,this._ignoreKeys[91]=1,this._ignoreKeys[38]=1,this._ignoreKeys[39]=1,this._ignoreKeys[40]=1,this._ignoreKeys[37]=1,this._ignoreKeys[124]=1,this._ignoreKeys[125]=1,this._ignoreKeys[126]=1,this._cmdKeys=[],this._cmdKeys[91]=1,this._cmdKeys[17]=1,this._iFrameKeys=[],this._iFrameKeys[37]=1,this._iFrameKeys[38]=1,this._iFrameKeys[39]=1,this._iFrameKeys[40]=1},_ignoreFKeys:function(t){this._ignoreKeys[112]=t,this._ignoreKeys[113]=t,this._ignoreKeys[114]=t,this._ignoreKeys[115]=t,this._ignoreKeys[116]=t,this._ignoreKeys[117]=t,this._ignoreKeys[118]=t,this._ignoreKeys[119]=t,this._ignoreKeys[120]=t,this._ignoreKeys[121]=t,this._ignoreKeys[122]=t,this._ignoreKeys[123]=t},set ignoreFKeys(t){this._ignoreFKeys(t?1:0)},get ignoreFKeys(){return!!this._ignoreKeys[112]},_getTouchID:function(t){for(var e=0;e<this.numTouches;e++)if(this.touches[e]===t)return e;return-1},engine:meta.engine,chn:null,func:null,keys:null,inputs:null,touches:null,blockInput:!1,isStickyKeys:!0,keyRepeat:0,_inputTimer:null,_repeatKey:0,numKeys:256,numInputs:10,numTouches:0,inputX:0,inputY:0,_event:null,_ignoreKeys:null,_cmdKeys:null,_iFrameKeys:null,_numCmdKeys:0,_callbacks:null}),"use strict",Input.Event={KEY_DOWN:"keydown",KEY_UP:"keyup",DOWN:"down",UP:"up",MOVE:"move",CLICK:"click",DBCLICK:"dbclick"},Input.Key={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"[":91,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,ESC:27,SPACE:32,NUM_0:48,NUM_1:49,NUM_2:50,NUM_3:51,NUM_4:52,NUM_5:53,NUM_6:54,NUM_7:55,NUM_8:56,NUM_9:57,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DELETE:127,PLUS:187,MINUS:189,TILDE:222,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,BUTTON_LEFT:0,BUTTON_MIDDLE:1,BUTTON_RIGHT:2},"use strict";var Physics={};Physics.Manifold=function(){this.a=null,this.b=null,this.normal=new meta.math.Vector2(0,0),this.penetration=0},Physics.Controller=meta.Controller.extend({update:function(t){for(var e,i,n,s,o=this.items.length,h=0;o>h;h++)if(e=this.items[h],e.updateItem(t,this.manifold),e.owner.visible)for(n=h+1;o>n;n++)i=this.items[n],i.owner.visible&&e.flag!==i.flag&&(s=this.overlapAABB(e.volume,i.volume),s&&(e.owner.onCollision&&(this.manifold.a=e.owner,this.manifold.b=i.owner,e.owner.onCollision(this.manifold)),i.owner.onCollision&&(this.manifold.a=i.owner,this.manifold.b=e.owner,i.owner.onCollision(this.manifold))))},overlapAABB:function(t,e){var i=e.minX-t.minX,n=e.minY-t.minY,s=(t.maxX-t.minX)/2,o=(e.maxX-e.minX)/2,h=s+o-Math.abs(i);if(h>0){s=(t.maxY-t.minY)/2,o=(e.maxY-e.minY)/2;var r=s+o-Math.abs(n);if(r>0)return r>h?(0>i?this.manifold.normal.set(-1,0):this.manifold.normal.set(1,0),this.manifold.penetration=h,!0):(0>n?this.manifold.normal.set(0,-1):this.manifold.normal.set(0,1),this.manifold.penetration=r,!0)}return!1},add:function(t){return t instanceof Entity.Geometry?(this.items.push(t.addComponent("body",Physics.Body)),void 0):(console.warn("(Physics.Controller.add) Object should be a part of Entity.Geometry:",t),void 0)},items:[],manifold:new Physics.Manifold,_relativeVel:new meta.math.Vector2(0,0),_impulseX:0,_impulseY:0,_percent:.8,_slop:.01}),"use strict",Physics.Body=function(){this._mass=100,this.invMass=.01,this.restitution=.6,this.velocity=new meta.math.Vector2(0,0)},Physics.Body.prototype={load:function(){this.volume=this.owner.volume},updateVolume:function(){},updateItem:function(t,e){this.speed+=this.acceleration*t,this.speed>this.maxSpeed&&(this.speed=this.maxSpeed);var i=this.owner.volume;if(this.haveTarget){var n=meta.math.length(i.x,i.y,this.targetX,this.targetY);n<=this.speed*t?(this.owner.position(this.targetX,this.targetY),this.stop()):(this._helperVec.x=this.targetX-i.x,this._helperVec.y=this.targetY-i.y,this._helperVec.normalize(),this.velocity.x=this._helperVec.x*this.speed,this.velocity.y=this._helperVec.y*this.speed)}if(this.owner.move(this.velocity.x*t,this.velocity.y*t),this.volume.set(i.x,i.y),this.enableWorldBounds){var s=i.x,o=i.y;this.volume.minX<0?(s=this.volume.x-this.volume.minX,this.velocity.x=-this.velocity.x,e.normal.set(1,0)):this.volume.maxX>meta.world.width&&(s+=meta.world.width-this.volume.maxX,this.velocity.x=-this.velocity.x,e.normal.set(-1,0)),this.volume.minY<0?(o=this.volume.y-this.volume.minY,this.velocity.y=-this.velocity.y,e.normal.set(0,1)):this.volume.maxY>meta.world.height&&(o+=meta.world.height-this.volume.maxY,this.velocity.y=-this.velocity.y,e.normal.set(0,-1)),this.owner.position(s,o),this.volume.set(s,o)}},moveTo:function(t,e,i,n){this.targetX=t,this.targetY=e,this.haveTarget=!0,this.speed=i||600,this.moveToCB=n||null},stop:function(){this.speed=0,this.acceleration=0,this.velocity.x=0,this.velocity.y=0,this.haveTarget&&(this.moveToCB&&(this.moveToCB.call(this.owner),this.moveToCB=null),this.haveTarget=!1)},set mass(t){this._mass=t,this.invMass=0===t?0:1/t},get mass(){return this._mass},enableWorldBounds:!1,ghost:!1,targetX:0,targetY:0,haveTarget:!1,moveToCB:null,maxSpeed:Number.MAX_VALUE,acceleration:0,onCollision:null,_helperVec:new meta.math.Vector2(0,0)},"use strict";var UI={};UI.Controller=meta.Controller.extend({init:function(){var t=new Resource.Texture;t.fillRect({color:"#111",width:120,height:30});var e=new Resource.Texture;e.fillRect({color:"#ff0000",width:120,height:30}),this.coreStyle={button:{"*:hover":{cursor:"pointer"},"*:pressed, *:drag":{cursor:"pointer",offsetX:1,offsetY:1}},checkbox:{"*:hover":{cursor:"pointer"},"*:pressed, *:drag":{cursor:"pointer",offsetX:1,offsetY:1}}},this.style={button:{"*":{texture:t},"*:hover":{texture:e,cursor:"pointer"},"*:pressed":{texture:e,cursor:"pointer",offsetX:1,offsetY:1}},checkbox:{"*":{texture:t},"*:hover":{texture:e,cursor:"pointer"},"*:pressed":{texture:e,cursor:"pointer",offsetX:1,offsetY:1},"[off]":{texture:t},"[on]":{texture:e}}}},coreStyle:null,style:null}),"use strict",UI.Button=Entity.Geometry.extend({_initParams:function(t){this.style=t?meta.createStyle(t,UI.ctrl.coreStyle.button):UI.ctrl.style.button},set text(t){this._text?this._text.setText(t):(this._text=new Entity.Text(t),this._text.size=12,this._text.color="#ffffff",this.attach(this._text),this._text.anchor(.5),this._text.pickable=!1)},get text(){return this._text?this._text._text:""},_text:null}),"use strict",UI.Checkbox=Entity.Geometry.extend({_initParams:function(t){this.style=t?meta.createStyle(t,UI.ctrl.coreStyle.checkbox):UI.ctrl.style.checkbox;var e=this,i=new Entity.Geometry;i.style=this._style.childStyle,i.anchor(.5),i.pickable=!1,i.onChange=function(){e._onChildChange(this)},this.attach(i),this.state="off",this._onClick=this.toggle},toggle:function(){var t=this.children[0];t.state=this.group?"on":"on"===t.state?"off":"on"},_onChange:function(){this.children[0].state=this._state,this.group&&"on"===this._state&&this.group._onStateChange(this)},_onChildChange:function(t){this.state=this.children[0]._state},set checked(t){this.state=t?"on":"off"},get checked(){return"on"===this._state},set text(t){this._text?this._text.setText(t):(this._text=new Entity.Text(t),this._text.size=12,this._text.color="#ffffff",this.attach(this._text),this._text.anchor(.5),this._text.pickable=!1)},get text(){return this._text?this._text._text:""},_text:null,group:null,value:""}),"use strict",UI.ProgressBar=Entity.Geometry.extend({init:function(){this.texture=new Resource.Texture,this.volume.resize(300,30),this.buildElement()},buildElement:function(){this.texture.fillRect({width:this.width,height:this.height,color:"white"})},updateElement:function(){},set min(t){this._min!==t&&(this._min=t,this.updateElement())},set max(t){this._max!==t&&(this._max=t,this.updateElement())},set value(t){this._value!==t&&(this._value=t,this.updateElement())},get min(){return this._min},get max(){return this._max},get value(){return this._value},_min:0,_max:100,_value:0}),"use strict",UI.Group=Entity.Geometry.extend({add:function(t){t.group&&t.detach(),this.children||(t.state="on",this._value=t.value),this.attach(t),t.group=this},_onStateChange:function(t){this.prevValue=this._value,this._value=t.value;for(var e,i=this.children.length,n=0;i>n;n++)e=this.children[n],e!==t&&(this.children[n].state="off");this.onChange(this)},set value(t){if(this.children)for(var e=this.children.length,i=0;e>i;i++)if(this.children[i].value===t){this.children[i].state="on";break}},get value(){return this._value},prevValue:"",_value:""}),"use strict",meta.createEngine=function(){meta.onDomLoad(function(){meta.engine.autoInit&&meta.engine.create()})},meta.createEngine(),meta.loadScript=function(t,e){meta.engine&&meta.engine.isLoaded?meta._loadScript({s:t,c:e}):(meta.cache.scripts||(meta.cache.scripts=[]),meta.cache.scripts.push({s:t,c:e}))},meta._loadScript=function(t){var e=document.createElement("script"),i=document.scripts[0];"async"in i?(e.async=!1,e.onload=t.c,e.src=t.s,document.head.appendChild(e)):i.readyState?(meta.cache.pendingScripts||(meta.cache.pendingScripts=[]),meta.cache.pendingScripts.push(e),e.onreadystatechange=meta._onReadyStateChange,e.src=t.s):document.write("<script src='"+src+"' defer></script>")},meta._onReadyStateChange=function(){for(var t,e=meta.cache.pendingScripts;e[0]&&"loaded"===e[0].s.readyState;)t=e.shift(),t.s.onreadystatechange=null,document.scripts[0].parentNode.insertBefore(t.s,firstScript),t.c&&t.c()},meta._loadAllScripts=function(){var t=meta.cache.scripts;if(!t)return!1;var e=t.length;if(0===e)return!1;var i=function(){var t=meta.cache;t.numScriptsToLoad--;var e=meta.cache.scripts,n=e.length;if(n>0){t.numScriptsToLoad+=n,t.scripts=[];for(var s,o=0;n>o;o++)s=e[o],s.c=i,meta._loadScript(s)}0===t.numScriptsToLoad&&(t.scripts=null,meta.engine._continueLoad())},n,s=meta.cache;s.numScriptsToLoad+=t.length,s.scripts=[];for(var o=0;e>o;o++)n=t[o],n.c=i,meta._loadScript(n);return!0},meta.import=function(t){if(t){var e=t.split("/"),i=e[0],n;1===e.length?(n="latest",t+="/latest"):n=e[e.length-1];var s=meta.modules[i];if(s)return s.version!==n&&console.error("[meta.loadPackage]:","There is already added module ["+s.name+"] but with different version: "+s.version),void 0;s={name:i,version:n},meta.modules[i]=s,meta.isUrl(t)||(t=meta.importUrl+t+"/module.js"),meta.loadScript(t,null)}};